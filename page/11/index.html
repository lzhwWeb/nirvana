<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
 <meta name="referrer" content="no-referrer"/>

  <link rel="apple-touch-icon" sizes="180x180" href="/nirvana/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/nirvana/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/nirvana/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/nirvana/images/logo.svg" color="#222">

<link rel="stylesheet" href="/nirvana/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lzhwweb.github.io","root":"/nirvana/","images":"/nirvana/images","scheme":"Gemini","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/nirvana/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="个人学习笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="涅槃快乐是金">
<meta property="og:url" content="https://lzhwweb.github.io/nirvana/page/11/index.html">
<meta property="og:site_name" content="涅槃快乐是金">
<meta property="og:description" content="个人学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nirvana">
<meta property="article:tag" content="前端,javascript,node,git">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lzhwweb.github.io/nirvana/page/11/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>涅槃快乐是金</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/nirvana/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">涅槃快乐是金</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/nirvana/" rel="section">首页</a></li>
        <li class="menu-item menu-item-git"><a href="/nirvana/categories/git" rel="section">git</a></li>
        <li class="menu-item menu-item-linux"><a href="/nirvana/categories/linux" rel="section">linux</a></li>
        <li class="menu-item menu-item-android"><a href="/nirvana/categories/android" rel="section">android</a></li>
        <li class="menu-item menu-item-随笔"><a href="/nirvana/categories/informal" rel="section">随笔</a></li>
        <li class="menu-item menu-item-mac"><a href="/nirvana/categories/mac" rel="section">mac</a></li>
        <li class="menu-item menu-item-react-native"><a href="/nirvana/categories/reactnative" rel="section">react-native</a></li>
        <li class="menu-item menu-item-算法"><a href="/nirvana/categories/algorithm" rel="section">算法</a></li>
        <li class="menu-item menu-item-读书笔记"><a href="/nirvana/categories/note" rel="section">读书笔记</a></li>
        <li class="menu-item menu-item-开发工具"><a href="/nirvana/categories/tool" rel="section">开发工具</a></li>
        <li class="menu-item menu-item-设计模式(ts)"><a href="/nirvana/categories/DesignPattern" rel="section">设计模式(TS)</a></li>
        <li class="menu-item menu-item-前端"><a href="/nirvana/categories/javascript" rel="section">前端</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="nirvana"
      src="/nirvana/images/headphoto.jpeg">
  <p class="site-author-name" itemprop="name">nirvana</p>
  <div class="site-description" itemprop="description">个人学习笔记</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/nirvana/archives">
          <span class="site-state-item-count">182</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lzhwWeb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lzhwWeb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/" class="post-title-link" itemprop="url">如何彻底避免正则表达式的灾难性回溯？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/" class="post-meta-item leancloud_visitors" data-flag-title="如何彻底避免正则表达式的灾难性回溯？" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>正则表达式的灾难性回溯（Catastrophic Backtracking）是指，正则在匹配的时候回溯过多，造成 CPU 100%，正常服务被阻塞。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>这里有一篇<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/38229530">文章</a>详细的描述了一次正则回溯导致 CPU 100% 的发现和解决过程，原文比较长，我之前也在 OpenResty 的开发中遇到过两次类似的问题。</p>
<p>这里简单归纳下，你就可以不用花费时间去了解背景了：</p>
<ol>
<li> 大部分开发语言的正则引擎是用基于回溯的 NFA 来实现（而不是基于 Thompson’s NFA）；</li>
<li> 如果回溯次数过多，就会导致灾难性回溯，CPU 100%；</li>
<li> 需要用 gdb 分析 dump，或者 systemtap 分析线上环境来定位；</li>
<li> 这种问题很难在代码上线前发现，需要逐个 review 正则表达式；</li>
</ol>
<p>站在开发的角度，修复完有问题的正则表达式，就告一段落了。最多再加上一个保险机制，限制下回溯的次数，比如在 OpenResty 中这样设置：</p>
<p><code>lua_regex_match_limit 100000;</code></p>
<p>这样即使出现灾难性回溯，也会被限制住，不会跑满 CPU。</p>
<p>嗯，看上去已经很完美了吗？让我们来跳出开发的层面，用不同的维度来看待这个问题。</p>
<h2 id="攻击者"><a href="#攻击者" class="headerlink" title="攻击者"></a>攻击者</h2><p>只用一台机器，发送一个请求，就可以打跨对方的服务器，这简直就是黑客梦寐以求的核武器。与之相比，什么 DDoS 弱爆了，动静大还花钱多。</p>
<p>这种攻击也有自己的名字：**ReDoS (RegEx Denial of Service)**。</p>
<p>由于正则表达式应用非常广泛，几乎存在于后端服务的各个部分，所以只要找到其中一个漏洞，就有机可趁。</p>
<p>试想一个场景，黑客发现了 WAF 中存在 ReDoS 漏洞，发送一个请求打垮了 WAF；你无法在短时间内定位这个问题，<em>甚至意识不到这是一次攻击</em>；为了保证业务的正常，你选择重启或者暂时关闭 WAF；在 WAF 失效期间，黑客利用 SQL 注入，拖走了你的数据库。而你，可能还完全蒙在鼓里。</p>
<p><em>由于开源软件和云服务的广泛使用，只保证自己写的正则表达式没有漏洞，也是不够的</em>。这是另外一个话题了，我们这里先只讨论自己可控范围内的正则。</p>
<h2 id="如何发现这类正则表达式？"><a href="#如何发现这类正则表达式？" class="headerlink" title="如何发现这类正则表达式？"></a>如何发现这类正则表达式？</h2><p><strong>解决问题的第一步，就是发现问题，而且要尽量发现所有问题</strong>，也就是所谓安全的发现能力。</p>
<p>指望人工 code review 来发现有问题的正则，自然是靠不住的。大部分开发者是没有这方面安全意识的，就算有意去找，人也不可能从复杂的正则表达式中找到问题所在。</p>
<p>这正是自动化工具大显身手的时候。</p>
<p>我们有以下两种自动化的方法来解决：</p>
<ul>
<li>  静态检测</li>
</ul>
<p>这类工具可以扫描代码中正则表达式，根据一定的算法，从中找出有灾难性回溯的正则。</p>
<p>比如<em>RXXR2</em>（<a href="https://link.zhihu.com/?target=http://www.cs.bham.ac.uk/%257Ehxt/research/rxxr2/">http://www.cs.bham.ac.uk/%7Ehxt/research/rxxr2/</a>），它是基于一篇 paper 中的算法来实现，把正则转换为ε-NFA，然后再进行搜索，但并不支持正则表达式的扩展语法，所以会有漏报。</p>
<ul>
<li>  动态 fuzzing</li>
</ul>
<p>fuzz 测试是一种通用的软件测试方法，通过长时间输入大量随机的数据，来检测软件是否有崩溃、内存泄漏等问题。</p>
<p>同样的，在正则的测试中我们也可以用到这种方法。我们可以根据已有的正则表达式来生成测试数据，也可以完全随机生成。</p>
<p><em>SlowFuzz</em> 是其中一个开源的工具，也是基于一篇 paper 的算法实现，本文最后会列出 paper，它是一个通用的工具，并没有针对正则的结构做处理，所以会有漏报。</p>
<p><em>SDLFuzzer</em> 是几年前微软开发的一个专门的 ReDoS 检测工具，但已经不再维护了。</p>
<p>这方面的工具可选择的不多，而且关注度不高。不过让我兴奋的是，在搜索资料的过程中，发现了南京大学几位老师和博士关于 ReDoS 的一篇paper，并且和 paper 一起开源了 <strong>ReScue</strong>这个工具： <a href="https://link.zhihu.com/?target=https://2bdenny.github.io/ReScue/">https://2bdenny.github.io/ReScue/</a>。这个工具已经找出了几个开源项目中的 ReDoS 漏洞。</p>
<p>下面是 paper 中对比测试的结果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-f0fcc9c46059705d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-32003a30f700d785.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h2 id="可否一劳永逸？"><a href="#可否一劳永逸？" class="headerlink" title="可否一劳永逸？"></a>可否一劳永逸？</h2><p>即使我们用了这类工具，有难免会有误报和漏报，那么有没有一劳永逸的方式来解决 ReDoS 呢？</p>
<p>那么我们就要回到<strong>问题产生的根源</strong>去寻找答案：<strong>正则引擎使用了回溯的方式来匹配。</strong></p>
<p>如果我们弃用这种方法，是不是就可以了呢？没错，已经有不少其他的正则引擎的实现，都可以一劳永逸的来解决。他们都<strong>放弃了回溯，用 NFA/DFA 自动机的方法来实现</strong>，优点是适合流式匹配，也更加安全，缺点不支持很多正则的扩展语法，比如 backreferences，好在这些一般也用不到。</p>
<ul>
<li>  Google RE2</li>
</ul>
<p>谷歌的 RE2 是其中完成度比较高开源项目。它支持 PCRE 的大部分语法，而且有 Go、Python、Perl、Node.js 等多种开发语言的库实现，上手和替换成本很低。</p>
<p>我们以 Perl 为例，看下 RE2 是否可以避免灾难性回溯问题。</p>
<p>我们先来看下这个结果对比图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-15ea93dc35cd94c5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>代码如下，感兴趣的可以自己试试看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time perl -e &#39;if (&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot; &#x3D;~ &#x2F;a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x2F;) &#123;print(&quot;hit&quot;);&#125;&#39;</span><br></pre></td></tr></table></figure>

<p><code>40.80s user 0.00s system 99% cpu 40.800 total</code></p>
<p>需要 40.8 秒才能跑完这个正则，期间 CPU 99%。</p>
<p>采用 RE2 之后，对比非常明显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time perl -e &#39;use re::engine::RE2; if (&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot; &#x3D;~ &#x2F;a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x2F;) &#123;print(&quot; hit&quot;);&#125;&#39;</span><br></pre></td></tr></table></figure>

<p><code>perl -e 0.00s user 0.00s system 34% cpu 0.011 total</code></p>
<ul>
<li>  Intel Hyperscan</li>
</ul>
<p>Intel Hyperscan 也是类似 RE2 的正则引擎，也有Perl、Python 等语言的库，上手难度不大。</p>
<p>只不过按照 Intel 的惯例，多了平台的绑定，只能跑在 x86 中。</p>
<p>如果非要说有什么独特的好处，可能是能够和 Intel 的指令集还有硬件更好的配合，有性能的提升，比如结合下自家的 DPDK。</p>
<p>开源的网络入侵检测工具 Snort，也用 Hyperscan 替换了之前的正则引擎，熟悉 Snort 的同学可以试试看。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><blockquote>
<p>这里有几篇正则表达式方面的 paper，感兴趣的可以作为扩展阅读。</p>
<ol>
<li> SlowFuzz: Automated Domain-Independent Detection of Algorithmic Complexity Vulnerabilities： <a href="https://link.zhihu.com/?target=https://arxiv.org/pdf/1708.08437.pdf">https://arxiv.org/pdf/1708.08437.pdf</a></li>
<li> Static Analysis for Regular Expression Exponential Runtime via Substructural Logics：<a href="https://link.zhihu.com/?target=http://www.cs.bham.ac.uk/%257Ehxt/research/redos_full.pdf">http://www.cs.bham.ac.uk/%7Ehxt/research/redos_full.pdf</a></li>
<li> ReScue: Crafting Regular Expression DoS Attacks：<a href="https://link.zhihu.com/?target=https://cs.nju.edu.cn/changxu/1_publications/ASE18.pdf">https://cs.nju.edu.cn/changxu/1_publications/ASE18.pdf</a></li>
<li> Regular Expression Matching Can Be Simple And Fast： <a href="https://link.zhihu.com/?target=https://swtch.com/~rsc/regexp/regexp1.html">https://swtch.com/~rsc/regexp/regexp1.html</a></li>
</ol>
</blockquote>
<blockquote>
<p>转载 ：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44425997">https://zhuanlan.zhihu.com/p/44425997</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">开发人员在线速查手册</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" class="post-meta-item leancloud_visitors" data-flag-title="开发人员在线速查手册" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>135</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>不管你是多么优秀的程序员，你都不可能记住一切。在你编写程序的过程中碰到问题需要查阅手册的时候，若有现成的在线手册可参考则可以为你节省很多时间。为了方便各位朋友，向大家推荐一个非常棒的在线手册索引网站——<a target="_blank" rel="noopener" href="http://overapi.com/">overapi.com</a>，这个网站收集了众多对开发人员非常有用的手册。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-bd3e11eb7a95a19d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/" class="post-title-link" itemprop="url">探索HTTP传输中gzip压缩</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/" class="post-meta-item leancloud_visitors" data-flag-title="探索HTTP传输中gzip压缩" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="为什么要开启gZip"><a href="#为什么要开启gZip" class="headerlink" title="为什么要开启gZip"></a>为什么要开启gZip</h3><p>我们给某人发送邮件时，我们在传输之前把自己的文件压缩一下，接收方收到文件后再去解压获取文件。这中操作对于我们来说都已经司空见惯。我们压缩文件的目的就是为了把传输文件的体积减小，加快传输速度。我们在 <code>http</code> 传输中开启 <code>gZip</code> 的目的也是如此，但是一般文章介绍 <code>gZip</code> 时候总是结合一些服务端配置(<code>nginx</code>)或者构建工具插件(<code>webpack</code>)来说，列出一大堆配置让人看的云里雾里，以至于到最后还没搞懂 <code>为什么用</code>，<code>怎么用</code> 这些问题。</p>
<h3 id="http-与-gZip"><a href="#http-与-gZip" class="headerlink" title="http 与 gZip"></a>http 与 gZip</h3><p>我们下面去探讨一下这些问题</p>
<h4 id="gZip-文件怎么通讯"><a href="#gZip-文件怎么通讯" class="headerlink" title="gZip 文件怎么通讯"></a><code>gZip</code> 文件怎么通讯</h4><p>我们传输压缩文件给别人时候一般都带着后缀名 <code>.rar</code>, <code>.zip</code>之类，对方在拿到文件后根据相应的后缀名选择不同的解压方式然后去解压文件。我们在 <code>http</code> 传输时候解压文件的这个角色的扮演者就是我们使用的浏览器，但是浏览器怎么分辨这个文件是什么格式，应该用什么格式去解压呢？</p>
<p>在 <code>http／1.0</code> 协议中关于服务端发送的数据可以配置一个 <code>Content-Encoding</code> 字段，这个字段用于说明数据的压缩方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Encoding: compress</span><br><span class="line">Content-Encoding: deflate</span><br></pre></td></tr></table></figure>

<p>客户端在接受到返回的数据后去检查对应字段的信息，然后根据对应的格式去做相应的解码。客户端在请求时，可以用 <code>Accept-Encoding</code> 字段说明自己接受哪些压缩方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>

<p>我们在浏览器的控制台中可以看到请求的相关信息</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-e5ec64cbfb3c270e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h5 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h5><p>提到浏览器作为一个前端就不由自主的会想一个问题，会不会有浏览器不支持呢。<code>HTTP/1.0</code> 是1996年5月发布的。好消息是基本不用考虑兼容性的问题，几乎所有浏览器都支持它。值得一提的是 <code>ie6</code>的早起版本中存在一个会破坏 <code>gZip</code>的错误，后面 <code>ie6</code>本身在 <code>WinXP SP2</code> 中修复了这个问题，而且用这个版本的用户数量也很少。</p>
<h4 id="谁去压缩文件"><a href="#谁去压缩文件" class="headerlink" title="谁去压缩文件"></a>谁去压缩文件</h4><p>这件事看起来貌似只能服务端来做，我们在网上看到最多的也是诸如 <code>nginx</code> 开启 <code>gZip</code> 配置之类的文章，但是现在前端流行 <code>spa</code> 应用, 用 <code>react</code>, <code>vue</code> 之类的框架时候总伴随这一套自己的脚手架,一般用 <code>webpack</code> 作为打包工具，其中可以配置插件 如<a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/compression-webpack-plugin">compression-webpack-plugin</a> 可以让我们把生成文件进行 <code>gZip</code> 等压缩并生成对应的压缩文件，而我们应用在构架时候有可能也会在服务区和前端文件中放置一层 <code>node</code> 应用来进行接口鉴权和文件转发。<code>nodejs</code>中我们熟悉的<code>express</code> 框架中也有一个<a target="_blank" rel="noopener" href="https://github.com/expressjs/compression">compression</a> 中间件，可以开启<code>gZip</code>,一时间看的人眼花缭乱，到底应该用谁怎么用呢？</p>
<h5 id="服务端响应请求时候压缩"><a href="#服务端响应请求时候压缩" class="headerlink" title="服务端响应请求时候压缩"></a>服务端响应请求时候压缩</h5><p>其实 <code>nginx</code> 压缩和 <code>node</code> 框架中用中间件去压缩都是一样的，当我们点击网页发送一个请求时候，我们的服务端会找到对应的文件，然后对文件进行压缩返回压缩后的内容【<em>当然可以利用缓存减少压缩次数</em>】，并配置好我们上面提到的 <code>Content-Encoding</code> 信息。对于一些应用在构架时候并没有上游代理层，比如服务端就一层 <code>node</code> 就可以直接用自己本身的压缩插件对文件进行压缩，如果上游配有有 <code>nginx</code> 转发处理层，最好交给 <code>nginx</code> 来处理这些，因为它们有专门为此构建的内容，可以更好的利用缓存并减小开销（很多使用c语言编写的）。</p>
<p>我们看一些 <code>nginx</code> 中开启 <code>gZip</code> 压缩的一部分配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启gzip</span><br><span class="line">gzip on;</span><br><span class="line"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span><br><span class="line">gzip_min_length 1k;</span><br><span class="line"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明</span><br><span class="line">gzip_comp_level 2;</span><br><span class="line"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span><br><span class="line">gzip_types text&#x2F;plain application&#x2F;javascript application&#x2F;x-javascript text&#x2F;css application&#x2F;xml text&#x2F;javascript;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="应用构建时候压缩"><a href="#应用构建时候压缩" class="headerlink" title="应用构建时候压缩"></a>应用构建时候压缩</h5><p>既然服务端都可以做了为什么 <code>webpack</code> 在打包前端应用时候还有这样一个压缩插件呢，我们可以在上面 <code>nginx</code> 配置中看到 <code>gzip_comp_level 2</code> 这个配置项，上面也有注释写道 <code>1-10</code> 数字越大压缩效果越好，但是会耗费更多的CPU和时间，我们压缩文件除了减少文件体积大小外，也是为了减少传输时间，如果我们把压缩等级配置的很高，每次请求服务端都要压缩很久才回返回信息回来，不仅服务器开销会增大很多，请求方也会等的不耐烦。但是现在的 <code>spa</code> 应用既然文件都是打包生成的，那如果我们在打包时候就直接生成高压缩等级的文件，作为静态资源放在服务器上，接收到请求后直接把压缩的文件内容返回回去会怎么样呢？</p>
<p><code>webpack</code> 的 <code>compression-webpack-plugin</code> 就是做这个事情的，配置起来也很简单只需要在装置中加入对应插件,简单配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const CompressionWebpackPlugin &#x3D; require(&#39;compression-webpack-plugin&#39;);</span><br><span class="line"></span><br><span class="line">webpackConfig.plugins.push(</span><br><span class="line">    new CompressionWebpackPlugin(&#123;</span><br><span class="line">      asset: &#39;[path].gz[query]&#39;,</span><br><span class="line">      algorithm: &#39;gzip&#39;,</span><br><span class="line">      test: new RegExp(&#39;\\.(js|css)&#x2F;article&gt;),</span><br><span class="line">      threshold: 10240,</span><br><span class="line">      minRatio: 0.8</span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>webpack</code> 打包完成后生成打包文件外还会额外生成 <code>.gz</code> 后缀的压缩文件</p>
<p>[图片上传失败…(image-b14f20-1614231793629)] </p>
<p>那么这个插件的压缩等级是多少呢，我们可以在<a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/compression-webpack-plugin/blob/master/src/index.js">源码</a>中看到默认的 <code>level</code> 是 <strong>9</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const zlib &#x3D; require(&#39;zlib&#39;);</span><br><span class="line">this.options.algorithm &#x3D; zlib[this.options.algorithm];</span><br><span class="line">...</span><br><span class="line">this.options.compressionOptions &#x3D; &#123;</span><br><span class="line">    level: options.level || 9,</span><br><span class="line">    flush: options.flush</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到压缩使用的是 <code>zlib</code> 库，而 <code>zlib</code> 分级来说，默认是 6 ，最高的级别就是<code>9 Best compression (also zlib.Z_BEST_COMPRESSION)</code>,因为我们只有在上线项目时候才回去打包构建一次，所以我们在构建时候使用最高级的压缩方式压缩多耗费一些时间对我们来说根本没任何损耗，而我们在服务器上也不用再去压缩文件，只需要找到相应已经压缩过的文件直接返回就可以了。</p>
<h6 id="服务端怎么找到这些文件"><a href="#服务端怎么找到这些文件" class="headerlink" title="服务端怎么找到这些文件"></a>服务端怎么找到这些文件</h6><p>在应用层面解决这个问题还是比较简单的，比如上述压缩文件会产生<code>index.css</code>, <code>index.js</code>的压缩文件，在服务端简单处理可以判断这两个请求然后给予相对应的压缩文件。以 <code>node</code> 的 <code>express</code> 为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">app.get([&#39;&#x2F;index.js&#39;,&#39;&#x2F;index.css&#39;], function (req, res, next) &#123;</span><br><span class="line">  req.url &#x3D; req.url + &#39;.gz&#39;</span><br><span class="line">  res.set(&#39;Content-Encoding&#39;, &#39;gzip&#39;)</span><br><span class="line">  res.setHeader(&quot;Content-Type&quot;, generateType(req.path)) &#x2F;&#x2F; 这里要根据请求文件设置content-type</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面我们可以给请求返回 <code>gZip</code> 压缩后的数据了，当然上面的局限性太强也不可取，但是对于处理这个方面需求也已经有很多库存在,<code>express</code> 有 <a target="_blank" rel="noopener" href="https://github.com/tkoenig89/express-static-gzip">express-static-gzip</a> 插件 <code>koa</code> 的 <code>koa-static</code> 则默认自带对 <code>gZip</code> 文件的检测，基本原理就是对请求先检测 <code>.gz</code>后缀的文件是否存在，再去根据结果返回不同的内容。</p>
<h4 id="哪些文件可以被-gZip-压缩"><a href="#哪些文件可以被-gZip-压缩" class="headerlink" title="哪些文件可以被 gZip 压缩"></a>哪些文件可以被 gZip 压缩</h4><p><code>gZip</code> 可以压缩所有的文件，但是这不代表我们要对所有文件进行压缩，我们写的代码（<code>css,js</code>）之类的文件会有很好的压缩效果，但是图片之类文件则不会被 <code>gzip</code> 压缩太多，因为它们已经内置了一些压缩，一些文件（比如一些已经被压缩的像.zip文件那种）再去压缩可能会让生成的文件体积更大一些。当然已经很小的文件也没有去压缩的必要了。</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>能开启 <code>gZip</code> 肯定是要开启的，具体使用在请求时候实时压缩还是在构建时候去生成压缩文件，就要看自己具体业务情况。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/20762094/how-are-zlib-gzip-and-zip-related-what-do-they-have-in-common-and-how-are-they/20765054#20765054">How are zlib, gzip and zip related? What do they have in common and how are they different?</a></li>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/38587698/webpack-gzip-vs-express-gzip?s=1%7C140.9128">webpack gzip vs express gzip</a></li>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16691506/what-is-gzip-compression">What is gZip compression?</a></li>
<li>  <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/08/http.html">HTTP 协议</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">标准盒模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="标准盒模型" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="1、一个盒子的构成："><a href="#1、一个盒子的构成：" class="headerlink" title="1、一个盒子的构成："></a>1、一个盒子的构成：</h5><ul>
<li><p>盒子中的内容：content 宽=width 高=height</p>
</li>
<li><p>盒子的边框：border</p>
</li>
<li><p>盒子边框与内容之间的距离：称为填充—padding 内边距（内补丁）</p>
</li>
<li><p>如果有多个盒子存在，盒子与盒子之间的距离：称为边界—margin，外边距（外补丁）</p>
</li>
<li><p>整个盒子模型在网页中所占的宽度：左边界+左边框+左填充+内容+右填充+右边框+右边<br>界<br><img src="https://upload-images.jianshu.io/upload_images/10024246-50fe38676d0998e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p>关于如何切图：</p>
<blockquote>
<p>PC：先看全图分块切，<br>移动端：看所有图片找出共同模块，分组切</p>
</blockquote>
</li>
<li><p>关于适配问题：<br><img src="https://upload-images.jianshu.io/upload_images/10024246-eded6984b876f273.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
</ul>
<h5 id="2、弹性布局"><a href="#2、弹性布局" class="headerlink" title="2、弹性布局"></a>2、弹性布局</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display: flex | inline-flex; (适用于父类容器元素上)</span><br></pre></td></tr></table></figure>
<p>定义一个 flex 容器，内联或者根据指定的值，来作用于下面的子类容器。</p>
<ul>
<li> box：将对象作为弹性伸缩盒显示。（伸缩盒最老版本）</li>
<li>  inline-box：将对象作为内联块级弹性伸缩盒显示。（伸缩盒最老版本）</li>
<li> flexbox：将对象作为弹性伸缩盒显示。（伸缩盒过渡版本）</li>
<li> inline-flexbox：将对象作为内联块级弹性伸缩盒显示。（伸缩盒过渡版本）</li>
<li> flex：将对象作为弹性伸缩盒显示。（伸缩盒最新版本）</li>
<li> inline-flex：将对象作为内联块级弹性伸缩盒显示。（伸缩盒最新版本）<h5 id="2-1-H5-用的老版本伸缩盒模型-display-box"><a href="#2-1-H5-用的老版本伸缩盒模型-display-box" class="headerlink" title="2.1 H5 用的老版本伸缩盒模型 display: box;"></a>2.1 H5 用的老版本伸缩盒模型 display: box;</h5>常用属性：</li>
<li> <strong>box-flex:子元素的之间的比例。</strong><br>可以定义把父元素分成几份，如一个父 div 的 width：400px；里面有三<br>个子 div，分别定义-webkit-box-flex：2; -webkit-box-flex：1; -webkitbox-flex：1;那么三个子<br>div 的宽度会自动充满整个父盒子，宽度分别是<br>400*(2/2+1+1)=200px; 400*(1/2+1+1)=100px; 400*(1/2+1+1)=100p<br>x;</li>
<li> <strong>box-orient: 用来确定子元素的方向，是横着排还是竖着走。</strong><br>可选的值有：<strong>horizontal、vertical、inline-axis、block-axis、inherit</strong><br>Horizontal 与 inline-axis 的表现是一致的，让子元素横排。<br>Vertical 与 block-axis 的表现是一致的，让子元素纵列。<br>l box-direction：是用来确定子元素的排列顺序。<br>可选的值有：<strong>normal、reverse、inherit</strong><br>Normal 是默认值，表示按照正常顺序排列，从上到下，从左到右。<br>Reverse 表示与正常顺序相反。</li>
<li> <strong>box-align：与 box-pack 都是决定盒子内部剩余空间怎么使用的，</strong><br>决定了父容器里子容器的垂直对齐方式。<br>可选的值有：<strong>start、end、center、baseline、stretch</strong><br>Start 表示居顶对齐。<br>End 表示居底对齐。<br>Center：表示居中对齐。<br>Baseline：表示与基线对齐。<br>Stretch 为默认值，表示拉伸，拉伸到与父容器等高。</li>
<li> <strong>box-pack：决定了父标签水平遗留空间的使用。即父容器里子容器</strong><br>的水平对齐方式。<br>可选的值有：start、end、center、justify<br>Start 为默认值，表示水平居左对齐。<br>End 表示水平居右对齐。<br>Center：表示水平居中对齐。<br>Justify 表示水平两端对齐。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-182dfad14cfa9932.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></li>
</ul>
<h5 id="2-2-新版本-display-flex"><a href="#2-2-新版本-display-flex" class="headerlink" title="2.2 新版本 display:flex;"></a>2.2 新版本 display:flex;</h5><p>常用属性：</p>
<ul>
<li><strong>flex-direction: row | column | row-reverse | column-reverse</strong><br>决定主轴的方向（即项目的排列方向）。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-bec5ad15cd8fdedb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></li>
</ul>
<p>flex-warp: nowrap | wrap | wrap-reverse;<br>定义是否要换行，如何换行。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-f05c3c69d62c43a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<ul>
<li><p><strong>justify-content:flex-start|flex-end|center|space-between|space-around</strong><br>定义项目在主轴上的对齐方式<br><img src="https://upload-images.jianshu.io/upload_images/10024246-c9b49800aa86f342.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p><strong>align-items: flex-start |flex-end |center |baseline |stretch;</strong><br>定义项目在交叉轴上如何对齐<br><img src="https://upload-images.jianshu.io/upload_images/10024246-0ecf0d58bb9d8ff1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p><strong>flex-flow: flex-direction flex-warp;</strong><br>以上属性均加在父盒子上生效。下边两个是加在子元素上生效的属性：</p>
</li>
<li><p> <strong>flex: 是 flex-grow，flex-shrink，flex-basis 三个属性的简写。</strong><br>默认值：0 1 auto；<br>设置或检索伸缩盒对象的子元素如何分配空间。后两个属性可省。<br>如果缩写 flex:1, 则其计算值为：1 1 0</p>
<blockquote>
<p>flex-grow 属性定义项目的放大比例，默认为 0，即如果存在剩余空间，也不放大。<br>flex-shrink 属性定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小。<br>flex-basis 属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览<br>器根据这个属性，计算主轴是否有多余空间。它的默认值为 auto，即项目的本来大小。</p>
</blockquote>
</li>
<li><p><strong>align-self: auto |flex-start |flex-end |center |baseline |stretch;</strong><br>允许单个项目有与其他项目不一样的对齐方式，可覆盖 align-items 属性。默认<br>值为auto，表示继承父元素的align-items属性。除auto外，其余同align-items。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-ac538224c8c5f08f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
</ul>
<p>总结：<br>伸缩盒模型<br>父元素 子元素<br>方向 主轴对齐(x) 交叉轴对齐(y) 分配空间<br>box<br>box-orient<br>box-pack box-align box-flex<br>box-direction<br>flex flex-direction Justify-content align-items flex</p>
<blockquote>
<p><code>注：flex 新增属性——flex-wrap(是否换行),align-self（子元素自己的对齐方式）</code></p>
</blockquote>
<p>参考网址：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://caibaojian.com/flexbox-guide.html">http://caibaojian.com/flexbox-guide.html</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a><br><a target="_blank" rel="noopener" href="http://www.w3cplus.com/css3/css3-flexbox-layout.html">http://www.w3cplus.com/css3/css3-flexbox-layout.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">移动应用界面设计的尺寸设置及规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/" class="post-meta-item leancloud_visitors" data-flag-title="移动应用界面设计的尺寸设置及规范" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>一、android篇</strong></p>
<p><strong>1、android分辨率</strong></p>
<p>Android的多分辨率，一向是设计师和开发者非常头疼的事儿。尽管如此，对于多分辨造成的复杂问题，也是大家要优先解决的。Android支持多种不同的dpi模式：ldpi 、mdpi 、hdpi 、xhdpi 、xxhdpi 、xxxhdpi<br><img src="https://upload-images.jianshu.io/upload_images/10024246-b58e0e6c4419b53b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>注意，ppi、dpi 是密度单位，不是度量单位 ：</p>
<ul>
<li><p>  ppi (pixels per inch)：图像分辨率 （在图像中，每英寸所包含的像素数目）</p>
</li>
<li><p>  dpi (dots per inch)： 打印分辨率 （每英寸所能打印的点数，即打印精度）</p>
</li>
</ul>
<p>dpi主要应用于输出，重点是打印设备上；ppi对于设计师应该比较熟悉，photoshop画布的分辨率常设置为72像素/英寸，这个单位其实就是ppi 。尽管概念不同，但是对于移动设备的显示屏，可以看作ppi=dpi 。</p>
<p>ppi的运算方式是：PPI = √（长度像素数² + 宽度像素数²） / 屏幕对角线英寸数。即：长、宽各自平方之和的开方，再除以屏幕对角线的英寸数。</p>
<p>以iphone5为例，其ppi=√（1136px² + 640px²）/4 in=326ppi（视网膜Retina屏）</p>
<p>对于android手机，一个不确切的分法是，720 x 1280 的手机很可能接近 320 dpi （xhdpi模式），480 x 800 的手机很可能接近 240 dpi （hdpi模式），而320 x 480 的手机则很接近 160 dpi（mdpi模式）。</p>
<p><strong>2、单位换算方法</strong></p>
<p>android开发中，文字大小的单位是sp，非文字的尺寸单位用dp，但是我们在设计稿用的单位是px。这些单位如何换算，是设计师、开发者需要了解的关键。</p>
<ul>
<li><p>  dp：Density-independent pixels，以160PPI屏幕为标准，则1dp=1px。dp和px的换算公式 ：dp*ppi/160 = px。对于320ppi的屏幕，1dp x 320ppi/160 = 2px。</p>
</li>
<li><p>  sp：Scale-independent pixels，它是安卓的字体单位，以160PPI屏幕为标准，当字体大小为 100%时， 1sp=1px。sp 与 px 的换算公式：sp*ppi/160 = px。对于320ppi的屏幕，1sp x 320ppi/160 = 2px。</p>
</li>
</ul>
<p>简单理解的话，px（像素）是我们UI设计师在PS里使用的，同时也是手机屏幕上所显示的，dp是开发写layout的时候使用的尺寸单位。</p>
<p><strong>为什么要把sp和dp代替px？</strong>原因是他们不会因为ppi的变化而变化，在相同物理尺寸和不同ppi下，他们呈现的高度大小是相同。也就是说更接近物理呈现，而px则不行。</p>
<p><strong>根据单位换算方法，可总结出：</strong></p>
<p>当运行在mdpi下时，1dp=1px ：也就是说设计师在PS里定义一个item高48px，开发就会定义该item高48dp ；</p>
<p>当运行在hdpi模式下时，1dp=1.5px ：也就是说设计师在PS里定义一个item高72px，开发就会定义该item高48dp ；</p>
<p>当运行在xhdpi模式下时，1dp=2px ：也就是说设计师在PS里定义一个item高96px，开发就会定义该item高48dp ；</p>
<p>当你的app需要适配多个dpi模式的时候，请参考图1的比例进行换算 。</p>
<p><strong>3、设计稿基本元素的尺寸设置</strong></p>
<p>为了适应多分辨率的手机，理想的方式是为每种分辨率做一套设计稿，包括所用到的icon、设计稿标注等。但在实际开发中，这种方法耗时耗力。所以通常会选择折中的方法。</p>
<p><strong>方法一</strong>：在标准基础上（比如xhdpi）开始，然后放大或缩小，以适应到其他尺寸。不足之处是，对于更高分辨率的手机，图标被放大后会导致质量不高。</p>
<p><strong>方法二：</strong>以最高分辨率为基准设计，然后缩小适应到所需的小分辨率上。缺点是，图标等若都最大尺寸，加载时速度慢且耗费流量较多，对于小分辨率的用户也不够好。</p>
<p>结合友盟的分辨率占比数据、也为了方便换算到android开发中的尺寸单位，<strong>推荐设计稿的画布尺寸选用 720X1280 ，分辨率仍旧为72ppi（像素/英寸）。</strong></p>
<p>在android规范中对于导航栏、工具栏等的尺寸没有明确的规定。但根据48dp原则，以及一些主流的android应用的截图分析，总结一下尺寸要求：</p>
<p><strong>状态栏高度</strong>：50 px</p>
<p><strong>导航栏、操作栏高度</strong>：96 px=48dp x 2</p>
<p><strong>主菜单栏高度</strong>：96 px</p>
<p><strong>内容区域高度</strong>：1038 px （1280-50-96-96=1038）</p>
<p>Android最近出的手机都几乎去掉了实体键，把功能键移到了屏幕中，高度也和菜单栏一样为：96 px</p>
<p><strong>4、图标和字体大小（来自官方规范文档）</strong></p>
<p>a、启动图标（home页或app列表页）</p>
<p>整体大小为48 x 48 dp<br><img src="https://upload-images.jianshu.io/upload_images/10024246-a69bccead1f7a395.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>b、操作栏图标，代表用户在app中可以使用到的最重要的图标</p>
<p>整体大小为32 x 32 dp ，图形实际区域为 24 x 24 dp</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-60ade459f9c5e979.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>c、小图标/场景图标，提供操作或特定项目的状态。</p>
<p>比如gmail app的星型标记、一些内容展开收起用到的向下向上的图标等。整体大小为16 x 16 dp ，图形实际区域为 12 x 12 dp 。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-34aefc77df01265b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>d、通知图标</p>
<p>如果app有通知，要提供一个有新通知时显示在状态栏的通知图标。整体大小为24 x 24 dp ，图形实际区域为 22 x 22 dp 。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-13dccc1657345b7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>注：android规范提供的尺寸单位是dp，若设计稿尺寸设为720 x 1280 ，图标大小需在规范要求的尺寸数字上乘以2。比如操作栏图标32 x 32 dp ，则设计稿上应该是64 x 64 px 。</p>
<p>e、字体大小</p>
<p>Android规范中的要求如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-37292659f59b5e75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>前面提到Android开发中的字号单位是sp，而换算关系是 sp*ppi/160 = px 。所以720 x 1280尺寸的设计稿上，字体大小可选择为 24px 、28px 、32px 、36px ，主要根据文字的重要程度来选择，特殊情况下也可能选择更大或更小的字体。</p>
<p>f、其他尺寸要求</p>
<p>通常把48dp作为可触摸的UI元件的标准。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-41912e664c23c31c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p><strong>为什么要用48dp呢？一般来说，48dp转化为一个物理尺寸约9毫米。通常建议目标大小为7-10毫米，以方便用户手指能准确并且舒适触摸目标区域</strong>。</p>
<p>如果你设计的元素高和宽至少48dp，你就可以保证：</p>
<p>（1）触摸目标绝不会比建议的最低目标（7mm）小，无论在什么屏幕上显示。</p>
<p>（2）在整体信息密度和触摸目标大小之间取得了一个很好的平衡。</p>
<p>另外，每个UI元素之间的空白通常是8dp 。</p>
<p><strong>二、iOS篇</strong></p>
<p><strong>1、分辨率</strong></p>
<p>iPhone 界面尺寸：</p>
<table>
<thead>
<tr>
<th align="center">设备</th>
<th align="center">屏幕尺寸（英寸）</th>
<th align="center">逻辑分辨率（Point）</th>
<th align="center">缩放倍率（Scale Factor）</th>
<th align="center">像素分辨率（Pixel）</th>
<th align="center">屏幕像素密度（PPI）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">iPhone 3GS</td>
<td align="center">3.5</td>
<td align="center">320*480</td>
<td align="center"><a href="mailto:&#117;&#115;&#101;&#114;&#64;&#x31;&#x78;&#46;&#x70;&#x6e;&#103;">&#117;&#115;&#101;&#114;&#64;&#x31;&#x78;&#46;&#x70;&#x6e;&#103;</a></td>
<td align="center">320*480</td>
<td align="center">163</td>
</tr>
<tr>
<td align="center">iPhone 4/4s</td>
<td align="center">3.5</td>
<td align="center">320*480</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#x72;&#64;&#50;&#120;&#46;&#112;&#110;&#x67;">&#117;&#x73;&#x65;&#x72;&#64;&#50;&#120;&#46;&#112;&#110;&#x67;</a></td>
<td align="center">640*960</td>
<td align="center">330</td>
</tr>
<tr>
<td align="center">iPhone 5/5s/5c</td>
<td align="center">4.0</td>
<td align="center">320*568</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#114;&#x40;&#50;&#120;&#x2e;&#112;&#110;&#x67;">&#117;&#x73;&#x65;&#114;&#x40;&#50;&#120;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone SE</td>
<td align="center">4.0</td>
<td align="center">320*568</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#x72;&#x40;&#50;&#120;&#x2e;&#112;&#110;&#x67;">&#117;&#x73;&#x65;&#x72;&#x40;&#50;&#120;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 6</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#x32;&#120;&#46;&#112;&#110;&#103;">&#x75;&#x73;&#101;&#x72;&#64;&#x32;&#120;&#46;&#112;&#110;&#103;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 6s</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#114;&#64;&#50;&#x78;&#46;&#112;&#110;&#103;">&#117;&#x73;&#x65;&#114;&#64;&#50;&#x78;&#46;&#112;&#110;&#103;</a></td>
<td align="center">750*1334</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 7</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#117;&#115;&#101;&#114;&#64;&#x32;&#120;&#46;&#112;&#110;&#x67;">&#117;&#115;&#101;&#114;&#64;&#x32;&#120;&#46;&#112;&#110;&#x67;</a></td>
<td align="center">750*1334</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 8</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#x75;&#115;&#101;&#x72;&#x40;&#50;&#x78;&#x2e;&#x70;&#110;&#x67;">&#x75;&#115;&#101;&#x72;&#x40;&#50;&#x78;&#x2e;&#x70;&#110;&#x67;</a></td>
<td align="center">750*1334</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 6 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#117;&#115;&#101;&#x72;&#x40;&#51;&#x78;&#46;&#x70;&#110;&#103;">&#117;&#115;&#101;&#x72;&#x40;&#51;&#x78;&#46;&#x70;&#110;&#103;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 6s Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#x75;&#115;&#101;&#114;&#x40;&#51;&#x78;&#x2e;&#x70;&#110;&#103;">&#x75;&#115;&#101;&#114;&#x40;&#51;&#x78;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 7 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#117;&#115;&#101;&#x72;&#x40;&#x33;&#120;&#46;&#112;&#110;&#x67;">&#117;&#115;&#101;&#x72;&#x40;&#x33;&#120;&#46;&#112;&#110;&#x67;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 8 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#x75;&#115;&#x65;&#114;&#x40;&#51;&#x78;&#46;&#x70;&#110;&#103;">&#x75;&#115;&#x65;&#114;&#x40;&#51;&#x78;&#46;&#x70;&#110;&#103;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone X</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#x75;&#115;&#101;&#x72;&#x40;&#x33;&#x78;&#x2e;&#x70;&#x6e;&#103;">&#x75;&#115;&#101;&#x72;&#x40;&#x33;&#x78;&#x2e;&#x70;&#x6e;&#103;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone XS</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#x75;&#115;&#x65;&#x72;&#x40;&#51;&#120;&#46;&#112;&#x6e;&#103;">&#x75;&#115;&#x65;&#x72;&#x40;&#51;&#120;&#46;&#112;&#x6e;&#103;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone XR</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#x32;&#120;&#x2e;&#x70;&#x6e;&#x67;">&#x75;&#x73;&#101;&#x72;&#64;&#x32;&#120;&#x2e;&#x70;&#x6e;&#x67;</a></td>
<td align="center">828*1792</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone XS Max</td>
<td align="center">6.5</td>
<td align="center">736*1344</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#x72;&#64;&#x33;&#120;&#46;&#x70;&#x6e;&#103;">&#117;&#x73;&#x65;&#x72;&#64;&#x33;&#120;&#46;&#x70;&#x6e;&#103;</a></td>
<td align="center">1242*2688</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 11</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#50;&#x78;&#x2e;&#112;&#110;&#x67;">&#x75;&#x73;&#101;&#x72;&#64;&#50;&#x78;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">828*1792</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 11 Pro</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#x72;&#64;&#51;&#x78;&#46;&#112;&#x6e;&#103;">&#117;&#x73;&#x65;&#x72;&#64;&#51;&#x78;&#46;&#112;&#x6e;&#103;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 11 Pro Max</td>
<td align="center">6.5</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#x72;&#64;&#51;&#120;&#46;&#x70;&#110;&#x67;">&#117;&#x73;&#101;&#x72;&#64;&#51;&#120;&#46;&#x70;&#110;&#x67;</a></td>
<td align="center">1242*2688</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 12</td>
<td align="center">6.1</td>
<td align="center">390*844</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#114;&#64;&#x33;&#x78;&#x2e;&#112;&#110;&#x67;">&#x75;&#x73;&#101;&#114;&#64;&#x33;&#x78;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">1170*2532</td>
<td align="center">460</td>
</tr>
<tr>
<td align="center">iPhone 12 mini</td>
<td align="center">5.4</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#x72;&#x40;&#x33;&#x78;&#x2e;&#112;&#x6e;&#x67;">&#117;&#x73;&#101;&#x72;&#x40;&#x33;&#x78;&#x2e;&#112;&#x6e;&#x67;</a></td>
<td align="center">1080*2340</td>
<td align="center">476</td>
</tr>
<tr>
<td align="center">iPhone 12 Pro</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#46;&#x70;&#x6e;&#103;">&#117;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#46;&#x70;&#x6e;&#103;</a></td>
<td align="center">1170*2532</td>
<td align="center">460</td>
</tr>
<tr>
<td align="center">iPhone 12 Pro Max</td>
<td align="center">6.7</td>
<td align="center">428*926</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#x78;&#x2e;&#x70;&#x6e;&#x67;">&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#x78;&#x2e;&#x70;&#x6e;&#x67;</a></td>
<td align="center">1284*2778</td>
<td align="center">458</td>
</tr>
</tbody></table>
<p>iPad 界面尺寸：1024×768、2048×1536</p>
<p>（以上单位都是像素，至于分辨率一般网页UI和移动UI基本上都只要 72 ppi）</p>
<p><strong>2、单位换算px、pt</strong></p>
<p>这里需要先区分pt、px，pt(磅值)是物理长度单位，指的是72分之一英寸。手机上看来同一大小的字磅值是一样的，但是换算成不同分辨率手机的字号px值不一样。（px=pt*ppi/72）</p>
<p>iPhone在出retina屏(也就是4S)之前的屏幕像素是320x480px，屏幕密度是163ppi，4S的屏幕像素是640x960px，屏幕密度是326ppi，翻了一倍。iPhone5的ppi没有变化，兼容性方面要增加类似首屏画面等程序上的判断。</p>
<p>在iPhone界面上元素的定位、尺寸是通过一个单位point，而非px，屏幕上固定有320x480pt，retina屏两倍的分辨率改变的只是pt和px之间的比例而已，这样就能实现不改变程序，只上传两套图片就兼容两个分辨率。</p>
<p><strong><strong>在设计的时候并不是每个尺寸都要做一套，尺寸按自己的手机尺寸来设计，比较方便预览效果，一般用 640×960 或者 640×1136 的尺寸设计。其中设计稿的画布分辨率设为默认的72ppi（此时1px=1pt ），所以设计师可以统一采用px为单位。<br>开发拿到设计稿时，将上面标注的以px为单位的字号大小、图像尺寸除以2，就是非retina屏上的pt值，这样在retina屏上也可以根据此pt值换算对应的px大小，以确保不同的分辨率下有合适的效果。</strong></strong></p>
<p><strong>3、基本元素的尺寸设置</strong></p>
<p>iPhone的APP界面一般由四个元素组成，分别是：状态栏、导航栏、主菜单栏以及中间的内容区域。</p>
<p>这里取用 640×960 的尺寸设计，那我们就说说在这个尺寸下这些元素的尺寸：</p>
<p>状态栏：就是我们经常说的信号、运营商、电量等显示手机状态的区域，其高度为：40 px</p>
<p>导航栏：显示当前界面的名称，包含相应的功能或者页面间跳转的按钮，其高度为：88 px</p>
<p>主菜单栏：类似于页面的主菜单，提供整个应用的分类内容的快速跳转，其高度为：98 px</p>
<p>内容区域：展示应用提供的相应内容，整个应用中布局变更最为频繁的，其高度为：734 px=960-40-88-98</p>
<p>以上尺寸适用于 iPhone 4、4S，iPhone5/5s 的 640×11136 的尺寸，其实就是中间的内容区域高度增加到：910 px，其他尺寸也同上。</p>
<p><strong>4、常用图像、图标大小（来自官方规范文档）</strong></p>
<p>单位：像素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-1b7ce723077960fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="移动应用界面设计的尺寸设置及规范_"></p>
<p><strong>5、字体大小</strong></p>
<p>iOS交互设计规范文档上，对字体大小没有做严格的数值规定，只提供了一些指导原则：</p>
<p>单位：点pt</p>
<p>– 即便用户选择了最小文字大小，文字也不应小于 22 点。作为对照，正文样式在大字号下使用 34 点字体大小作为默认文字大小设置。</p>
<p>– 通常来说，每一档文字大小设置的字体大小和行间距的差异是 2 点。例外情况是两个标题样式，在最小、小和中等设置时都使用相同字体大小、行间距和字间距。</p>
<p>– 在最小的三种文字大小中，字间距相对宽阔；在最大的三种文字大小中，字间距相对紧密。</p>
<p>– 标题和正文样式使用一样的字体大小。为了将其和正文样式区分，标题样式使用加粗效果。</p>
<p>– 导航控制器中的文字使用和大号的正文样式文字大小（明确来说，是 34 点）。</p>
<p>– 文本通常使用常规体和中等大小，而不是用细体和粗体。</p>
<p>百度用户体验做过的一个小调查：</p>
<p>单位：像素px<br><img src="https://upload-images.jianshu.io/upload_images/10024246-53edeaa9f75645e5.gif?imageMogr2/auto-orient/strip" alt="图片描述" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>还有个方法就是找你觉得好的APP应用，手机截图后放进PS自己对比调节字体大小。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/CSS3%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/CSS3%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">CSS3测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/CSS3%E6%B5%8B%E8%AF%95/" class="post-meta-item leancloud_visitors" data-flag-title="CSS3测试" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>25k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>23 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://upload-images.jianshu.io/upload_images/10024246-e54779fc756f5400.gif?imageMogr2/auto-orient/strip"><br>上边的“图像”并非图片，而是纯CSS 。转载外部网站<a target="_blank" rel="noopener" href="https://purecss3.net/doraemon/doraemon_css3.html">点这里</a>由于被墙，源代码copy如下：</p>
<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;!-- saved from url&#x3D;(0048)https:&#x2F;&#x2F;purecss3.net&#x2F;doraemon&#x2F;doraemon_css3.html --&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;ja&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;title&gt;CSS3 ドラえもん - Pure CSS Design&lt;&#x2F;title&gt;</span><br><span class="line">	&lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;国民的キャラクターである「ドラえもん」を画像を使わずCSS3だけで書いてみた！&quot;&gt;</span><br><span class="line">	&lt;meta name&#x3D;&quot;keywords&quot; content&#x3D;&quot;CSS3,ドラえもん,CSS,Doraemon,ドラ&quot;&gt;</span><br><span class="line">	&lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;.&#x2F;CSS3 ドラえもん - Pure CSS Design_files&#x2F;dora3.css&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id&#x3D;&quot;doraemon&quot;&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;face&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;head_light&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;eyes&quot;&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;eye eye_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;black_eye black_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">				&lt;div class&#x3D;&quot;eye eye_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;black_eye black_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;base&quot;&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;base_white&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;nose&quot;&gt;</span><br><span class="line">					&lt;div id&#x3D;&quot;nose_light&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;nose_line&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;mouth&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;mouth_rewrite&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;firefox_mouth&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_right_top rotate160&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_right_bottom rotate20&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_left_top rotate20&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div class&#x3D;&quot;whiskers whi_left_bottom rotate160&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;choker&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;belt&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;bell&quot;&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;bell_line&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;bell_circle&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;bell_under&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;bell_light&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;body&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;doutai&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;base_white2 doutai_center&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;pocket&quot;&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;circle&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">				&lt;div id&#x3D;&quot;circle_rewrite&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;hand_right&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;arm_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;hand_circle hand_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;arm_rewrite_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;hand_left&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;arm_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;hand_circle hand_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div class&#x3D;&quot;arm_rewrite_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;foot&quot;&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;foot_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;foot_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">			&lt;div id&#x3D;&quot;foot_rewrite&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;shadow_doutai_arm&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;shadow_doutai_left&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;shadow_doutai_right&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">		&lt;div id&#x3D;&quot;shadow_belt&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">	&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div id&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">		&lt;p&gt;These are Samples drawn with CSS3 only, with no images. by &lt;a href&#x3D;&quot;http:&#x2F;&#x2F;twitter.com&#x2F;shop_dd&quot;</span><br><span class="line">				title&#x3D;&quot;Twitter shopdd&quot;&gt;@shop_dd&lt;&#x2F;a&gt;&lt;br&gt;Return to &lt;a href&#x3D;&quot;http:&#x2F;&#x2F;purecss3.net&#x2F;&quot;&gt;Pure CSS</span><br><span class="line">				Design&lt;&#x2F;a&gt;.&amp;nbsp;&amp;nbsp;Read about &lt;a href&#x3D;&quot;http:&#x2F;&#x2F;shopdd.jp&#x2F;blog-entry-932.html&quot; target&#x3D;&quot;_blank&quot;&gt;the</span><br><span class="line">				CSS3 Doraemon on shop DD&lt;&#x2F;a&gt; . &lt;br&gt;&lt;&#x2F;p&gt;</span><br><span class="line">	&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;audio controls&#x3D;&quot;controls&quot; style&#x3D;&quot;display: none;&quot;&gt;&lt;&#x2F;audio&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">	#yddContainer &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		font-family: Microsoft YaHei;</span><br><span class="line">		position: relative;</span><br><span class="line">		width: 100%;</span><br><span class="line">		height: 100%;</span><br><span class="line">		top: -4px;</span><br><span class="line">		left: -4px;</span><br><span class="line">		font-size: 12px;</span><br><span class="line">		border: 1px solid</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddTop &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		height: 22px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddTopBorderlr &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		position: static;</span><br><span class="line">		height: 17px;</span><br><span class="line">		padding: 2px 28px;</span><br><span class="line">		line-height: 17px;</span><br><span class="line">		font-size: 12px;</span><br><span class="line">		color: #5079bb;</span><br><span class="line">		font-weight: bold;</span><br><span class="line">		border-style: none solid;</span><br><span class="line">		border-width: 1px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddTopBorderlr .ydd-sp &#123;</span><br><span class="line">		position: absolute;</span><br><span class="line">		top: 2px;</span><br><span class="line">		height: 0;</span><br><span class="line">		overflow: hidden</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-icon &#123;</span><br><span class="line">		left: 5px;</span><br><span class="line">		width: 17px;</span><br><span class="line">		padding: 0px 0px 0px 0px;</span><br><span class="line">		padding-top: 17px;</span><br><span class="line">		background-position: -16px -44px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-close &#123;</span><br><span class="line">		right: 5px;</span><br><span class="line">		width: 16px;</span><br><span class="line">		padding-top: 16px;</span><br><span class="line">		background-position: left -44px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddKeyTitle &#123;</span><br><span class="line">		float: left;</span><br><span class="line">		text-decoration: none</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddMiddle &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		margin-bottom: 10px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-tabs &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		margin: 5px 0;</span><br><span class="line">		padding: 0 5px;</span><br><span class="line">		height: 18px;</span><br><span class="line">		border-bottom: 1px solid</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-tab &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		float: left;</span><br><span class="line">		height: 18px;</span><br><span class="line">		margin: 0 5px -1px 0;</span><br><span class="line">		padding: 0 4px;</span><br><span class="line">		line-height: 18px;</span><br><span class="line">		border: 1px solid;</span><br><span class="line">		border-bottom: none</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-trans-container &#123;</span><br><span class="line">		display: block;</span><br><span class="line">		line-height: 160%</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-trans-container a &#123;</span><br><span class="line">		text-decoration: none;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddBottom &#123;</span><br><span class="line">		position: absolute;</span><br><span class="line">		bottom: 0;</span><br><span class="line">		left: 0;</span><br><span class="line">		width: 100%;</span><br><span class="line">		height: 22px;</span><br><span class="line">		line-height: 22px;</span><br><span class="line">		overflow: hidden;</span><br><span class="line">		background-position: left -22px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-padding010 &#123;</span><br><span class="line">		padding: 0 10px</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddWrapper &#123;</span><br><span class="line">		color: #252525;</span><br><span class="line">		z-index: 10001;</span><br><span class="line">		background: url(chrome-extension:&#x2F;&#x2F;eopjamdnofihpioajgfdikhhbobonhbb&#x2F;ab20.png);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddContainer &#123;</span><br><span class="line">		background: #fff;</span><br><span class="line">		border-color: #4b7598</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddTopBorderlr &#123;</span><br><span class="line">		border-color: #f0f8fc</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddWrapper .ydd-sp &#123;</span><br><span class="line">		background-image: url(chrome-extension:&#x2F;&#x2F;eopjamdnofihpioajgfdikhhbobonhbb&#x2F;ydd-sprite.png)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddWrapper a,</span><br><span class="line">	#yddWrapper a:hover,</span><br><span class="line">	#yddWrapper a:visited &#123;</span><br><span class="line">		color: #50799b</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddWrapper .ydd-tabs &#123;</span><br><span class="line">		color: #959595</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.ydd-tabs,</span><br><span class="line">	.ydd-tab &#123;</span><br><span class="line">		background: #fff;</span><br><span class="line">		border-color: #d5e7f3</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddBottom &#123;</span><br><span class="line">		color: #363636</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#yddWrapper &#123;</span><br><span class="line">		min-width: 250px;</span><br><span class="line">		max-width: 400px;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br></pre></td><td class="code"><pre><span class="line">body&#123;</span><br><span class="line">	background:#fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#doraemon&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	margin:50px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#head_light&#123;</span><br><span class="line">	width:50px;</span><br><span class="line">	height:50px;</span><br><span class="line">	transform: rotate(20deg);</span><br><span class="line">		-webkit-transform: rotate(20deg);</span><br><span class="line">		-moz-transform: rotate(20deg);</span><br><span class="line">		-o-transform: rotate(20deg);</span><br><span class="line">		-ms-transform: rotate(20deg);</span><br><span class="line">	box-shadow:80px 20px 50px #fff;</span><br><span class="line">		-webkit-box-shadow:80px 20px 55px #fff;</span><br><span class="line">		-moz-box-shadow:80px 20px 50px #fff;</span><br><span class="line">	border-radius:45px;</span><br><span class="line">		-webkit-border-radius:45px;</span><br><span class="line">		-moz-border-radius:60px;</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:-20px;</span><br><span class="line">	left:170px;</span><br><span class="line">	opacity:0.5</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#face&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:310px;</span><br><span class="line">	height:300px;</span><br><span class="line">	border-radius:146px;</span><br><span class="line">		-webkit-border-radius:146px;</span><br><span class="line">		-moz-border-radius:146px;</span><br><span class="line">	background:#07beea;	</span><br><span class="line">	background: linear-gradient(right top, #fff,#07beea 20%, #10a6ce 73% ,#000 95% ,#000 155%); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff,#07beea 20%, #10a6ce 73% ,#000 95% ,#000 155%); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff,#07beea 20%, #10a6ce 73% ,#000 95% ,#000 155%); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff,#07beea 20%, #10a6ce 73% ,#000 95% ,#000 155%); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff,#07beea 20%, #10a6ce 73% ,#000 95% ,#000 155%);  </span><br><span class="line">	border:#333 2px solid;</span><br><span class="line">	top:-15px;</span><br><span class="line">	box-shadow:-5px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">		-webkit-box-shadow:-5px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">		-moz-box-shadow:-5px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#base&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:-5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#base_white&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	border:#000 2px solid;</span><br><span class="line">	width:264px;</span><br><span class="line">	height:196px;</span><br><span class="line">	border-radius: 150px 150px;</span><br><span class="line">		-webkit-border-radius: 150px 150px;</span><br><span class="line">		-moz-border-radius: 150px 150px;</span><br><span class="line">	background:#FFF;</span><br><span class="line">	background: linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">	z-index:1;</span><br><span class="line">	top:85px;</span><br><span class="line">	left:22px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#eyes&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:-5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.eye&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	border-radius: 35px 35px;</span><br><span class="line">		-webkit-border-radius: 35px 35px;</span><br><span class="line">		-moz-border-radius: 35px 35px;</span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	width:72px;</span><br><span class="line">	height:83px;</span><br><span class="line">	z-index:20;</span><br><span class="line">	background:#fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.black_eye&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	width:15px;</span><br><span class="line">	height:15px;</span><br><span class="line">	border-radius:10px;</span><br><span class="line">		-webkit-border-radius:10px;</span><br><span class="line">		-moz-border-radius:10px;</span><br><span class="line">	background:#333;</span><br><span class="line">	z-index:21;</span><br><span class="line">		-webkit-animation-name: cate;</span><br><span class="line">		-webkit-animation-duration: 10s;</span><br><span class="line">		-webkit-animation-timing-function: linear;</span><br><span class="line">		-webkit-animation-iteration-count: 200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-webkit-keyframes cate&#123;</span><br><span class="line">	0%&#123;</span><br><span class="line">		margin:0 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">	80%	&#123;</span><br><span class="line">		margin:0px 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">	85%	&#123;</span><br><span class="line">		margin:-20px 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">	90%&#123;</span><br><span class="line">		margin:0 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">	93%&#123;</span><br><span class="line">		margin:0 0 0 7px;</span><br><span class="line">	&#125;</span><br><span class="line">	96%&#123;</span><br><span class="line">		margin:0 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">	100%&#123;</span><br><span class="line">		margin:0 0 0 0;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.black_left&#123;</span><br><span class="line">	top:100px;</span><br><span class="line">	left:130px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.black_right&#123;</span><br><span class="line">	top:100px;</span><br><span class="line">	left:170px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.eye_left&#123;</span><br><span class="line">	top:45px;</span><br><span class="line">	left:82px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.eye_right&#123;</span><br><span class="line">	top:45px;</span><br><span class="line">	left:156px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nose&#123;</span><br><span class="line">	width:32px;</span><br><span class="line">	height:32px;</span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	border-radius:50px;</span><br><span class="line">		-webkit-border-radius:50px;</span><br><span class="line">		-moz-border-radius:50px;</span><br><span class="line">	background:#c93e00;</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:117px;</span><br><span class="line">	left:139px;</span><br><span class="line">	z-index:30;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nose_light&#123;</span><br><span class="line">	width:10px;</span><br><span class="line">	height:10px;</span><br><span class="line">	border-radius:5px;</span><br><span class="line">		-webkit-border-radius:5px;</span><br><span class="line">		-moz-border-radius:5px;</span><br><span class="line">	box-shadow:19px 8px 5px #fff;</span><br><span class="line">		-webkit-box-shadow:19px 8px 5px #fff;</span><br><span class="line">		-moz-box-shadow:19px 8px 5px #fff;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:0px;</span><br><span class="line">	left:0px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#nose_line&#123;</span><br><span class="line">	background:#333;</span><br><span class="line">	width:3px;</span><br><span class="line">	height:100px;</span><br><span class="line">	top:140px;</span><br><span class="line">	left:155px;</span><br><span class="line">	position:absolute;</span><br><span class="line">		z-index:20;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#mouth&#123;</span><br><span class="line">	width:240px;</span><br><span class="line">	height:240px;</span><br><span class="line">	border-bottom:3px solid #333;</span><br><span class="line">	border-radius:120px;</span><br><span class="line">		-webkit-border-radius:120px;</span><br><span class="line">		-moz-border-radius:120px;</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:0px;</span><br><span class="line">	left:35px;</span><br><span class="line">	z-index:50;</span><br><span class="line">	clip:rect(205px auto auto auto);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.whiskers&#123;</span><br><span class="line">	background:#333;</span><br><span class="line">	height:2px;</span><br><span class="line">	width:60px;</span><br><span class="line">	position:absolute;</span><br><span class="line">	z-index:20;</span><br><span class="line">&#125;</span><br><span class="line">.whi_right&#123;</span><br><span class="line">	top:165px;</span><br><span class="line">	left:210px;	</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line">.whi_right_top&#123;</span><br><span class="line">	top:145px;</span><br><span class="line">	left:210px;</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line">.whi_right_bottom&#123;</span><br><span class="line">	top:185px;</span><br><span class="line">	left:210px;</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line">.whi_left&#123;</span><br><span class="line">	top:165px;</span><br><span class="line">	left:50px;	</span><br><span class="line">&#125;	</span><br><span class="line">.whi_left_top&#123;</span><br><span class="line">	top:145px;</span><br><span class="line">	left:50px;</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line">.whi_left_bottom&#123;</span><br><span class="line">	top:185px;</span><br><span class="line">	left:50px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.rotate20&#123;</span><br><span class="line">	transform: rotate(20deg);</span><br><span class="line">		-webkit-transform: rotate(20deg);</span><br><span class="line">		-moz-transform: rotate(20deg);</span><br><span class="line">		-o-transform: rotate(20deg);</span><br><span class="line">		-ms-transform: rotate(20deg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.rotate160&#123;</span><br><span class="line">	transform: rotate(160deg);</span><br><span class="line">		-webkit-transform: rotate(160deg);</span><br><span class="line">		-moz-transform: rotate(160deg);</span><br><span class="line">		-o-transform: rotate(160deg);</span><br><span class="line">		-ms-transform: rotate(160deg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#choker&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:-55px;</span><br><span class="line">	left:35px;</span><br><span class="line">	z-index:100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#belt&#123;</span><br><span class="line">	width:230px;</span><br><span class="line">	height:20px;</span><br><span class="line">	border:#000 solid 2px;</span><br><span class="line">	background:#ca4100;</span><br><span class="line">	background: linear-gradient(top, #ca4100, #800400); </span><br><span class="line">		background: -webkit-linear-gradient(top, #ca4100, #800400); </span><br><span class="line">		background: -moz-linear-gradient(top, #ca4100, #800400); </span><br><span class="line">		background: -o-linear-gradient(top, #ca4100, #800400); </span><br><span class="line">		background: -ms-linear-gradient(top, #ca4100, #800400); </span><br><span class="line">	border-radius:10px;	</span><br><span class="line">		-webkit-border-radius:10px;	</span><br><span class="line">		-moz-border-radius:10px;</span><br><span class="line">		position:relative;</span><br><span class="line">	left:5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#bell&#123;</span><br><span class="line">	width:40px;</span><br><span class="line">	height:40px;</span><br><span class="line">	border-radius:50px;</span><br><span class="line">		-webkit-border-radius:50px;</span><br><span class="line">		-moz-border-radius:50px;</span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	background:#f9f12a;</span><br><span class="line">	background: linear-gradient(top, #f9f12a, #e9e11a 75%,#a9a100); </span><br><span class="line">		background: -webkit-linear-gradient(top, #f9f12a, #e9e11a 75%,#a9a100); </span><br><span class="line">		background: -moz-linear-gradient(top, #f9f12a, #e9e11a 75%,#a9a100); </span><br><span class="line">		background: -o-linear-gradient(top, #f9f12a, #e9e11a 75%,#a9a100); </span><br><span class="line">		background: -ms-linear-gradient(top, #f9f12a, #e9e11a 75%,#a9a100); </span><br><span class="line">	box-shadow:-5px 5px 10px rgba(0,0,0,0.25);</span><br><span class="line">		-webkit-box-shadow:-5px 3px 5px rgba(0,0,0,0.25);</span><br><span class="line">		-moz-box-shadow:-5px 5px 10px rgba(0,0,0,0.25);</span><br><span class="line">	position:relative;</span><br><span class="line">	top:-15px;</span><br><span class="line">	left:100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#bell_line&#123;</span><br><span class="line">	width:36px;</span><br><span class="line">	height:2px;</span><br><span class="line">	background:#f9f12a;</span><br><span class="line">	border:#333 solid 2px;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#bell_circle&#123;</span><br><span class="line">	width:12px;</span><br><span class="line">	height:10px;</span><br><span class="line">	border-radius:5px;</span><br><span class="line">		-webkit-border-radius:5px;</span><br><span class="line">		-moz-border-radius:5px;</span><br><span class="line">	background:#000;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:14px;</span><br><span class="line">	left:14px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#bell_under&#123;</span><br><span class="line">	width:3px;</span><br><span class="line">	height:15px;</span><br><span class="line">	background:#000;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:10px;</span><br><span class="line">	left:18px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#bell_light&#123;</span><br><span class="line">	width:10px;</span><br><span class="line">	height:10px;</span><br><span class="line">	border-radius:10px;</span><br><span class="line">		-webkit-border-radius:10px;</span><br><span class="line">		-moz-border-radius:10px;</span><br><span class="line">	box-shadow:19px 8px 5px #fff;</span><br><span class="line">		-webkit-box-shadow:19px 8px 5px #fff;</span><br><span class="line">		-moz-box-shadow:19px 8px 5px #fff;</span><br><span class="line">	position:relative;</span><br><span class="line">	opacity:0.7;</span><br><span class="line">	top:-35px;</span><br><span class="line">	left:5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#doutai&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	width:220px;</span><br><span class="line">	height:165px;</span><br><span class="line">	background:#07beea;</span><br><span class="line">	background: linear-gradient(right, #07beea, #0073b3 50%,#0096be 75%,#00b0e0 ,#0096be 100% ,#333 114%); </span><br><span class="line">		background: -webkit-linear-gradient(right, #07beea, #0073b3 50%,#0096be 75%,#00b0e0 ,#0096be 100% ,#333 114%); </span><br><span class="line">		background: -moz-linear-gradient(right, #07beea, #0073b3 50%,#0096be 75%,#00b0e0 ,#0096be 100% ,#333 114%); </span><br><span class="line">		background: -o-linear-gradient(right, #07beea, #0073b3 50%,#0096be 75%,#00b0e0 ,#0096be 100% ,#333 114%); </span><br><span class="line">		background: -ms-linear-gradient(right, #07beea, #0073b3 50%,#0096be 75%,#00b0e0 ,#0096be 100% ,#333 114%); </span><br><span class="line">	border:#333 2px solid;</span><br><span class="line">	top:262px;</span><br><span class="line">	left:46px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.base_white2&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	width:170px;</span><br><span class="line">	height:170px;</span><br><span class="line">	border-radius:85px;</span><br><span class="line">		-webkit-border-radius:85px;</span><br><span class="line">		-moz-border-radius:85px;</span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	background:#FFF;</span><br><span class="line">	background: linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff,#fff 75%, #eee 83%,#999 90%,#444 95%, #000); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.doutai_center&#123;</span><br><span class="line">	top:230px;</span><br><span class="line">	left:72px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#circle&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:130px;</span><br><span class="line">	height:130px;</span><br><span class="line">	border-radius:65px;</span><br><span class="line">		-webkit-border-radius:65px;</span><br><span class="line">		-moz-border-radius:65px;</span><br><span class="line">	background:#fff;</span><br><span class="line">	background: linear-gradient(right top, #fff, #fff 70%,#f8f8f8 75%,#eee 80%,#ddd 88% , #fff); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff, #fff 70%,#f8f8f8 75%,#eee 80%,#ddd 88% , #fff); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff, #fff 70%,#f8f8f8 75%,#eee 80%,#ddd 88% , #fff); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff, #fff 70%,#f8f8f8 75%,#eee 80%,#ddd 88% , #fff); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff, #fff 70%,#f8f8f8 75%,#eee 80%,#ddd 88% , #fff);  </span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	top:-120px;</span><br><span class="line">	left:92px;</span><br><span class="line">&#125;</span><br><span class="line">#circle_rewrite&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:134px;</span><br><span class="line">	height:60px;</span><br><span class="line">	background:#fff;	</span><br><span class="line">	border-bottom:2px solid #000;</span><br><span class="line">	top:-250px;</span><br><span class="line">	left:92px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#hand_right&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:272px;</span><br><span class="line">	left:248px;</span><br><span class="line">	width:100px;</span><br><span class="line">	height:100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#arm_right&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:80px;</span><br><span class="line">	height:50px;</span><br><span class="line">	background:#07beea;</span><br><span class="line">	background: linear-gradient(top, #07beea, #07beea 85%, #555); </span><br><span class="line">		background: -webkit-linear-gradient(top, #07beea, #07beea 85%, #555); </span><br><span class="line">		background: -moz-linear-gradient(top, #07beea, #07beea 85%, #555); </span><br><span class="line">		background: -o-linear-gradient(top, #07beea, #07beea 85%, #555); </span><br><span class="line">		background: -ms-linear-gradient(top, #07beea, #07beea 85%, #555); </span><br><span class="line">	border:solid 1px #000;</span><br><span class="line">	z-index:-1;</span><br><span class="line">	top:17px;</span><br><span class="line">	transform: rotate(35deg);</span><br><span class="line">		-webkit-transform: rotate(35deg);</span><br><span class="line">		-moz-transform: rotate(35deg);</span><br><span class="line">		-o-transform: rotate(35deg);</span><br><span class="line">		-ms-transform: rotate(35deg);</span><br><span class="line">	box-shadow:-10px 7px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-webkit-box-shadow:-10px 7px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-moz-box-shadow:-10px 7px 10px rgba(0,0,0,0.35);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#hand_left&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:272px;</span><br><span class="line">	left:-46px;</span><br><span class="line">	width:100px;</span><br><span class="line">	height:100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#arm_left&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:80px;</span><br><span class="line">	height:50px;</span><br><span class="line">	background:#07beea;</span><br><span class="line">	background: linear-gradient(top left, #0096be, #0096be 55%, #07beea); </span><br><span class="line">		background: -webkit-linear-gradient(top left, #0096be, #0096be 55%, #07beea); </span><br><span class="line">		background: -moz-linear-gradient(top left, #0096be, #0096be 55%, #07beea); </span><br><span class="line">		background: -o-linear-gradient(top left, #0096be, #0096be 55%, #07beea); </span><br><span class="line">		background: -ms-linear-gradient(top left, #0096be, #0096be 55%, #07beea); </span><br><span class="line">	border:solid 1px #000;</span><br><span class="line">	z-index:-1;</span><br><span class="line">	top:17px;</span><br><span class="line">	left:36px;</span><br><span class="line">	transform: rotate(145deg);</span><br><span class="line">		-webkit-transform: rotate(145deg);</span><br><span class="line">		-moz-transform: rotate(145deg);</span><br><span class="line">		-o-transform: rotate(145deg);</span><br><span class="line">		-ms-transform: rotate(145deg);</span><br><span class="line">	box-shadow:5px -7px 10px rgba(0,0,0,0.25);</span><br><span class="line">		-webkit-box-shadow:5px -7px 10px rgba(0,0,0,0.25);</span><br><span class="line">		-moz-box-shadow:5px -7px 10px rgba(0,0,0,0.25);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div.hand_circle&#123;</span><br><span class="line">	position:absolute;</span><br><span class="line">	width:60px;</span><br><span class="line">	height:60px;</span><br><span class="line">	border-radius:30px;</span><br><span class="line">		-webkit-border-radius:30px;</span><br><span class="line">		-moz-border-radius:30px;</span><br><span class="line">	border:2px solid #000;</span><br><span class="line">	background:#fff;</span><br><span class="line">	background: linear-gradient(right top, #fff, #fff 50%, #eee 70%, #ddd 80%,#999); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff, #fff 50%, #eee 70%, #ddd 80%,#999); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff, #fff 50%, #eee 70%, #ddd 80%,#999); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff, #fff 50%, #eee 70%, #ddd 80%,#999); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff, #fff 50%, #eee 70%, #ddd 80%,#999); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.hand_right&#123;</span><br><span class="line">	top:32px;</span><br><span class="line">	left:40px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.arm_rewrite_right&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:4px;</span><br><span class="line">	height:45px;</span><br><span class="line">	background:#07beea;</span><br><span class="line">	top:-51px;</span><br><span class="line">	left:18px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.hand_left&#123;</span><br><span class="line">	top:34px;</span><br><span class="line">	left:10px;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.arm_rewrite_left&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:4px;</span><br><span class="line">	height:50px;</span><br><span class="line">	background:#07beea;</span><br><span class="line">	background: linear-gradient(top left, #0096be, #0096be); </span><br><span class="line">		background: -webkit-linear-gradient(top left, #0096be, #0096be); </span><br><span class="line">		background: -moz-linear-gradient(top left, #0096be, #0096be); </span><br><span class="line">		background: -o-linear-gradient(top left, #0096be, #0096be); </span><br><span class="line">		background: -ms-linear-gradient(top left, #0096be, #0096be); </span><br><span class="line">	top:-52px;</span><br><span class="line">	left:92px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#foot&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:280px;</span><br><span class="line">	height:40px;</span><br><span class="line">	top:-141px;</span><br><span class="line">	left:20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#foot_left&#123;</span><br><span class="line">	width:125px;</span><br><span class="line">	height:30px;</span><br><span class="line">	background:#fff;</span><br><span class="line">	background: linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">	border:solid 2px #333;</span><br><span class="line">	border-top-left-radius:80px;</span><br><span class="line">	border-bottom-left-radius:40px;</span><br><span class="line">	border-top-right-radius:60px;</span><br><span class="line">	border-bottom-right-radius:60px;</span><br><span class="line">		-webkit-border-top-left-radius:80px;</span><br><span class="line">		-webkit-border-bottom-left-radius:40px;</span><br><span class="line">		-webkit-border-top-right-radius:60px;</span><br><span class="line">		-webkit-border-bottom-right-radius:60px;</span><br><span class="line">		-moz-border-radius-topleft:80px;</span><br><span class="line">		-moz-border-radius-bottomleft:40px;</span><br><span class="line">		-moz-border-radius-topright:60px;</span><br><span class="line">		-moz-border-radius-bottomright:60px;</span><br><span class="line">	position:relative;</span><br><span class="line">	left:8px;</span><br><span class="line">	top:2px;</span><br><span class="line">	box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-webkit-box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-moz-box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">	z-index:-1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#foot_right&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:125px;</span><br><span class="line">	height:30px;</span><br><span class="line">	background:#fff;</span><br><span class="line">	background: linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -moz-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -o-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">		background: -ms-linear-gradient(right top, #fff,#fff 75%, #eee 85%, #999); </span><br><span class="line">	border:solid 2px #333;</span><br><span class="line">	border-top-left-radius:60px;</span><br><span class="line">	border-bottom-left-radius:60px;</span><br><span class="line">	border-top-right-radius:80px;</span><br><span class="line">	border-bottom-right-radius:40px;</span><br><span class="line">		-webkit-border-top-left-radius:60px;</span><br><span class="line">		-webkit-border-bottom-left-radius:60px;</span><br><span class="line">		-webkit-border-top-right-radius:80px;</span><br><span class="line">		-webkit-border-bottom-right-radius:40px;</span><br><span class="line">		-moz-border-radius-topleft:60px;</span><br><span class="line">		-moz-border-radius-bottomleft:60px;</span><br><span class="line">		-moz-border-radius-topright:80px;</span><br><span class="line">		-moz-border-radius-bottomright:40px;</span><br><span class="line">	top:-32px;</span><br><span class="line">	left:141px;</span><br><span class="line">	box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-webkit-box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">		-moz-box-shadow:-6px 0px 10px rgba(0,0,0,0.35);</span><br><span class="line">	z-index:-1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#foot_rewrite&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	width:20px;</span><br><span class="line">	height:10px;</span><br><span class="line">	background:#fff;</span><br><span class="line">	background: linear-gradient(right top, #666, #fff 83%, #fff); </span><br><span class="line">		background: -webkit-linear-gradient(right top, #666, #fff 83%, #fff); </span><br><span class="line">		background: -moz-linear-gradient(right top, #666, #fff 83%, #fff); </span><br><span class="line">		background: -o-linear-gradient(right top, #666, #fff 83%, #fff); </span><br><span class="line">		background: -ms-linear-gradient(right top, #666, #fff 83%, #fff); </span><br><span class="line">	top:-76px;</span><br><span class="line">	left:127px;</span><br><span class="line">	border-top:2px solid #000;</span><br><span class="line">	border-right:2px solid #000;</span><br><span class="line">	border-left:2px solid #000;</span><br><span class="line">	border-top-right-radius:40px;</span><br><span class="line">	border-top-left-radius:40px;</span><br><span class="line">		-webkit-border-top-right-radius:40px;</span><br><span class="line">		-webkit-border-top-left-radius:40px;</span><br><span class="line">		-moz-border-radius-topleft:40px;</span><br><span class="line">		-moz-border-radius-topright:40px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#shadow_doutai_left&#123;</span><br><span class="line">	width:30px;</span><br><span class="line">	height:200px;</span><br><span class="line">	box-shadow:-10px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">		-webkit-box-shadow:-10px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">		-moz-box-shadow:-10px 10px 15px rgba(0,0,0,0.45);</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:250px;</span><br><span class="line">	left:46px;</span><br><span class="line">	z-index:-10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#shadow_doutai_right&#123;</span><br><span class="line">	width:30px;</span><br><span class="line">	height:200px;</span><br><span class="line">	box-shadow:10px 10px 15px rgba(0,0,0,0.35);</span><br><span class="line">		-webkit-box-shadow:10px 10px 25px rgba(0,0,0,0.35);</span><br><span class="line">		-moz-box-shadow:10px 10px 15px rgba(0,0,0,0.35);</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:240px;</span><br><span class="line">	left:230px;</span><br><span class="line">	z-index:-10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#shadow_doutai_arm&#123;</span><br><span class="line">	width:85px;</span><br><span class="line">	height:165px;</span><br><span class="line">	box-shadow:-100px 10px 15px rgba(0,0,0,0.0);</span><br><span class="line">		-webkit-box-shadow:-100px 10px 15px rgba(0,0,0,0.25);</span><br><span class="line">		-moz-box-shadow:-100px 10px 15px rgba(0,0,0,0.25);</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:230px;</span><br><span class="line">	left:113px;</span><br><span class="line">	z-index:10;</span><br><span class="line">	opacity:0.5;</span><br><span class="line">	transform: rotate(-20deg);</span><br><span class="line">		-webkit-transform: rotate(-20deg);</span><br><span class="line">		-moz-transform: rotate(-20deg);</span><br><span class="line">		-o-transform: rotate(-20deg);</span><br><span class="line">		ms-transform: rotate(-20deg);</span><br><span class="line">	border-bottom-left-radius:40px;</span><br><span class="line">		-webkit-border-bottom-left-radius:40px;</span><br><span class="line">		-moz-border-radius-bottomleft:40px;</span><br><span class="line">	border-top-left-radius:20px;</span><br><span class="line">		-webkit-border-top-left-radius:20px;</span><br><span class="line">		-moz-border-radius-topleft:20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#shadow_belt&#123;</span><br><span class="line">	width:40px;</span><br><span class="line">	height:30px;</span><br><span class="line">	box-shadow:-100px 10px 15px rgba(0,0,0,0);</span><br><span class="line">		-webkit-box-shadow:-100px 10px 15px rgba(0,0,0,0.25);</span><br><span class="line">		-moz-box-shadow:-100px 10px 15px rgba(0,0,0,0.25);</span><br><span class="line">	position:absolute;</span><br><span class="line">	top:240px;</span><br><span class="line">	left:130px;</span><br><span class="line">	z-index:10;</span><br><span class="line">	border-bottom-left-radius:40px;</span><br><span class="line">		-webkit-border-bottom-left-radius:40px;</span><br><span class="line">		-moz-border-radius-bottomleft:40px;</span><br><span class="line">	z-index:300;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#arm_left:not(\*|*), .arm_rewrite_left:not(\*|*)&#123;</span><br><span class="line">	background:#07beea;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#arm_left, .arm_rewrite_left&#123;</span><br><span class="line">	background:#07beea\9;</span><br><span class="line">	*background:#07beea;</span><br><span class="line">	_background:#07beea;</span><br><span class="line">&#125;</span><br><span class="line">.arm_rewrite_left&#123;</span><br><span class="line">		background: -ms-linear-gradient(top left, #0096be, #0096be);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#arm_left&#123;</span><br><span class="line">		background: -ms-linear-gradient(top left, #0096be, #0096be 55%, #07beea);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#kiji&#123;</span><br><span class="line">	position:relative;</span><br><span class="line">	top:-150px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#footer&#123;</span><br><span class="line">	width:97%;</span><br><span class="line">	padding:0 0 0 30px;</span><br><span class="line">	border-bottom:#333 1px solid;</span><br><span class="line">	margin:-150px 0 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#footer a,a:link&#123;</span><br><span class="line">	color:#09C;</span><br><span class="line">	position:relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/JS%E8%B7%A8%E5%9F%9F%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/JS%E8%B7%A8%E5%9F%9F%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">JS跨域及解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/JS%E8%B7%A8%E5%9F%9F%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-meta-item leancloud_visitors" data-flag-title="JS跨域及解决方案" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>&lt;转&gt;<a target="_blank" rel="noopener" href="https://www.imooc.com/article/21976">详解跨域(最全的解决方案)</a></p>
<ol>
<li>什么是跨域<br>跨域，是指浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对JavaScript实施的安全限制。</li>
</ol>
<p>同源策略限制了一下行为：</p>
<p>Cookie、LocalStorage 和 IndexDB 无法读取<br>DOM 和 JS 对象无法获取<br>Ajax请求发送不出去<br>2. 常见的跨域场景<br>所谓的同源是指，域名、协议、端口均为相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//www.nealyang.cn/index.html 调用   http://www.nealyang.cn/server.php  非跨域</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//www.nealyang.cn/index.html 调用   http://www.neal.cn/server.php  跨域,主域不同</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//abc.nealyang.cn/index.html 调用   http://def.neal.cn/server.php  跨域,子域名不同</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//www.nealyang.cn:8080/index.html 调用   http://www.nealyang.cn/server.php  跨域,端口不同</span></span><br><span class="line"></span><br><span class="line">https:<span class="comment">//www.nealyang.cn/index.html 调用   http://www.nealyang.cn/server.php  跨域,协议不同</span></span><br><span class="line"></span><br><span class="line">localhost   调用 <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> 跨域</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>跨域的解决办法</li>
<li>1 jsonp跨域<br>jsonp跨域其实也是JavaScript设计模式中的一种代理模式。在html页面中通过相应的标签从不同域名下加载静态资源文件是被浏览器允许的，所以我们可以通过这个“犯罪漏洞”来进行跨域。一般，我们可以动态的创建script标签，再去请求一个带参网址来实现跨域通信</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;原生的实现方式</span><br><span class="line">let script &#x3D; document.createElement(&#39;script&#39;);</span><br><span class="line"></span><br><span class="line">script.src &#x3D; &#39;http:&#x2F;&#x2F;www.nealyang.cn&#x2F;login?username&#x3D;Nealyang&amp;callback&#x3D;callback&#39;;</span><br><span class="line"></span><br><span class="line">document.body.appendChild(script);</span><br><span class="line"></span><br><span class="line">function callback(res) &#123;</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;</span><br><span class="line">&#96;&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">当然，jquery也支持jsonp的实现方式</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$.ajax({<br>    url:’<a target="_blank" rel="noopener" href="http://www.nealyang.cn/login&#39;">http://www.nealyang.cn/login&#39;</a>,<br>    type:’GET’,<br>    dataType:’jsonp’,//请求方式为jsonp<br>    jsonpCallback:’callback’,<br>    data:{<br>        “username”:”Nealyang”<br>    }<br>})</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">虽然这种方式非常好用，但是一个最大的缺陷是，只能够实现get请求</span><br><span class="line"></span><br><span class="line">3.2 document.domain + iframe 跨域</span><br><span class="line">这种跨域的方式最主要的是要求主域名相同。什么是主域名相同呢？</span><br><span class="line">www.geekjc.com aaa.geekjc.com ba.ad.geekjc.com 这三个主域名都是geekjc.com,而主域名不同的就不能用此方法。</span><br><span class="line"></span><br><span class="line">假设目前a.geekjc.com 和 b.geekjc.com 分别对应指向不同ip的服务器。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>a.geekjc.com 下有一个test.html文件</p>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>html</title>
    <script type="text/javascript" src = "jquery-1.12.1.js"></script>
</head>
<body>
    <div>A页面</div>
    <iframe 
    style = "display : none" 
    name = "iframe1" 
    id = "iframe" 
    src="http://b.geekjc.com/1.html" frameborder="0"></iframe>
    <script type="text/javascript">
        $(function(){
            try{
                document.domain = "geekjc.com"
            }catch(e){}
            $("#iframe").load(function(){
                var jq = document.getElementById('iframe').contentWindow.$
                jq.get("http://geekjc.com/test.json",function(data){
                    console.log(data);
                });
            })
        })
    </script>
</body>
</html>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">利用 iframe 加载 其他域下的文件（geekjc.com&#x2F;1.html）, 同时 document.domain 设置成 geekjc.com ，当 iframe 加载完毕后就可以获取 geekjc.com 域下的全局对象， 此时尝试着去请求 geekjc.com 域名下的 test.json （此时可以请求接口），就会发现数据请求失败了~~ 惊不惊喜，意不意外！！！！！！！</span><br><span class="line"></span><br><span class="line">数据请求失败，目的没有达到，自然是还少一步：</span><br></pre></td></tr></table></figure>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>html</title>
    <script type="text/javascript" src = "jquery-1.12.1.js"></script>
    <script type="text/javascript">
        $(function(){
            try{
                document.domain = "geekjc.com"
            }catch(e){}
        })
    </script>
</head>
<body>
    <div id = "div1">B页面</div>
</body>
</html>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">此时在进行刷新浏览器，就会发现数据这次真的是成功了~</span><br><span class="line"></span><br><span class="line">3.3 window.name + iframe 跨域</span><br><span class="line">window.name属性可设置或者返回存放窗口名称的一个字符串。他的神器之处在于name值在不同页面或者不同域下加载后依旧存在，没有修改就不会发生变化，并且可以存储非常长的name(2MB)</span><br><span class="line"></span><br><span class="line">假设index页面请求远端服务器上的数据，我们在该页面下创建iframe标签，该iframe的src指向服务器文件的地址（iframe标签src可以跨域），服务器文件里设置好window.name的值，然后再在index.html里面读取改iframe中的window.name的值。完美~</span><br></pre></td></tr></table></figure>
<body>
  <script type="text/javascript"> 
    iframe = document.createElement('iframe'),
    iframe.src = 'http://localhost:8080/data.php';
    document.body.appendChild(iframe);
    iframe.onload = function() {
      console.log(iframe.contentWindow.name)
    };
  </script>
</body>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当然，这样还是不够的。</span><br><span class="line"></span><br><span class="line">因为规定如果index.html页面和和该页面里的iframe框架的src如果不同源，则也无法操作框架里的任何东西，所以就取不到iframe框架的name值了，告诉你我们不是一家的，你也休想得到我这里的数据。 既然要同源，那就换个src去指，前面说了无论怎样加载window.name值都不会变化，于是我们在index.html相同目录下，新建了个proxy.html的空页面，修改代码如下：</span><br></pre></td></tr></table></figure>
<body>
  <script type="text/javascript"> 
    iframe = document.createElement('iframe'),
    iframe.src = 'http://localhost:8080/data.php';
    document.body.appendChild(iframe);
    iframe.onload = function() {
      iframe.src = 'http://localhost:81/cross-domain/proxy.html';
      console.log(iframe.contentWindow.name)
    };
  </script>
</body>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">理想似乎很美好，在iframe载入过程中，迅速重置iframe.src的指向，使之与index.html同源，那么index页面就能去获取它的name值了！但是现实是残酷的，iframe在现实中的表现是一直不停地刷新， 也很好理解，每次触发onload时间后，重置src，相当于重新载入页面，又触发onload事件，于是就不停地刷新了（但是需要的数据还是能输出的）。修改后代码如下：</span><br></pre></td></tr></table></figure>
<body>
  <script type="text/javascript"> 
    iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    var state = 0;

<pre><code>iframe.onload = function() &#123;
  if(state === 1) &#123;
      var data = JSON.parse(iframe.contentWindow.name);
      console.log(data);
      iframe.contentWindow.document.write(&#39;&#39;);
      iframe.contentWindow.close();
    document.body.removeChild(iframe);
  &#125; else if(state === 0) &#123;
      state = 1;
      iframe.contentWindow.location = &#39;http://localhost:81/cross-domain/proxy.html&#39;;
  &#125;
&#125;;

iframe.src = &#39;http://localhost:8080/data.php&#39;;
document.body.appendChild(iframe);
</code></pre>
<p>  </script></p>
</body>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">所以如上，我们就拿到了服务器返回的数据，但是有几个条件是必不可少的：</span><br><span class="line"></span><br><span class="line">iframe标签的跨域能力</span><br><span class="line">window.names属性值在文档刷新后依然存在的能力</span><br><span class="line">3.4 location.hash + iframe 跨域</span><br><span class="line">此跨域方法和上面介绍的比较类似，一样是动态插入一个iframe然后设置其src为服务端地址，而服务端同样输出一端js代码，也同时通过与子窗口之间的通信来完成数据的传输。</span><br><span class="line"></span><br><span class="line">关于锚点相信大家都已经知道了，其实就是设置锚点，让文档指定的相应的位置。锚点的设置用a标签，然后href指向要跳转到的id，当然，前提是你得有个滚动条，不然也不好滚动嘛是吧。</span><br><span class="line"></span><br><span class="line">而location.hash其实就是url的锚点。比如https:&#x2F;&#x2F;www.geekjc.com#geekjcg的网址打开后，在控制台输入location.hash就会返回#geekjc的字段。</span><br><span class="line"></span><br><span class="line">基础知识补充完毕，下面我们来说下如何实现跨域</span><br><span class="line"></span><br><span class="line">如果index页面要获取远端服务器的数据，动态的插入一个iframe，将iframe的src执行服务器的地址，这时候的top window 和包裹这个iframe的子窗口是不能通信的，因为同源策略，所以改变子窗口的路径就可以了，将数据当做改变后的路径的hash值加载路径上，然后就可以通信了。将数据加在index页面地址的hash上， index页面监听hash的变化，h5的hashchange方法</span><br></pre></td></tr></table></figure>
<body>
  <script type="text/javascript">
    function getData(url, fn) {
      var iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = url;

<pre><code>  iframe.onload = function() &#123;
    fn(iframe.contentWindow.location.hash.substring(1));
    window.location.hash = &#39;&#39;;
    document.body.removeChild(iframe);
  &#125;;

  document.body.appendChild(iframe);
&#125;

// get data from server
var url = &#39;http://localhost:8080/data.php&#39;;
getData(url, function(data) &#123;
  var jsondata = JSON.parse(data);
  console.log(jsondata.name + &#39; &#39; + jsondata.age);
&#125;);
</code></pre>
<p>  </script></p>
</body>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">补充说明：其实location.hash和window.name都是差不多的，都是利用全局对象属性的方法，然后这两种方法和jsonp也是一样的，就是只能够实现get请求</span><br><span class="line"></span><br><span class="line">3.5 postMessage跨域</span><br><span class="line">这是由H5提出来的一个炫酷的API，IE8+，chrome,ff都已经支持实现了这个功能。这个功能也是非常的简单，其中包括接受信息的Message时间，和发送信息的postMessage方法。</span><br><span class="line"></span><br><span class="line">发送信息的postMessage方法是向外界窗口发送信息</span><br><span class="line"></span><br><span class="line">otherWindow.postMessage(message,targetOrigin);</span><br><span class="line">otherWindow指的是目标窗口，也就是要给哪一个window发送消息，是window.frames属性的成员或者是window.open方法创建的窗口。 Message是要发送的消息，类型为String，Object(IE8、9不支持Obj)，targetOrigin是限定消息接受范围，不限制就用星号 *</span><br><span class="line"></span><br><span class="line">接受信息的message事件</span><br></pre></td></tr></table></figure>
var onmessage = function(event) {
  var data = event.data;
  var origin = event.origin;
}

<p>if(typeof window.addEventListener != ‘undefined’){<br>    window.addEventListener(‘message’,onmessage,false);<br>}else if(typeof window.attachEvent != ‘undefined’){<br>    window.attachEvent(‘onmessage’, onmessage);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">举个栗子</span><br><span class="line"></span><br><span class="line">a.html(http:&#x2F;&#x2F;www.nealyang.cn&#x2F;a.html)</span><br></pre></td></tr></table></figure>
<iframe id="iframe" src="http://www.neal.cn/b.html" style="display:none;"></iframe>
<script>       
    var iframe = document.getElementById('iframe');
    iframe.onload = function() {
        var data = {
            name: 'aym'
        };
        // 向neal传送跨域数据
        iframe.contentWindow.postMessage(JSON.stringify(data), 'http://www.neal.cn');
    };

<pre><code>// 接受domain2返回数据
window.addEventListener(&#39;message&#39;, function(e) &#123;
    alert(&#39;data from neal ---&gt; &#39; + e.data);
&#125;, false);
</code></pre>
<p></script></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.html(http:&#x2F;&#x2F;www.neal.cn&#x2F;b.html)</span><br></pre></td></tr></table></figure>
<script>
    // 接收domain1的数据
    window.addEventListener('message', function(e) {
        alert('data from nealyang ---> ' + e.data);

        var data = JSON.parse(e.data);
        if (data) {
            data.number = 16;

            // 处理后再发回nealyang
            window.parent.postMessage(JSON.stringify(data), 'http://www.nealyang.cn');
        }
    }, false);
</script>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">3.6 跨域资源共享 CORS</span><br><span class="line">因为是目前主流的跨域解决方案。所以这里多介绍点。</span><br><span class="line"></span><br><span class="line">简介</span><br><span class="line"></span><br><span class="line">CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。 它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</span><br><span class="line"></span><br><span class="line">CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。IE8+：IE8&#x2F;9需要使用XDomainRequest对象来支持CORS。</span><br><span class="line"></span><br><span class="line">整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。 因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。</span><br><span class="line"></span><br><span class="line">两种请求</span><br><span class="line">说起来很搞笑，分为两种请求，一种是简单请求，另一种是非简单请求。只要满足下面条件就是简单请求</span><br><span class="line"></span><br><span class="line">请求方式为HEAD、POST 或者 GET</span><br><span class="line">http头信息不超出一下字段：Accept、Accept-Language 、 Content-Language、 Last-Event-ID、 Content-Type(限于三个值：application&#x2F;x-www-form-urlencoded、multipart&#x2F;form-data、text&#x2F;plain)</span><br><span class="line">为什么要分为简单请求和非简单请求，因为浏览器对这两种请求方式的处理方式是不同的。</span><br><span class="line">简单请求</span><br><span class="line"></span><br><span class="line">基本流程</span><br><span class="line"></span><br><span class="line">对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个Origin字段。 下面是一个例子，浏览器发现这次跨源AJAX请求是简单请求，就自动在头信息之中，添加一个Origin字段。</span><br></pre></td></tr></table></figure>
<p>GET /cors HTTP/1.1<br>Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>Host: api.alice.com<br>Accept-Language: en-US<br>Connection: keep-alive<br>User-Agent: Mozilla/5.0<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Origin字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</span><br><span class="line"></span><br><span class="line">如果Origin指定的源，不在许可范围内，服务器会返回一个正常的HTTP回应。 浏览器发现，这个回应的头信息没有包含Access-Control-Allow-Origin字段（详见下文），就知道出错了，从而抛出一个错误，被XMLHttpRequest的onerror回调函数捕获。</span><br><span class="line"></span><br><span class="line">注意，这种错误无法通过状态码识别，因为HTTP回应的状态码有可能是200。</span><br><span class="line"></span><br><span class="line">如果Origin指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。</span><br></pre></td></tr></table></figure>
<p>   Access-Control-Allow-Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>   Access-Control-Allow-Credentials: true<br>   Access-Control-Expose-Headers: FooBar<br>   Content-Type: text/html; charset=utf-8</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">上面的头信息之中，有三个与CORS请求相关的字段，都以Access-Control-开头</span><br><span class="line"></span><br><span class="line">Access-Control-Allow-Origin :该字段是必须的。它的值要么是请求时Origin字段的值，要么是一个*，表示接受任意域名的请求</span><br><span class="line">Access-Control-Allow-Credentials: 该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为true，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为true，如果服务器不要浏览器发送Cookie，删除该字段即可。</span><br><span class="line">Access-Control-Expose-Headers:该字段可选。CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。</span><br><span class="line"></span><br><span class="line">withCredentials 属性</span><br><span class="line"></span><br><span class="line">上面说到，CORS请求默认不发送Cookie和HTTP认证信息。如果要把Cookie发到服务器，一方面要服务器同意，指定Access-Control-Allow-Credentials字段。</span><br><span class="line"></span><br><span class="line">另一方面，开发者必须在AJAX请求中打开withCredentials属性。</span><br></pre></td></tr></table></figure>
<p>var xhr = new XMLHttpRequest(); // IE8/9需用window.XDomainRequest兼容</p>
<p>// 前端设置是否带cookie<br>xhr.withCredentials = true;</p>
<p>xhr.open(‘post’, ‘<a target="_blank" rel="noopener" href="http://www.domain2.com:8080/login&#39;">http://www.domain2.com:8080/login&#39;</a>, true);<br>xhr.setRequestHeader(‘Content-Type’, ‘application/x-www-form-urlencoded’);<br>xhr.send(‘user=admin’);</p>
<p>xhr.onreadystatechange = function() {<br>    if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) {<br>        alert(xhr.responseText);<br>    }<br>};</p>
<p>// jquery<br>$.ajax({<br>    …<br>   xhrFields: {<br>       withCredentials: true    // 前端设置是否带cookie<br>   },<br>   crossDomain: true,   // 会让请求头中包含跨域的额外信息，但不会含cookie<br>    …<br>});</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">否则，即使服务器同意发送Cookie，浏览器也不会发送。或者，服务器要求设置Cookie，浏览器也不会处理。 但是，如果省略withCredentials设置，有的浏览器还是会一起发送Cookie。这时，可以显式关闭withCredentials。</span><br><span class="line"></span><br><span class="line">需要注意的是，如果要发送Cookie，Access-Control-Allow-Origin就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的document.cookie也无法读取服务器域名下的Cookie。</span><br><span class="line"></span><br><span class="line">非简单请求</span><br><span class="line"></span><br><span class="line">非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application&#x2F;json。</span><br><span class="line"></span><br><span class="line">非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为&quot;预检&quot;请求（preflight）。</span><br><span class="line"></span><br><span class="line">浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。</span><br></pre></td></tr></table></figure>
<p>var url = ‘<a target="_blank" rel="noopener" href="http://api.alice.com/cors&#39;">http://api.alice.com/cors&#39;</a>;<br>var xhr = new XMLHttpRequest();<br>xhr.open(‘PUT’, url, true);<br>xhr.setRequestHeader(‘X-Custom-Header’, ‘value’);<br>xhr.send();<br>浏览器发现，这是一个非简单请求，就自动发出一个”预检”请求，要求服务器确认可以这样请求。下面是这个”预检”请求的HTTP头信息。</p>
<p>  OPTIONS /cors HTTP/1.1<br>   Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>   Access-Control-Request-Method: PUT<br>   Access-Control-Request-Headers: X-Custom-Header<br>   Host: api.alice.com<br>   Accept-Language: en-US<br>   Connection: keep-alive<br>   User-Agent: Mozilla/5.0…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;预检&quot;请求用的请求方法是OPTIONS，表示这个请求是用来询问的。头信息里面，关键字段是Origin，表示请求来自哪个源。</span><br><span class="line"></span><br><span class="line">除了Origin字段，&quot;预检&quot;请求的头信息包括两个特殊字段。</span><br><span class="line"></span><br><span class="line">Access-Control-Request-Method：该字段是必须的，用来列出浏览器的CORS请求会用到哪些HTTP方法，上例是PUT。</span><br><span class="line">Access-Control-Request-Headers：该字段是一个逗号分隔的字符串，指定浏览器CORS请求会额外发送的头信息字段，上例是X-Custom-Header</span><br><span class="line">预检请求的回应</span><br><span class="line"></span><br><span class="line">服务器收到&quot;预检&quot;请求以后，检查了Origin、Access-Control-Request-Method和Access-Control-Request-Headers字段以后，确认允许跨源请求，就可以做出回应</span><br></pre></td></tr></table></figure>
<p>HTTP/1.1 200 OK<br>Date: Mon, 01 Dec 2008 01:15:39 GMT<br>Server: Apache/2.0.61 (Unix)<br>Access-Control-Allow-Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>Access-Control-Allow-Methods: GET, POST, PUT<br>Access-Control-Allow-Headers: X-Custom-Header<br>Content-Type: text/html; charset=utf-8<br>Content-Encoding: gzip<br>Content-Length: 0<br>Keep-Alive: timeout=2, max=100<br>Connection: Keep-Alive<br>Content-Type: text/plain</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">上面的HTTP回应中，关键的是Access-Control-Allow-Origin字段，表示http:&#x2F;&#x2F;api.bob.com可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。</span><br><span class="line"></span><br><span class="line">如果浏览器否定了&quot;预检&quot;请求，会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被XMLHttpRequest对象的onerror回调函数捕获。控制台会打印出如下的报错信息。</span><br><span class="line"></span><br><span class="line">服务器回应的其他CORS相关字段如下：</span><br></pre></td></tr></table></figure>
<p>Access-Control-Allow-Methods: GET, POST, PUT<br>Access-Control-Allow-Headers: X-Custom-Header<br>Access-Control-Allow-Credentials: true<br>Access-Control-Max-Age: 1728000</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Methods：该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次&quot;预检&quot;请求。</span><br><span class="line">Access-Control-Allow-Headers：如果浏览器请求包括Access-Control-Request-Headers字段，则Access-Control-Allow-Headers字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在&quot;预检&quot;中请求的字段。</span><br><span class="line">Access-Control-Allow-Credentials： 该字段与简单请求时的含义相同。</span><br><span class="line">Access-Control-Max-Age： 该字段可选，用来指定本次预检请求的有效期，单位为秒。上面结果中，有效期是20天（1728000秒），即允许缓存该条回应1728000秒（即20天），在此期间，不用发出另一条预检请求。</span><br><span class="line">浏览器正常请求回应</span><br><span class="line"></span><br><span class="line">一旦服务器通过了&quot;预检&quot;请求，以后每次浏览器正常的CORS请求，就都跟简单请求一样，会有一个Origin头信息字段。服务器的回应，也都会有一个Access-Control-Allow-Origin头信息字段。</span><br></pre></td></tr></table></figure>
<p>PUT /cors HTTP/1.1<br>Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>Host: api.alice.com<br>X-Custom-Header: value<br>Accept-Language: en-US<br>Connection: keep-alive<br>User-Agent: Mozilla/5.0…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器的正常CORS请求。上面头信息的Origin字段是浏览器自动添加的。下面是服务器正常的回应。</span><br></pre></td></tr></table></figure>
<p>Access-Control-Allow-Origin: <a target="_blank" rel="noopener" href="http://api.bob.com/">http://api.bob.com</a><br>Content-Type: text/html; charset=utf-8<br>Access-Control-Allow-Origin字段是每次回应都必定包含的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">结束语</span><br><span class="line"></span><br><span class="line">CORS与JSONP的使用目的相同，但是比JSONP更强大。JSONP只支持GET请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。</span><br><span class="line"></span><br><span class="line">3.7 WebSocket协议跨域</span><br><span class="line">WebSocket protocol是HTML5一种新的协议。它实现了浏览器与服务器全双工通信，同时允许跨域通讯，是server push技术的一种很好的实现。</span><br><span class="line"></span><br><span class="line">原生WebSocket API使用起来不太方便，我们使用Socket.io，它很好地封装了webSocket接口，提供了更简单、灵活的接口，也对不支持webSocket的浏览器提供了向下兼容。</span><br><span class="line"></span><br><span class="line">前端代码：</span><br></pre></td></tr></table></figure>
<div>user input：<input type="text"></div>
<script src="./socket.io.js"></script>
<script>
var socket = io('http://www.domain2.com:8080');

<p>// 连接成功处理<br>socket.on(‘connect’, function() {<br>    // 监听服务端消息<br>    socket.on(‘message’, function(msg) {<br>        console.log(‘data from server: —&gt; ‘ + msg);<br>    });</p>
<pre><code>// 监听服务端关闭
socket.on(&#39;disconnect&#39;, function() &#123; 
    console.log(&#39;Server socket has closed.&#39;); 
&#125;);
</code></pre>
<p>});</p>
<p>document.getElementsByTagName(‘input’)[0].onblur = function() {<br>    socket.send(this.value);<br>};<br></script><br>node Server</p>
<p>var http = require(‘http’);<br>var socket = require(‘socket.io’);</p>
<p>// 启http服务<br>var server = http.createServer(function(req, res) {<br>    res.writeHead(200, {<br>        ‘Content-type’: ‘text/html’<br>    });<br>    res.end();<br>});</p>
<p>server.listen(‘8080’);<br>console.log(‘Server is running at port 8080…’);</p>
<p>// 监听socket连接<br>socket.listen(server).on(‘connection’, function(client) {<br>    // 接收信息<br>    client.on(‘message’, function(msg) {<br>        client.send(‘hello：’ + msg);<br>        console.log(‘data from client: —&gt; ‘ + msg);<br>    });</p>
<pre><code>// 断开处理
client.on(&#39;disconnect&#39;, function() &#123;
    console.log(&#39;Client socket has closed.&#39;); 
&#125;);
</code></pre>
<p>});</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3.8 node代理跨域</span><br><span class="line">node中间件实现跨域代理，是通过启一个代理服务器，实现数据的转发，也可以通过设置cookieDomainRewrite参数修改响应头中cookie中域名，实现当前域的cookie写入，方便接口登录认证。</span><br><span class="line"></span><br><span class="line">利用node + express + http-proxy-middleware搭建一个proxy服务器</span><br><span class="line"></span><br><span class="line">前端代码</span><br></pre></td></tr></table></figure>
<p>var xhr = new XMLHttpRequest();</p>
<p>// 前端开关：浏览器是否读写cookie<br>xhr.withCredentials = true;</p>
<p>// 访问http-proxy-middleware代理服务器<br>xhr.open(‘get’, ‘<a target="_blank" rel="noopener" href="http://www.domain1.com:3000/login?user=admin&#39;">http://www.domain1.com:3000/login?user=admin&#39;</a>, true);<br>xhr.send();<br>后端代码</p>
<p>var express = require(‘express’);<br>var proxy = require(‘http-proxy-middleware’);<br>var app = express();</p>
<p>app.use(‘/‘, proxy({<br>    // 代理跨域目标接口<br>    target: ‘<a href="http://www.domain2.com:8080&#39;">http://www.domain2.com:8080&#39;</a>,<br>    changeOrigin: true,</p>
<pre><code>// 修改响应头信息，实现跨域并允许带cookie
onProxyRes: function(proxyRes, req, res) &#123;
    res.header(&#39;Access-Control-Allow-Origin&#39;, &#39;http://www.domain1.com&#39;);
    res.header(&#39;Access-Control-Allow-Credentials&#39;, &#39;true&#39;);
&#125;,

// 修改响应信息中的cookie域名
cookieDomainRewrite: &#39;www.domain1.com&#39;  // 可以为false，表示不修改
</code></pre>
<p>}));</p>
<p>app.listen(3000);<br>console.log(‘Proxy server is listen at port 3000…’);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3.9 nginx代理跨域</span><br><span class="line">1、 nginx配置解决iconfont跨域</span><br><span class="line">浏览器跨域访问js、css、img等常规静态资源被同源策略许可，但iconfont字体文件(eot|otf|ttf|woff|svg)例外，此时可在nginx的静态资源服务器中加入以下配置。</span><br></pre></td></tr></table></figure>
<p>location / {<br>  add_header Access-Control-Allow-Origin *;<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2、 nginx反向代理接口跨域</span><br><span class="line">跨域原理： 同源策略是浏览器的安全策略，不是HTTP协议的一部分。服务器端调用HTTP接口只是使用HTTP协议，不会执行JS脚本，不需要同源策略，也就不存在跨越问题。</span><br><span class="line"></span><br><span class="line">实现思路：通过nginx配置一个代理服务器（域名与domain1相同，端口不同）做跳板机，反向代理访问domain2接口，并且可以顺便修改cookie中domain信息，方便当前域cookie写入，实现跨域登录。</span><br><span class="line"></span><br><span class="line">nginx具体配置：</span><br></pre></td></tr></table></figure>
<p>#proxy服务器<br>server {<br>    listen       81;<br>    server_name  <a target="_blank" rel="noopener" href="http://www.domain1.com/">www.domain1.com</a>;</p>
<pre><code>location / &#123;
    proxy_pass   http://www.domain2.com:8080;  #反向代理
    proxy_cookie_domain www.domain2.com www.domain1.com; #修改cookie里域名
    index  index.html index.htm;

    # 当用webpack-dev-server等中间件代理接口访问nignx时，此时无浏览器参与，故没有同源限制，下面的跨域配置可不启用
    add_header Access-Control-Allow-Origin http://www.domain1.com;  #当前端只跨域不带cookie时，可为*
    add_header Access-Control-Allow-Credentials true;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.) 前端代码示例：</span><br></pre></td></tr></table></figure>
<p>var xhr = new XMLHttpRequest();</p>
<p>// 前端开关：浏览器是否读写cookie<br>xhr.withCredentials = true;</p>
<p>// 访问nginx中的代理服务器<br>xhr.open(‘get’, ‘<a target="_blank" rel="noopener" href="http://www.domain1.com:81/?user=admin&#39;">http://www.domain1.com:81/?user=admin&#39;</a>, true);<br>xhr.send();</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.) Nodejs后台示例：</span><br></pre></td></tr></table></figure>
<p>var http = require(‘http’);<br>var server = http.createServer();<br>var qs = require(‘querystring’);</p>
<p>server.on(‘request’, function(req, res) {<br>    var params = qs.parse(req.url.substring(2));</p>
<pre><code>// 向前台写cookie
res.writeHead(200, &#123;
    &#39;Set-Cookie&#39;: &#39;l=a123456;Path=/;Domain=www.domain2.com;HttpOnly&#39;   // HttpOnly:脚本无法读取
&#125;);

res.write(JSON.stringify(params));
res.end();
</code></pre>
<p>});</p>
<p>server.listen(‘8080’);<br>console.log(‘Server is running at port 8080…’);</p>
<pre><code>
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/Javascript%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/Javascript%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B2%E8%A7%A3/" class="post-title-link" itemprop="url">Javascript函数式编程要掌握的知识点讲解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 22:09:45" itemprop="dateModified" datetime="2021-03-10T22:09:45+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/Javascript%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B2%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="Javascript函数式编程要掌握的知识点讲解" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>一：理解call和apply 及arguments.callee</strong></p>
<p>ECMAScript3给Function的原型定义了两个方法，他们是<code>Function.prototype.call</code> 和 <code>Function.prototype.apply</code>. 其实他们的作用是一样的，只是传递的参数不一样而已；</p>
<p><strong>1. apply;</strong> 接受2个参数，第一个参数指定了函数体内this对象的指向，第二个参数为一个类似数组的集合，比如如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var yunxi &#x3D; function(a,b)&#123;</span><br><span class="line"></span><br><span class="line">   console.log([a,b]); &#x2F;&#x2F; [1,2]</span><br><span class="line"></span><br><span class="line">   console.log(this &#x3D;&#x3D;&#x3D; window); &#x2F;&#x2F; true</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">yunxi.apply(null,[1,2]);</span><br></pre></td></tr></table></figure>

<p>如上代码，我们第一个参数传入null，函数体内默认会指向与宿主对象，即window对象；因此我们可以在yunxi函数内打印下值为true即可看到：</p>
<p>下面我们来看看使用call方法的实例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var yunxi &#x3D; function(a,b)&#123;</span><br><span class="line"></span><br><span class="line">   console.log([a,b]); &#x2F;&#x2F; [1,2]</span><br><span class="line"></span><br><span class="line">   console.log(this &#x3D;&#x3D;&#x3D; window); &#x2F;&#x2F; true</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">yunxi.call(null,1,2);</span><br></pre></td></tr></table></figure>

<p>可以看到 call方法的第二个参数是以逗号隔开的参数；</p>
<p><strong>那么call和apply用在什么地方呢？</strong></p>
<p>1.call和apply 最常见的用途是改变函数体内的this指向，如下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var longen &#x3D; &#123;</span><br><span class="line">    name:&#39;yunxi&#39;</span><br><span class="line">&#125;;</span><br><span class="line">var longen2 &#x3D; &#123;</span><br><span class="line">    name: &#39;我叫涂根华&#39;</span><br><span class="line">&#125;;</span><br><span class="line">var name &#x3D; &quot;我是来测试的&quot;;</span><br><span class="line">var getName &#x3D; function()&#123;</span><br><span class="line">    return this.name;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(getName()); &#x2F;&#x2F; 打印 &quot;我是来测试的&quot;;</span><br><span class="line">console.log(getName.call(longen)); &#x2F;&#x2F; 打印 yunxi</span><br><span class="line">console.log(getName.call(longen2)); &#x2F;&#x2F; 打印 &quot;我叫涂根华&quot;</span><br></pre></td></tr></table></figure>

<p>第一次调用 <code>getName()</code>方法，因为它是普通函数调用，所以它的this指向与window，因此打印出全局对象的name的值；</p>
<p>第二次调用<code>getName.call(longen);</code>执行这句代码后，getName这个方法的内部指针this指向于longen这个对象了，因此打印<code>this.name</code>实际上是longen.name，因此返回的是<code>name=”yunxi”;</code></p>
<p>但是this指针也有列外的情况，比如一个点击元素，当我们点击一个元素的时候，this指针就指向与那个点击元素，但是当我们在内部再包含一个函数后，在函数内再继续调用this的话，那么现在的this指针就指向了window了；比如如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;longen&quot;).onclick &#x3D; function()&#123;</span><br><span class="line">    console.log(this); &#x2F;&#x2F; this 就指向于div元素对象了</span><br><span class="line">    var func &#x3D; function()&#123;</span><br><span class="line">        console.log(this); &#x2F;&#x2F; 打印出window对象</span><br><span class="line">    &#125;</span><br><span class="line">    func();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上代码。可以看到外部this指向与被点击的那个元素，内部普通函数调用，this指针都是指向于window对象。但是我们可以使用call或者apply方法来改变this的指针的；如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;longen&quot;).onclick &#x3D; function()&#123;</span><br><span class="line">    console.log(this); &#x2F;&#x2F; this 就指向于div元素对象了</span><br><span class="line">    var func &#x3D; function()&#123;</span><br><span class="line">        console.log(this); &#x2F;&#x2F; 就指向于div元素对象了</span><br><span class="line">    &#125;</span><br><span class="line">    func.call(this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上代码我们使用call方法调用func函数，使this指向与func这个对象了，当然上面的方法我们还可以不使用call或者apply方法来改变this的指针，我们可以在外部先使用一个变量来保存this的指针，在内部调用的时候我们可以使用哪个变量即可，如下代码演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;longen&quot;).onclick &#x3D; function()&#123;</span><br><span class="line">    console.log(this); &#x2F;&#x2F; this 就指向于div元素对象了</span><br><span class="line">    var self &#x3D; this;</span><br><span class="line">    var func &#x3D; function()&#123;</span><br><span class="line">        console.log(self); &#x2F;&#x2F; 就指向于div元素对象了</span><br><span class="line">    &#125;</span><br><span class="line">    func();</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p><strong>arguments.callee的理解</strong></p>
<p>callee是arguments的一个属性，它可以被用作当前函数或函数体执行的环境中，或者说调用一个匿名函数；返回的是当前正在被执行的Function对象；简单的来说就是当前执行环境的函数被调用时候，arguments.callee对象会指向与自身，就是当前的那个函数的引用；</p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var count &#x3D; 1;</span><br><span class="line">var test &#x3D; function() &#123;</span><br><span class="line">    console.log(count + &quot; -- &quot; + (test.length &#x3D;&#x3D; arguments.callee.length) );</span><br><span class="line">    &#x2F;&#x2F; 打印出 1 -- true 2 -- true  3 -- true </span><br><span class="line">    if (count++ &lt; 3) &#123;</span><br><span class="line">        &#x2F;&#x2F; 调用test()函数自身</span><br><span class="line">        arguments.callee();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<p><code>arguments.callee()</code>的含义是调用当前正在执行的函数自身，比如上面的test的匿名函数；</p>
<p><strong>Function.prototype.bind介绍</strong></p>
<p>目前很多高级浏览器都支持<code>Function.prototype.bind</code>方法，该方法用来指定函数内部的this指向。为了支持各个浏览器，我们也可以自己来简单的模拟一个~</p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.bind &#x3D; function(context) &#123;</span><br><span class="line">    var self &#x3D; this;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        return self.apply(context,arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var yunxi &#x3D; &#123;</span><br><span class="line">    name: &#39;yunxi&#39;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var func &#x3D; function()&#123;</span><br><span class="line">    console.log(this.name); &#x2F;&#x2F; yunxi</span><br><span class="line">&#125;.bind(yunxi);</span><br><span class="line"></span><br><span class="line">func();</span><br></pre></td></tr></table></figure>

<p>如上代码所示：func这个函数使用调用bind这个方法，并且把对象yunxi作为参数传进去，然后bind函数使用return返回一个函数，当我们调用<code>func()</code>执行这个方法的时候，其实我们就是在调用bind方法内的return返回的那个函数，在返回的那个函数内context的上下文其实就是我们以参数yunxi对象传进去的，因此this指针指向与yunxi这个对象了~ 所以打印出<code>this.name</code> 就是yunxi那个对象的name了;</p>
<p>除了上面我们看到的介绍apply或者call方法可以改变this指针外，我们还可以使用call或者apply来继承对象的方法；实质也就是改变this的指针了；</p>
<p>比如有如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var Yunxi &#x3D; function(name)&#123;</span><br><span class="line">    this.name &#x3D; name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var Longen &#x3D; function()&#123;</span><br><span class="line">    Yunxi.apply(this,arguments);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Longen.prototype.getName &#x3D; function()&#123;</span><br><span class="line">    return this.name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var longen &#x3D; new Longen(&quot;tugenhua&quot;);</span><br><span class="line">console.log(longen.getName());  &#x2F;&#x2F; 打印出tugenhua</span><br></pre></td></tr></table></figure>

<p>如上代码：我先实例化Longen这个对象，把参数传进去，之后使用<code>Yunxi.apply(this,arguments)</code>这句代码来改变Longen这个对象的this的指针，使他指向了Yunxi这个对象，因此Yunxi这个对象保存了longen这个实例化对象的参数tugenhua，因此当我们调用<code>longen.getName</code>这个方法的时候，我们返回<code>this.name</code>，即我们可以认为返回的是<code>Yunxi.name</code> 因此返回的是 tugenhua，我们只是借用了下Yunxi这个对象内的<code>this.name</code>来保存Longen传进去的参数而已；</p>
<p><strong>二：闭包的理解</strong></p>
<p><strong>闭包的结构有如下2个特性</strong></p>
<p>1.封闭性：外界无法访问闭包内部的数据，如果在闭包内声明变量，外界是无法访问的，除非闭包主动向外界提供访问接口；</p>
<p>2.持久性：一般的函数，调用完毕之后，系统自动注销函数，而对于闭包来说，在外部函数被调用之后，闭包结构依然保存在</p>
<p>系统中，闭包中的数据依然存在，从而实现对数据的持久使用。</p>
<p>缺点：</p>
<p>使用闭包会占有内存资源，过多的使用闭包会导致内存溢出等.</p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function a(x) &#123;</span><br><span class="line">    var a &#x3D; x;</span><br><span class="line">    var b &#x3D; function()&#123;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">    return b;</span><br><span class="line">&#125;</span><br><span class="line">var b &#x3D; a(1);</span><br><span class="line">console.log(b()); &#x2F;&#x2F; 1</span><br></pre></td></tr></table></figure>

<p>首先在a函数内定义了2个变量，1个是存储参数，另外一个是闭包结构，在闭包结构中保存着b函数内的a变量，默认情况下，当a函数调用完之后a变量会自动销毁的，但是由于闭包的影响，闭包中使用了外界的变量，因此a变量会一直保存在内存当中，因此变量a参数没有随着a函数销毁而被释放，因此引申出闭包的缺点是：过多的使用闭包会占有内存资源，或内存溢出等肯能性；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 经典的闭包实列如下：</span><br><span class="line">function f(x)&#123;              &#x2F;&#x2F;外部函数</span><br><span class="line">    var a &#x3D; x;              &#x2F;&#x2F; 外部函数的局部变量，并传递参数</span><br><span class="line">    var b &#x3D; function()&#123;     &#x2F;&#x2F; 内部函数 </span><br><span class="line">        return a;           &#x2F;&#x2F; 访问外部函数中的局部变量</span><br><span class="line">    &#125;;</span><br><span class="line">    a++;                    &#x2F;&#x2F; 访问后，动态更新外部函数的变量</span><br><span class="line">    return b;               &#x2F;&#x2F; 返回内部函数</span><br><span class="line">&#125;</span><br><span class="line">var c &#x3D; f(5);               &#x2F;&#x2F; 调用外部函数并且赋值</span><br><span class="line">console.log(c());           &#x2F;&#x2F; 调用内部函数，返回外部函数更新后的值为6</span><br></pre></td></tr></table></figure>

<p><strong>下面我们来看看如下使用闭包的列子</strong></p>
<p>在如下代码中有2个函数，f函数的功能是：把数组类型的参数中每个元素的值分别封装在闭包结构中，然后把闭包存储在一个数组中，并返回这个数组，但是在函数e中调用函数f并向其传递一个数组<code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code>,然后遍历返回函数f返回数组，我们运行打印后发现都是c undefined，那是因为在执行f函数中的循环时候，把值虽然保存在temp中，但是每次循环后temp值在不断的变化，当for循环结束后，此时temp值为c，同时i变为3，因此当调用的时候 打印出来的是temp为3，arrs[3]变为undefined；因此打印出 c undefined</p>
<p>解决闭包的缺陷我们可以再在外面包一层函数，每次循环的时候，把temp参数和i参数传递进去 如代码二</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 代码一</span><br><span class="line">function f(x) &#123;</span><br><span class="line">    var arrs &#x3D; [];</span><br><span class="line">    for(var i &#x3D; 0; i &lt; x.length; i++) &#123;</span><br><span class="line">        var temp &#x3D; x[i];</span><br><span class="line">        arrs.push(function()&#123;</span><br><span class="line">            console.log(temp + &#39; &#39; +x[i]); &#x2F;&#x2F; c undefined</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return arrs;</span><br><span class="line">&#125;</span><br><span class="line">function e()&#123;</span><br><span class="line">    var ar &#x3D; f([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]);</span><br><span class="line">    for(var i &#x3D; 0,ilen &#x3D; ar.length; i &lt; ilen; i++) &#123;</span><br><span class="line">        ar[i]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">e(); </span><br><span class="line">&#x2F;&#x2F; 代码二：</span><br><span class="line">function f2(x) &#123;</span><br><span class="line">    var arrs &#x3D; [];</span><br><span class="line">    for(var i &#x3D; 0; i &lt; x.length; i++) &#123;</span><br><span class="line">        var temp &#x3D; x[i];</span><br><span class="line">        (function(temp,i)&#123;</span><br><span class="line">            arrs.push(function()&#123;</span><br><span class="line">                console.log(temp + &#39; &#39; +x[i]); &#x2F;&#x2F; c undefined</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)(temp,i);</span><br><span class="line">    &#125;</span><br><span class="line">    return arrs;</span><br><span class="line">&#125;</span><br><span class="line">function e2()&#123;</span><br><span class="line">    var ar &#x3D; f2([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]);</span><br><span class="line">    for(var i &#x3D; 0,ilen &#x3D; ar.length; i &lt; ilen; i++) &#123;</span><br><span class="line">        ar[i]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">e2(); </span><br></pre></td></tr></table></figure>

<p><strong>三：javascript中的this详解</strong></p>
<p>this的指向常见的有如下几点需要常用到：</p>
<ol>
<li> 全局对象的this是指向与window；</li>
<li> 作为普通函数调用。</li>
<li> 作为对象方法调用。</li>
<li> 构造器调用。</li>
<li> <code>Function.prototype.call</code> 或 <code>Function.prototype.apply</code>调用。</li>
</ol>
<p>下面我们分别来介绍一下</p>
<p><strong>1.全局对象的this；</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">console.log(this); &#x2F;&#x2F; this指向于window</span><br><span class="line">setTimeout() 和 setInterval()函数内部的this指针是指向于window的，如下代码：</span><br><span class="line"> function test()&#123;</span><br><span class="line">    console.log(11);</span><br><span class="line"> &#125;</span><br><span class="line"> setTimeout(function()&#123;</span><br><span class="line">    console.log(this &#x3D;&#x3D;&#x3D; window); &#x2F;&#x2F; true</span><br><span class="line">    this.test(); &#x2F;&#x2F; 11 </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>2.作为普通函数调用；</strong></p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var name &#x3D; &quot;longen&quot;;</span><br><span class="line">function test()&#123;</span><br><span class="line">    return this.name;</span><br><span class="line">&#125;</span><br><span class="line">console.log(test()); &#x2F;&#x2F; longen</span><br></pre></td></tr></table></figure>

<p>当作为普通函数调用时候，this总是指向了全局对象，在浏览器当中，全局对象一般指的是window；</p>
<p><strong>3.作为对象的方法调用。</strong></p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var obj &#x3D; &#123;</span><br><span class="line">    &quot;name&quot;: &quot;我的花名改为云溪了，就是为了好玩&quot;,</span><br><span class="line">    getName: function()&#123;</span><br><span class="line">        console.log(this); &#x2F;&#x2F; 在这里this指向于obj对象了</span><br><span class="line">        console.log(this.name); &#x2F;&#x2F; 打印 我的花名改为云溪了，就是为了好玩</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.getName(); &#x2F;&#x2F; 对象方法调用</span><br></pre></td></tr></table></figure>

<p>但是呢，我们不能像如下一样调用对象了，如下调用对象的话，this还是执行了window，如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var name &#x3D; &quot;全局对象名字&quot;;</span><br><span class="line">var obj &#x3D; &#123;</span><br><span class="line">    &quot;name&quot;: &quot;我的花名改为云溪了，就是为了好玩&quot;,</span><br><span class="line">    getName: function()&#123;</span><br><span class="line">        console.log(this);  &#x2F;&#x2F; window</span><br><span class="line">        console.log(this.name); &#x2F;&#x2F; 全局对象名字</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var yunxi &#x3D; obj.getName; </span><br><span class="line">yunxi();</span><br></pre></td></tr></table></figure>

<p>运行yunxi()函数，还是会像调用普通函数一样，this指向了window的；</p>
<p><strong>4.构造器调用。</strong><br>Javascript中不像Java一样，有类的概念，而JS中只能通过构造器创建对象，通过new 对象，当new运算符调用函数时候，该函数会返回一个对象，一般情况下，构造器里面的this就是指向返回的这个对象；</p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var Obj &#x3D; function()&#123;</span><br><span class="line">    this.name &#x3D; &quot;yunxi&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">var test &#x3D; new Obj();</span><br><span class="line">console.log(test.name); &#x2F;&#x2F; yunxi</span><br></pre></td></tr></table></figure>

<p>注意：构造器函数第一个字母需要大写，这是为了区分普通函数还是构造器函数而言；</p>
<p>如上代码：通过调用<code>new Obj()</code>方法 返回值保存到test变量中，那么test就是那个对象了，所以内部的this就指向与test对象了，因此<code>test.name</code>就引用到了内部的<code>this.name</code> 即输出 “yunxi”字符串；</p>
<p>但是也有例外的情况，比如构造器显示地返回了一个对象的话，那么这次继续调用的话，那么会最终会返回这个对象，比如如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var obj &#x3D; function()&#123;</span><br><span class="line">    this.name &#x3D; &quot;yunxi&quot;;</span><br><span class="line">    return &#123;</span><br><span class="line">        &quot;age&quot;: &quot;27&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">var test &#x3D; new obj();</span><br><span class="line">console.log(test.name); &#x2F;&#x2F; undefined</span><br></pre></td></tr></table></figure>

<p>那么继续调用的话，会返回unedfined，因为返回的是那个对象，对象里面没有name这个属性，因此值为undefined；</p>
<p><strong>四：理解函数引用和函数调用的区别</strong></p>
<p>看下面的代码分析:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 函数引用 代码一</span><br><span class="line">function f()&#123;</span><br><span class="line">    var x &#x3D; 5;</span><br><span class="line">    return x;</span><br><span class="line">&#125;</span><br><span class="line">var a &#x3D; f;</span><br><span class="line">var b &#x3D; f;</span><br><span class="line"></span><br><span class="line">console.log(a&#x3D;&#x3D;&#x3D;b); &#x2F;&#x2F; true</span><br><span class="line">&#x2F;&#x2F; 函数调用 代码二</span><br><span class="line">function f2() &#123;</span><br><span class="line">    var x &#x3D; 5;</span><br><span class="line">    return x;</span><br><span class="line">&#125;</span><br><span class="line">var a2 &#x3D; f2();</span><br><span class="line">var b2 &#x3D; f2();</span><br><span class="line">console.log(a2 &#x3D;&#x3D;&#x3D; b2);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 函数调用 代码三</span><br><span class="line">function f3()&#123;</span><br><span class="line">    var x &#x3D; 5;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        return x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var a3 &#x3D; f3();</span><br><span class="line">var b3 &#x3D; f3();</span><br><span class="line">console.log(a3 &#x3D;&#x3D;&#x3D; b3); &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>

<p>如上的代码：代码一和代码二分部是函数引用和函数调用的列子，返回都为true，代码三也是函数调用的列子，返回且为false</p>
<p>我们现在来理解下函数引用和函数调用的本质区别：当引用函数时候，多个变量内存存储的是函数的相同的入口指针，因此对于同一个函数来讲，无论多少个变量引用，他们都是相等的，因为对于引用类型(对象，数组，函数等)都是比较的是内存地址，如果他们内存地址一样的话，说明是相同的；但是对于函数调用来讲，比如代码三;每次调用的时候，都被分配一个新的内存地址，所以他们的内存地址不相同，因此他们会返回false，但是对于代码二来讲，我们看到他们没有返回函数，只是返回数值，他们比较的不是内存地址，而是比较值，所以他们的值相等，因此他们也返回true，我们也可以看看如下实列化一个对象的列子，他们也被分配到不同的内存地址，因此他们也是返回false的；如下代码测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function F()&#123;</span><br><span class="line">    this.x &#x3D; 5;</span><br><span class="line">&#125;</span><br><span class="line">var a &#x3D; new F();</span><br><span class="line">var b &#x3D; new F();</span><br><span class="line">console.log(a &#x3D;&#x3D;&#x3D; b); &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>

<p><strong>五：理解js中的链式调用</strong></p>
<p>我们使用jquery的时候，jquery的简单的语法及可实现链式调用方法，现在我们自己也封装一个链式调用的方法，来理解下 jquery中如何封装链式调用 无非就是每次调用一个方法的时候 给这个方法返回this即可，this指向该对象自身，我们看看代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义一个简单的对象，每次调用对象的方法的时候，该方法都返回该对象自身</span><br><span class="line">var obj &#x3D; &#123;</span><br><span class="line">    a: function()&#123;</span><br><span class="line">        console.log(&quot;输出a&quot;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;,</span><br><span class="line">    b:function()&#123;</span><br><span class="line">        console.log(&quot;输出b&quot;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">console.log(obj.a().b()); &#x2F;&#x2F; 输出a 输出b 输出this指向与obj这个对象</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 下面我们再看下 上面的通过Function扩展类型添加方法的demo如下：</span><br><span class="line">Function.prototype.method &#x3D; function(name,func) &#123;</span><br><span class="line">    if(!this.prototype[name]) &#123;</span><br><span class="line">        this.prototype[name] &#x3D; func;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String.method(&#39;trim&#39;,function()&#123;</span><br><span class="line">    return this.replace(&#x2F;^\s+|\s+$&#x2F;g,&#39;&#39;);</span><br><span class="line">&#125;);</span><br><span class="line">String.method(&#39;log2&#39;,function()&#123;</span><br><span class="line">    console.log(&quot;链式调用&quot;);</span><br><span class="line">    return this;</span><br><span class="line">&#125;);</span><br><span class="line">String.method(&#39;r&#39;,function()&#123;</span><br><span class="line">    return this.replace(&#x2F;a&#x2F;,&#39;&#39;);</span><br><span class="line">&#125;);</span><br><span class="line">var str &#x3D; &quot; abc &quot;;</span><br><span class="line">console.log(str.trim().log2().r()); &#x2F;&#x2F; 输出链式调用和 bc</span><br></pre></td></tr></table></figure>

<p><strong>六：理解使用函数实现历史记录–提高性能</strong></p>
<p>函数可以使用对象去记住先前操作的结果，从而避免多余的运算。比如我们现在测试一个费波纳茨的算法，我们可以使用递归函数计算fibonacci数列，一个fibonacci数字是之前两个fibonacci数字之和，最前面的两个数字是0和1；代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var count &#x3D; 0;</span><br><span class="line"> var fibonacci &#x3D; function(n) &#123;</span><br><span class="line">    count++;</span><br><span class="line">    return n &lt; 2 ? n : fibonacci(n-1) + fibonacci(n-2);</span><br><span class="line"> &#125;;</span><br><span class="line"> for(var i &#x3D; 0; i &lt;&#x3D; 10; i+&#x3D;1) &#123;</span><br><span class="line">    console.log(i+&quot;:&quot;+fibonacci(i));</span><br><span class="line"> &#125;</span><br><span class="line"> console.log(count); &#x2F;&#x2F; 453</span><br></pre></td></tr></table></figure>

<p>我们可以看到如上 fibonacci函数总共调用了453次，for循环了11次，它自身调用了442次，如果我们使用下面的记忆函数的话，那么就可以减少他们的运算次数，从而提高性能；</p>
<p>思路：先使用一个临时数组保存存储结果，当函数被调用的时候，先看是否已经有存储结果 如果有的话，就立即返回这个存储结果，否则的话，调用函数运算下；代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var count2 &#x3D; 0;</span><br><span class="line">var fibonacci2 &#x3D; (function()&#123;</span><br><span class="line">    var memo &#x3D; [0,1];</span><br><span class="line">    var fib &#x3D; function(n) &#123;</span><br><span class="line">        var result &#x3D; memo[n];</span><br><span class="line">        count2++;</span><br><span class="line">        if(typeof result !&#x3D;&#x3D; &#39;number&#39;) &#123;</span><br><span class="line">            result &#x3D; fib(n-1) + fib(n-2);</span><br><span class="line">            memo[n] &#x3D; result;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line">    return fib;</span><br><span class="line"> &#125;)();</span><br><span class="line"> for(var j &#x3D; 0; j &lt;&#x3D; 10; j+&#x3D;1) &#123;</span><br><span class="line">    console.log(j+&quot;:&quot;+fibonacci2(j));</span><br><span class="line"> &#125;</span><br><span class="line"> console.log(count2); &#x2F;&#x2F; 29</span><br></pre></td></tr></table></figure>

<p>这个函数也返回了同样的结果，但是只调用了函数29次，循环了11次，也就是说函数自身调用了18次，从而减少无谓的函数的调用及运算，下面我们可以把这个函数进行抽象化，以构造带记忆功能的函数，如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var count3 &#x3D; 0;</span><br><span class="line">var memoizer &#x3D; function(memo,formula) &#123;</span><br><span class="line">    var recur &#x3D; function(n) &#123;</span><br><span class="line">        var result &#x3D; memo[n];</span><br><span class="line">        count3++;   &#x2F;&#x2F; 这句代码只是说明运行函数多少次，在代码中并无作用，实际使用上可以删掉</span><br><span class="line">        if(typeof result !&#x3D;&#x3D; &#39;number&#39;) &#123;</span><br><span class="line">            result &#x3D; formula(recur,n);</span><br><span class="line">            memo[n] &#x3D; result;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line">    return recur;</span><br><span class="line"> &#125;;</span><br><span class="line"> var fibonacci3 &#x3D; memoizer([0,1],function(recur,n)&#123;</span><br><span class="line">    return recur(n-1) + recur(n-2);</span><br><span class="line"> &#125;);</span><br><span class="line"> &#x2F;&#x2F; 调用方式如下</span><br><span class="line"> for(var k &#x3D; 0; k &lt;&#x3D;10; k+&#x3D;1) &#123;</span><br><span class="line">    console.log(k+&quot;:&quot;+fibonacci3(k));</span><br><span class="line"> &#125;</span><br><span class="line"> console.log(count3); &#x2F;&#x2F; 29</span><br></pre></td></tr></table></figure>

<p>如上封装 memoizer 里面的参数是实现某个方法的计算公式，具体的可以根据需要自己手动更改，这边的思路无非就是想习惯使用对象去保存临时值，从而减少不必要的取值存储值的操作；</p>
<p><strong>七：理解通过Function扩展类型</strong></p>
<p>javascript 允许为语言的基本数据类型定义方法。通过<code>Object.prototype</code>添加原型方法，该方法可被所有的对象使用。</p>
<p>这对函数，字符串，数字，正则和布尔值都适用，比如如下现在给<code>Function.prototype</code>增加方法，使该方法对所有函数都可用，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.method &#x3D; function(name,func) &#123;</span><br><span class="line">    if(!this.prototype[name]) &#123;</span><br><span class="line">        this.prototype[name] &#x3D; func;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Number.method(&#39;integer&#39;,function()&#123;</span><br><span class="line">    return Math[this &lt; 0 ? &#39;ceil&#39; : &#39;floor&#39;](this);</span><br><span class="line">&#125;);</span><br><span class="line">console.log((-10&#x2F;3).integer()); &#x2F;&#x2F; -3</span><br><span class="line"></span><br><span class="line">String.method(&#39;trim&#39;,function()&#123;</span><br><span class="line">    return this.replace(&#x2F;^\s+|\s+$&#x2F;g,&#39;&#39;);</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot; abc &quot;.trim()); &#x2F;&#x2F; abc</span><br></pre></td></tr></table></figure>

<p><strong>八：理解使用模块模式编写代码</strong></p>
<p>使用函数和闭包可以构建模块，所谓模块，就是一个提供接口却隐藏状态与实现的函数或对象。使用函数构建模块的优点是：减少全局变量的使用；</p>
<p>比如如下：我想为String扩展一个方法，该方法的作用是寻找字符串中的HTML字符字体并将其替换为对应的字符；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 如下代码：</span><br><span class="line">Function.prototype.method &#x3D; function(name,func) &#123;</span><br><span class="line">    if(!this.prototype[name]) &#123;</span><br><span class="line">        this.prototype[name] &#x3D; func;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">String.method(&#39;deentityify&#39;,function()&#123;</span><br><span class="line">    var entity &#x3D; &#123;</span><br><span class="line">        quot: &#39;&quot;&#39;,</span><br><span class="line">        It: &#39;&lt;&#39;,</span><br><span class="line">        gt: &#39;&gt;&#39;</span><br><span class="line">    &#125;;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        return this.replace(&#x2F;&amp;([^&amp;;]+);&#x2F;g,function(a,b)&#123;</span><br><span class="line">            var r &#x3D; entity[b];</span><br><span class="line">            return typeof r &#x3D;&#x3D;&#x3D; &#39;string&#39; ? r : a;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;());</span><br><span class="line">console.log(&quot;&amp;It;&quot;&gt;&quot;.deentityify()); &#x2F;&#x2F; &lt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>模块模式利用函数作用域和闭包来创建绑定对象与私有成员的关联，比如在上面的deentityify()方法才有权访问字符实体表entity这个数据对象；</p>
<p>模块开发的一般形式是：定义了私有变量和函数的函数，利用闭包创建可以访问到的私有变量和函数的特权函数，最后返回这个特权函数，或把他们保存到可以访问的地方。</p>
<p>模块模式一般会结合实例模式使用。javascript的实例就是使用对象字面量表示法创建的。对象的属性值可以是数值或者函数，并且属性值在该对象的生命周期中不会发生变化；比如如下代码属于模块模式：定义了一个私有变量name属性，和一个实例模式(对象字面量obj)并且返回这个对象字面量obj，对象字面量中的方法与私有变量name进行了绑定；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 比如如下经典的模块模式</span><br><span class="line">var MODULE &#x3D; (function()&#123;</span><br><span class="line">    var name &#x3D; &quot;tugenhua&quot;;</span><br><span class="line">    var obj &#x3D; &#123;</span><br><span class="line">        setName: function() &#123;</span><br><span class="line">            this.name &#x3D; name;</span><br><span class="line">        &#125;,</span><br><span class="line">        getName: function()&#123;</span><br><span class="line">            return this.name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    return obj;</span><br><span class="line">&#125;)();</span><br><span class="line">MODULE.setName()</span><br><span class="line">console.log(MODULE.getName()); &#x2F;&#x2F; tugenhua</span><br></pre></td></tr></table></figure>

<p><strong>九：理解惰性实列化</strong></p>
<p>在页面中javascript初始化执行的时候就实例化类，如果在页面中没有使用这个实列化的对象，就会造成一定的内存浪费和性能损耗；这时候，我们可以使用惰性实列化来解决这个问题，惰性就是把实列化推迟到需要使用它的时候才去做，做到 “按需供应”;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 惰性实列化代码如下</span><br><span class="line">var myNamespace &#x3D; function()&#123;</span><br><span class="line">    var Configure &#x3D; function()&#123;</span><br><span class="line">        var privateName &#x3D; &quot;tugenhua&quot;;</span><br><span class="line">        var privateGetName &#x3D; function()&#123;</span><br><span class="line">            return privateName;</span><br><span class="line">        &#125;;</span><br><span class="line">        var privateSetName &#x3D; function(name) &#123;</span><br><span class="line">            privateName &#x3D; name;</span><br><span class="line">        &#125;;</span><br><span class="line">        &#x2F;&#x2F; 返回单列对象</span><br><span class="line">        return &#123;</span><br><span class="line">            setName: function(name) &#123;</span><br><span class="line">                privateSetName(name);</span><br><span class="line">            &#125;,</span><br><span class="line">            getName: function()&#123;</span><br><span class="line">                return privateGetName();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; 存储Configure实列</span><br><span class="line">    var instance;</span><br><span class="line">    return &#123;</span><br><span class="line">        init: function()&#123;</span><br><span class="line">            &#x2F;&#x2F; 如果不存在实列，就创建单列实列</span><br><span class="line">            if(!instance) &#123;</span><br><span class="line">                instance &#x3D; Configure();</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; 创建Configure单列</span><br><span class="line">            for(var key in instance) &#123;</span><br><span class="line">                if(instance.hasOwnProperty(key)) &#123;</span><br><span class="line">                    this[key] &#x3D; instance[key];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            this.init &#x3D; null;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;();</span><br><span class="line">&#x2F;&#x2F; 调用方式</span><br><span class="line">myNamespace.init();</span><br><span class="line">var name &#x3D; myNamespace.getName();</span><br><span class="line">console.log(name); &#x2F;&#x2F; tugenhua</span><br></pre></td></tr></table></figure>

<p>如上代码是惰性化实列代码：它包括一个单体Configure实列，直接返回init函数，先判断该单体是否被实列化，如果没有被实列化的话，则创建并执行实列化并返回该实列化，如果已经实列化了，则返回现有实列；执行完后，则销毁init方法，只初始化一次</p>
<p><strong>十：推荐分支函数(解决兼容问题的更好的方法)</strong></p>
<p>分支函数的作用是：可以解决兼容问题if或者else的重复判断的问题，我们一般的做法是：根据兼容的不同写if，else等，这些判断来实现兼容，但是这样明显就有一个缺点，每次执行这个函数的时候，都需要进行if和else的检测，效率明显不高，我们现在使用分支函数来实现当初始化的时候进行一些检测，在之后的运行代码过程中，代码就无需检测了；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 我们先来看看传统的封装ajax请求的函数</span><br><span class="line">&#x2F;&#x2F;创建XMLHttpRequest对象：</span><br><span class="line">var xmlhttp;</span><br><span class="line">function createxmlhttp()&#123;</span><br><span class="line">    if (window.XMLHttpRequest)&#123;</span><br><span class="line">        &#x2F;&#x2F; code for IE7+, Firefox, Chrome, Opera, Safari</span><br><span class="line">        xmlhttp&#x3D;new XMLHttpRequest();</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      &#x2F;&#x2F; code for IE6, IE5</span><br><span class="line">      xmlhttp&#x3D;new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 下面我们看看分支函数代码如下：</span><br><span class="line">var XHR &#x3D; (function()&#123;</span><br><span class="line">    var standard &#x3D; &#123;</span><br><span class="line">        createXHR : function() &#123;</span><br><span class="line">            return new XMLHttpRequest();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    var oldActionXObject &#x3D; &#123;</span><br><span class="line">        createXHR : function()&#123;</span><br><span class="line">            return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    var newActionXObject &#x3D; &#123;</span><br><span class="line">        createXHR : function()&#123;</span><br><span class="line">            return new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    if(standard.createXHR) &#123;</span><br><span class="line">        return standard;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            newActionXObject.createXHR();</span><br><span class="line">            return newActionXObject;</span><br><span class="line">        &#125;catch(e)&#123;</span><br><span class="line">            oldActionXObject.createXHR();</span><br><span class="line">            return oldActionXObject;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">console.log(XHR.createXHR()); &#x2F;&#x2F;xmlHttpRequest对象</span><br></pre></td></tr></table></figure>

<p>上面的代码就是分支函数，分支的原理是：声明几个不同名称的对象，且为该不同名称对象声明一个相同的方法，然后根据不同的浏览器设计来实现，接着开始进行浏览器检测，并且根据浏览器检测来返回哪一个对象，不论返回的是哪一个对象，最后它一致对外的接口都是createXHR方法的；</p>
<p><strong>十一：惰性载入函数（也是解决兼容问题的）</strong></p>
<p>和上面分支的原理是一样的，代码也可以按照上面的推荐分支风格编码的；解决的问题也是解决多个if条件判断的；代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 代码如下：</span><br><span class="line">var addEvent &#x3D; function(el,type,handler)&#123;</span><br><span class="line">    addEvent &#x3D; el.addEventListener ? function(el,type,handler)&#123;</span><br><span class="line">        el.addEventListener(type,handler,false);</span><br><span class="line">    &#125; : function(el,type,handler) &#123;</span><br><span class="line">        el.attachEvent(&quot;on&quot; + type,handler);</span><br><span class="line">    &#125;</span><br><span class="line">    addEvent(el,type,handler);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>惰性载入函数也是在函数内部改变自身的一种方式，在重复执行的时候就不会再进行检测的；惰性载入函数的分支只会执行一次，即第一次调用的时候，其优点如下：</p>
<ol>
<li><p> 要执行的适当代码只有在实际调用函数时才执行。</p>
</li>
<li><p> 第一次调用该函数的时候，紧接着内部函数也会执行，但是正因为这个，所以后续继续调用该函数的话，后续的调用速度会很快；因此避免了多重条件；</p>
</li>
</ol>
<p><strong>十二：理解函数节流</strong></p>
<p>DOM操作的交互需要更多的内存和CPU时间，连续进行过多的DOM相关的操作可能会导致浏览器变慢甚至崩溃，函数节流的设计思想是让某些代码可以在间断的情况下连续重复执行，实现该方法可以使用定时器对该函数进行节流操作;</p>
<p>比如：第一次调用函数的时候，创建一个定时器，在指定的时间间隔下执行代码。当第二次执行的时候，清除前一次的定时器并设置另一个，将其替换成一个新的定时器;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 如下简单函数节流代码演示</span><br><span class="line">var throttle &#x3D; &#123;</span><br><span class="line">    timeoutId: null,</span><br><span class="line">    &#x2F;&#x2F; 需要执行的方法</span><br><span class="line">    preformMethod: function()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 初始化需要调用的方法</span><br><span class="line">    process: function()&#123;</span><br><span class="line">        clearTimeout(this.timeoutId);</span><br><span class="line">        var self &#x3D; this;</span><br><span class="line">        self.timeoutId &#x3D; setTimeout(function()&#123;</span><br><span class="line">            self.preformMethod();</span><br><span class="line">        &#125;,100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F; 执行操作</span><br><span class="line">throttle.process();</span><br></pre></td></tr></table></figure>

<p>函数节流解决的问题是一些代码(比如事件)无间断的执行，这可能会影响浏览器的性能，比如浏览器变慢或者直接崩溃。比如对于mouseover事件或者click事件，比如点击tab项菜单，无限的点击，有可能会导致浏览器会变慢操作，这时候我们可以使用函数节流的操作来解决；<br>原文地址：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/tugenhua0707/p/5046854.html">http://www.cnblogs.com/tugenhua0707/p/5046854.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/es6%E5%AD%A6%E4%B9%A0%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/es6%E5%AD%A6%E4%B9%A0%E4%B8%80/" class="post-title-link" itemprop="url">es6学习一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/es6%E5%AD%A6%E4%B9%A0%E4%B8%80/" class="post-meta-item leancloud_visitors" data-flag-title="es6学习一" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="let和const"><a href="#let和const" class="headerlink" title="let和const"></a>let和const</h1><p>介绍let和const之前先说说var关键字，他有几个特点：</p>
<ol>
<li>可以重复声明<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br></pre></td></tr></table></figure></li>
<li>无法限制修改<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">a = <span class="number">2</span></span><br></pre></td></tr></table></figure></li>
<li>没有块级作用域<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)  &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h2 id="let的使用"><a href="#let的使用" class="headerlink" title="let的使用"></a>let的使用</h2><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4>ES6 新增了let命令，用来声明变量。它的用法类似于var，但是所声明的变量，只在let命令所在的代码块内有效。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a <span class="comment">// ReferenceError: a is not defined.</span></span><br><span class="line">b <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for循环的计数器，就很合适使用let命令</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(i);</span><br><span class="line"><span class="comment">// ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure>

<h4 id="不存在变量提升"><a href="#不存在变量提升" class="headerlink" title="不存在变量提升"></a>不存在变量提升</h4><p>var命令会发生“变量提升”现象，即变量可以在声明之前使用，值为undefined。这种现象多多少少是有些奇怪的，按照一般的逻辑，变量应该在声明语句之后才可以使用。</p>
<p>为了纠正这种现象，let命令改变了语法行为，它所声明的变量一定要在声明后使用，否则报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var 的情况</span></span><br><span class="line"><span class="built_in">console</span>.log(foo); <span class="comment">// 输出undefined</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let 的情况</span></span><br><span class="line"><span class="built_in">console</span>.log(bar); <span class="comment">// 报错ReferenceError</span></span><br><span class="line"><span class="keyword">let</span> bar = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h4 id="暂时性死区"><a href="#暂时性死区" class="headerlink" title="暂时性死区"></a>暂时性死区</h4><p>在代码块内，使用let命令声明变量之前，该变量都是不可用的。这在语法上，称为“暂时性死区”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// TDZ开始</span></span><br><span class="line">  tmp = <span class="string">&#x27;abc&#x27;</span>; <span class="comment">// ReferenceError</span></span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// ReferenceError</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> tmp; <span class="comment">// TDZ结束</span></span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">  tmp = <span class="number">123</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(tmp); <span class="comment">// 123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，在let命令声明变量tmp之前，都属于变量tmp的“死区”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> x; <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="keyword">let</span> x;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> undeclared_variable <span class="comment">// &quot;undefined&quot;</span></span><br></pre></td></tr></table></figure>
<p>“暂时性死区”也意味着typeof不再是一个百分之百安全的操作。</p>
<h4 id="不允许重复声明"><a href="#不允许重复声明" class="headerlink" title="不允许重复声明"></a>不允许重复声明</h4><p>let不允许在相同作用域内，重复声明同一个变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arg;</span><br><span class="line">&#125;</span><br><span class="line">func() <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> arg;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">func() <span class="comment">// 不报错</span></span><br></pre></td></tr></table></figure>

<h4 id="ES6-的块级作用域"><a href="#ES6-的块级作用域" class="headerlink" title="ES6 的块级作用域"></a>ES6 的块级作用域</h4><p>let实际上为 JavaScript 新增了块级作用域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> n = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(n); <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="const使用"><a href="#const使用" class="headerlink" title="const使用"></a>const使用</h2><p>const声明一个只读的常量。一旦声明，常量的值就不能改变。<br>const声明的变量不得改变值，这意味着，const一旦声明变量，就必须立即初始化，不能留到以后赋值。<br>const的作用域与let命令相同：只在声明所在的块级作用域内有效。<br>const命令声明的常量也是不提升，同样存在暂时性死区，只能在声明的位置后面使用。<br>const声明的常量，也与let一样不可重复声明。</p>
<h1 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h1><h4 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h4><p>ES6 允许使用“箭头”（=&gt;）定义函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="params">v</span> =&gt;</span> v;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function">() =&gt;</span> <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> num1 + num2;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果箭头函数的代码块部分多于一条语句，就要使用大括号将它们括起来，并且使用return语句返回。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="function">(<span class="params">num1, num2</span>) =&gt;</span> &#123; <span class="keyword">return</span> num1 + num2; &#125;</span><br></pre></td></tr></table></figure>
<p>箭头函数的一个用处是简化回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常函数写法</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数写法</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常函数写法</span></span><br><span class="line"><span class="keyword">var</span> result = values.sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数写法</span></span><br><span class="line"><span class="keyword">var</span> result = values.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br></pre></td></tr></table></figure>
<h4 id="使用注意点"><a href="#使用注意点" class="headerlink" title="使用注意点"></a>使用注意点</h4><p>箭头函数有几个使用注意点。</p>
<p>（1）函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。</p>
<p>（2）不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。</p>
<p>（3）不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。</p>
<p>（4）不可以使用yield命令，因此箭头函数不能用作 Generator 函数。</p>
<p>上面四点中，第一点尤其值得注意。this对象的指向是可变的，但是在箭头函数中，它是固定的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  id: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">      event =&gt; <span class="built_in">this</span>.doSomething(event.type), <span class="literal">false</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  doSomething: <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Handling &#x27;</span> + type  + <span class="string">&#x27; for &#x27;</span> + <span class="built_in">this</span>.id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">handler.init() </span><br><span class="line"><span class="comment">// 出发点击事件会打印： Handling click for 123456</span></span><br></pre></td></tr></table></figure>
<p>这里要理解this的指向问题</p>
<p>this指向的固定化，并不是因为箭头函数内部有绑定this的机制，实际原因是箭头函数根本没有自己的this，导致内部的this就是外层代码块的this。正是因为它没有this，所以也就不能用作构造函数。</p>
<p>所以，箭头函数转成 ES5 的代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;id:&#x27;</span>, <span class="built_in">this</span>.id);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;id:&#x27;</span>, _this.id);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，转换后的 ES5 版本清楚地说明了，箭头函数里面根本没有自己的this，而是引用外层的this。</p>
<p>请问下面的代码之中有几个this？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;id:&#x27;</span>, <span class="built_in">this</span>.id);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = foo.call(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t1 = f.call(&#123;<span class="attr">id</span>: <span class="number">2</span>&#125;)()(); <span class="comment">// id: 1</span></span><br><span class="line"><span class="keyword">var</span> t2 = f().call(&#123;<span class="attr">id</span>: <span class="number">3</span>&#125;)(); <span class="comment">// id: 1</span></span><br><span class="line"><span class="keyword">var</span> t3 = f()().call(&#123;<span class="attr">id</span>: <span class="number">4</span>&#125;); <span class="comment">// id: 1</span></span><br></pre></td></tr></table></figure>
<h1 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h1><p>ES6 允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructuring）。本质上，这种写法属于“模式匹配”，只要等号两边的模式相同，左边的变量就会被赋予对应的值。<br>什么使模式匹配，从数组或对象等号左边和等号右边模式相同，对应的变量就是对应的值</p>
<h4 id="数组的解构赋值"><a href="#数组的解构赋值" class="headerlink" title="数组的解构赋值"></a>数组的解构赋值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es5可以这样声明变量</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 也可以这样</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">let</span> [x, , y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">//  x = 1, y = 3</span></span><br><span class="line"><span class="keyword">let</span> [head, ...tail] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]; <span class="comment">// head: 1, tail: [1, 2, 3, 4]</span></span><br><span class="line"><span class="keyword">let</span> [x, y, ...z] = [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">x <span class="comment">// &quot;a&quot;</span></span><br><span class="line">y <span class="comment">// undefined</span></span><br><span class="line">z <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<p>如果解构不成功变量的值就会等于undefined</p>
<p>不完全结构嵌套</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, [b, c], d] = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> [x, y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; <span class="comment">// x = 1, y = 2</span></span><br></pre></td></tr></table></figure>
<p>上述代码中左右两边对应的结构式相同的，解构过程中会根据从左到右顺序一次给对应的变量赋值</p>
<p>注意：如果等号右边不是数组，则会报错</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> [a] = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> [c] = <span class="literal">true</span></span><br><span class="line"><span class="keyword">var</span> [a] = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> [a] = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">var</span> [a] = <span class="literal">null</span></span><br><span class="line"><span class="comment">// xx is not iterable</span></span><br></pre></td></tr></table></figure>
<p>可以设置默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [foo = <span class="literal">true</span>] = [];</span><br><span class="line">foo <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> [x, y = <span class="string">&#x27;b&#x27;</span>] = [<span class="string">&#x27;a&#x27;</span>]; <span class="comment">// x=&#x27;a&#x27;, y=&#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">let</span> [x, y = <span class="string">&#x27;b&#x27;</span>] = [<span class="string">&#x27;a&#x27;</span>, <span class="literal">undefined</span>]; <span class="comment">// x=&#x27;a&#x27;, y=&#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">let</span> [x = <span class="number">1</span>] = [<span class="literal">undefined</span>];</span><br><span class="line">x <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">let</span> [x = <span class="number">1</span>] = [<span class="literal">null</span>];</span><br><span class="line">x <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>以上的代码总结：设置默认是es6内部使用严格（===）进行判断变量是否为undefined，只有等于undefined时，默认值设置才会生效</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [x = <span class="number">1</span>, y = x] = [];     <span class="comment">// x=1; y=1</span></span><br><span class="line"><span class="keyword">let</span> [x = <span class="number">1</span>, y = x] = [<span class="number">2</span>];    <span class="comment">// x=2; y=2</span></span><br><span class="line"><span class="keyword">let</span> [x = <span class="number">1</span>, y = x] = [<span class="number">1</span>, <span class="number">2</span>]; <span class="comment">// x=1; y=2</span></span><br><span class="line"><span class="comment">// 之所以会报错，是因为x用y做默认值时，y还没有声明。</span></span><br><span class="line"><span class="keyword">let</span> [x = y, y = <span class="number">1</span>] = [];     <span class="comment">// ReferenceError: y is not defined</span></span><br></pre></td></tr></table></figure>
<p>默认值可以引用解构赋值的其他变量，但该变量必须已经声明。</p>
<h4 id="对象的解构赋值"><a href="#对象的解构赋值" class="headerlink" title="对象的解构赋值"></a>对象的解构赋值</h4><p>对象的解构赋值和数组时类似<br>对象和变量解构对应，不同的是，属性必须是对象中存在的属性，否则变量就会等于undefined</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">bar</span>: <span class="string">&quot;bbb&quot;</span> &#125;;</span><br><span class="line">foo <span class="comment">// &quot;aaa&quot;</span></span><br><span class="line">bar <span class="comment">// &quot;bbb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; baz &#125; = &#123; <span class="attr">foo</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">bar</span>: <span class="string">&quot;bbb&quot;</span> &#125;;</span><br><span class="line">baz <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果变量名和属性名不一样的情况</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: baz &#125; = &#123; <span class="attr">foo</span>: <span class="string">&#x27;aaa&#x27;</span>, <span class="attr">bar</span>: <span class="string">&#x27;bbb&#x27;</span> &#125;;</span><br><span class="line">baz <span class="comment">// &quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">first</span>: <span class="string">&#x27;hello&#x27;</span>, <span class="attr">last</span>: <span class="string">&#x27;world&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">first</span>: f, <span class="attr">last</span>: l &#125; = obj;</span><br><span class="line">f <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line">l <span class="comment">// &#x27;world&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 那么可以总结一下：以上的解构赋值的写法实际上是下面这种方式的简写</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: foo, <span class="attr">bar</span>: bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">bar</span>: <span class="string">&quot;bbb&quot;</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>也就是说，对象的解构赋值的内部机制，是先找到同名属性，然后再赋给对应的变量。真正被赋值的是后者，而不是前者。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: baz &#125; = &#123; <span class="attr">foo</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">bar</span>: <span class="string">&quot;bbb&quot;</span> &#125;;</span><br><span class="line">baz <span class="comment">// &quot;aaa&quot;</span></span><br><span class="line">foo <span class="comment">// error: foo is not defined</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，foo是匹配的模式，baz才是变量。真正被赋值的是变量baz，而不是模式foo。</p>
<p>对象的解构也可以指定默认值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123;x = <span class="number">3</span>&#125; = &#123;&#125;;</span><br><span class="line">x <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123;x, y = <span class="number">5</span>&#125; = &#123;<span class="attr">x</span>: <span class="number">1</span>&#125;;</span><br><span class="line">x <span class="comment">// 1</span></span><br><span class="line">y <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">x</span>: y = <span class="number">3</span>&#125; = &#123;&#125;;</span><br><span class="line">y <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123;<span class="attr">x</span>: y = <span class="number">3</span>&#125; = &#123;<span class="attr">x</span>: <span class="number">5</span>&#125;;</span><br><span class="line">y <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123; <span class="attr">message</span>: msg = <span class="string">&#x27;Something went wrong&#x27;</span> &#125; = &#123;&#125;;</span><br><span class="line">msg <span class="comment">// &quot;Something went wrong&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认值生效的条件是，对象的属性值严格等于undefined。</span></span><br><span class="line"><span class="keyword">var</span> &#123;x = <span class="number">3</span>&#125; = &#123;<span class="attr">x</span>: <span class="literal">undefined</span>&#125;;</span><br><span class="line">x <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> &#123;x = <span class="number">3</span>&#125; = &#123;<span class="attr">x</span>: <span class="literal">null</span>&#125;;</span><br><span class="line">x <span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串的解构赋值"><a href="#字符串的解构赋值" class="headerlink" title="字符串的解构赋值"></a>字符串的解构赋值</h4><p>字符串也可以解构赋值。这是因为此时，字符串被转换成了一个类似数组的对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [a, b, c, d, e] = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">a <span class="comment">// &quot;h&quot;</span></span><br><span class="line">b <span class="comment">// &quot;e&quot;</span></span><br><span class="line">c <span class="comment">// &quot;l&quot;</span></span><br><span class="line">d <span class="comment">// &quot;l&quot;</span></span><br><span class="line">e <span class="comment">// &quot;o&quot;</span></span><br></pre></td></tr></table></figure>
<p>类似数组的对象都有一个length属性，因此还可以对这个属性解构赋值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="attr">length</span> : len&#125; = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">len <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>变量的解构赋值用途很多。</p>
<p>（1）交换变量值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">[x, y] = [y, x];</span><br></pre></td></tr></table></figure>
<p>（2）从函数返回多个值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [a, b, c] = example();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个对象</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    foo: <span class="number">1</span>,</span><br><span class="line">    bar: <span class="number">2</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = example();</span><br></pre></td></tr></table></figure>
<p>（3）提取 JSON 数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonData = &#123;</span><br><span class="line">  retCode: <span class="string">&#x27;000000&#x27;</span>,</span><br><span class="line">  retInfo: <span class="string">&quot;字段校验成功&quot;</span>,</span><br><span class="line">  data: [<span class="number">867</span>, <span class="number">5309</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; retCode, retInfo, <span class="attr">data</span>: number &#125; = jsonData;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(id, status, number);</span><br><span class="line"><span class="comment">// &#x27;000000&#x27;, &quot;字段校验成功&quot;, [867, 5309]</span></span><br></pre></td></tr></table></figure>
<p>等等。。。。。。</p>
<h1 id="对象、数组、字符串的扩展"><a href="#对象、数组、字符串的扩展" class="headerlink" title="对象、数组、字符串的扩展"></a>对象、数组、字符串的扩展</h1><h4 id="对象的扩展"><a href="#对象的扩展" class="headerlink" title="对象的扩展"></a>对象的扩展</h4><p>对象定义过程中更简单写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> io = <span class="string">&#x27;computed&#x27;</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">	io,</span><br><span class="line">	<span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line"><span class="keyword">var</span> io = <span class="string">&#x27;computed&#x27;</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	io: io,</span><br><span class="line">	foo: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数组的扩展"><a href="#数组的扩展" class="headerlink" title="数组的扩展"></a>数组的扩展</h4><p>（1）扩展运算符<br>扩展运算符（spread）是三个点（…）。它好比 rest 参数的逆运算，将一个数组转为用逗号分隔的参数序列。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>, ...[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]) <span class="comment">// 1,2,3,4</span></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于函数的参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> number = [<span class="number">35</span>, <span class="number">27</span>]</span><br><span class="line">add(...number) <span class="comment">// 62</span></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line">add(number[<span class="number">0</span>], number[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于函数替代apply的方法</span></span><br><span class="line"><span class="comment">// ES5 的写法</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])</span><br><span class="line"><span class="comment">// ES6 的写法</span></span><br><span class="line"><span class="built_in">Math</span>.max(...[<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="built_in">Math</span>.max(<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">new</span> (<span class="built_in">Date</span>.bind.apply(<span class="built_in">Date</span>, [<span class="literal">null</span>, <span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]))</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(...[<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>扩展运算符的应用</p>
<p>1.复制数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浅度复制</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> arrCopy = arr</span><br><span class="line"><span class="comment">// 这样的简单复制只是将数组的指针赋给了arrCopy变量，所以arr和arrCopy数组的元素改变时，另一个也会同时改变</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"><span class="built_in">console</span>.log(arrCopy) <span class="comment">// [0, &#x27;world&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// es5解决方法</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> arrCopy = arr.concat()</span><br><span class="line">arr[<span class="number">0</span>] = <span class="string">&#x27;OK&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(arrCopy) <span class="comment">// [&#x27;hello&#x27;, &#x27;world&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展运算符提供了复制数组的简便写法。</span></span><br><span class="line"><span class="keyword">const</span> a1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="keyword">const</span> a2 = [...a1];</span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="keyword">const</span> [...a2] = a1;</span><br><span class="line"><span class="comment">/* 注意：扩展运算符只能赋值数组元素为基本数据类型的元素，</span></span><br><span class="line"><span class="comment">如果元素的数据类型为引用类型，依然保存的是应用类型的指针 */</span></span><br></pre></td></tr></table></figure>
<p>2.合并数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">const</span> b = [<span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// es5</span></span><br><span class="line">a.concat(b) <span class="comment">// [2,3,5,12,13]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="keyword">const</span> result = [...a, ...b] <span class="comment">// [2,3,5,12,13]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这两种方式也都是浅拷贝，如果修改了原数组的成员，会同步反映到新数组。</span></span><br><span class="line"><span class="keyword">const</span> a1 = [&#123; <span class="attr">foo</span>: <span class="number">1</span> &#125;];</span><br><span class="line"><span class="keyword">const</span> a2 = [&#123; <span class="attr">bar</span>: <span class="number">2</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a3 = a1.concat(a2);</span><br><span class="line"><span class="keyword">const</span> a4 = [...a1, ...a2];</span><br><span class="line"></span><br><span class="line">a3[<span class="number">0</span>] === a1[<span class="number">0</span>] <span class="comment">// true</span></span><br><span class="line">a4[<span class="number">0</span>] === a1[<span class="number">0</span>] <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>3.与解构赋值结合<br>扩展运算符可以与解构赋值结合起来，用于生成数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line">a = list[<span class="number">0</span>], rest = list.slice(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">[a, ...rest] = list</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">first <span class="comment">// 1</span></span><br><span class="line">rest  <span class="comment">// [2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [];</span><br><span class="line">first <span class="comment">// undefined</span></span><br><span class="line">rest  <span class="comment">// []</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="string">&quot;foo&quot;</span>];</span><br><span class="line">first  <span class="comment">// &quot;foo&quot;</span></span><br><span class="line">rest   <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<p>如果将扩展运算符用于数组赋值，只能放在参数的最后一位，否则会报错。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [...butLast, last] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...middle, last] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>

<p>（2）Array.from()<br>Array.from方法用于将两类对象转为真正的数组：类似数组的对象（伪数组）和可遍历（iterable）的对象（包括 ES6 新增的数据结构 Set 和 Map）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    length: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [].slice.call(arrayLike); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="keyword">let</span> arr2 = <span class="built_in">Array</span>.from(arrayLike); <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<p>实际应用中，常见的类似数组的对象是 DOM 操作返回的 NodeList 集合，以及函数内部的arguments对象。Array.from都可以将它们转为真正的数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeList对象</span></span><br><span class="line"><span class="keyword">let</span> ps = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line"><span class="built_in">Array</span>.from(ps).filter(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> p.textContent.length &gt; <span class="number">100</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// arguments对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）Array.of()<br>Array.of方法用于将一组值，转换为数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.of(<span class="number">3</span>, <span class="number">11</span>, <span class="number">8</span>) <span class="comment">// [3,11,8]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">3</span>) <span class="comment">// [3]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">3</span>).length <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>（4）数组实例的 includes()<br>Array.prototype.includes方法返回一个布尔值，表示某个数组是否包含给定的值，与字符串的includes方法类似。ES2016 引入了该方法。<br>参数： 该方法接受两个参数，第一个参数接受一个数值，第二个参数搜索的起始位置，默认为0。如果第二个参数为负数，则表示倒数的位置，如果这时它大于数组长度（比如第二个参数为-4，但数组长度为3），则会重置为从0开始。<br>返回值： 布尔类型，true表示搜索的结果在当前的数组中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">2</span>)     <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">4</span>)     <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="literal">NaN</span>].includes(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, <span class="number">3</span>);  <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, -<span class="number">1</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>与indexOf的比较：indexOf的含义是找到参数值的第一个出现位置，所以要去比较是否不等于-1，表达起来不够直观。二是，它内部使用严格相等运算符（===）进行判断，这会导致对NaN的误判。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">NaN</span>].indexOf(<span class="literal">NaN</span>)</span><br></pre></td></tr></table></figure>

<p>下面代码用来检查当前环境是否支持该方法，如果不支持，部署一个简易的替代版本。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contains = (<span class="function">() =&gt;</span></span><br><span class="line">  <span class="built_in">Array</span>.prototype.includes</span><br><span class="line">    ? <span class="function">(<span class="params">arr, value</span>) =&gt;</span> arr.includes(value)</span><br><span class="line">    : <span class="function">(<span class="params">arr, value</span>) =&gt;</span> arr.some(<span class="function"><span class="params">el</span> =&gt;</span> el === value)</span><br><span class="line">)();</span><br><span class="line">contains([<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>], <span class="string">&#x27;baz&#x27;</span>); <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串的扩展"><a href="#字符串的扩展" class="headerlink" title="字符串的扩展"></a>字符串的扩展</h4><p>模版字符串</p>
<p>模板字符串（template string）是增强版的字符串，用反引号（`）标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。</p>
<p>传统的 JavaScript 语言，输出模板通常是这样写的（下面使用了 jQuery 的方法）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#result&#x27;</span>).append(</span><br><span class="line">  <span class="string">&#x27;There are &lt;b&gt;&#x27;</span> + basket.count + <span class="string">&#x27;&lt;/b&gt; &#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;items in your basket, &#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;&lt;em&gt;&#x27;</span> + basket.onSale +</span><br><span class="line">  <span class="string">&#x27;&lt;/em&gt; are on sale!&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">/*上面这种写法相当繁琐不方便，因为变量与字符串之间的拼接需要用到+和引号，</span></span><br><span class="line"><span class="comment">并且换行时不方便，ES6 引入了模板字符串解决这个问题。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$(<span class="string">&#x27;#result&#x27;</span>).append(<span class="string">`</span></span><br><span class="line"><span class="string">  There are &lt;b&gt;<span class="subst">$&#123;basket.count&#125;</span>&lt;/b&gt; items</span></span><br><span class="line"><span class="string">   in your basket, &lt;em&gt;<span class="subst">$&#123;basket.onSale&#125;</span>&lt;/em&gt;</span></span><br><span class="line"><span class="string">  are on sale!</span></span><br><span class="line"><span class="string">`</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通字符串</span></span><br><span class="line"><span class="string">`In JavaScript &#x27;\n&#x27; is a line-feed.`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多行字符串</span></span><br><span class="line"><span class="string">`In JavaScript this is</span></span><br><span class="line"><span class="string"> not legal.`</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`string text line 1</span></span><br><span class="line"><span class="string">string text line 2`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串中嵌入变量</span></span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;Bob&quot;</span>, time = <span class="string">&quot;today&quot;</span>;</span><br><span class="line"><span class="string">`Hello <span class="subst">$&#123;name&#125;</span>, how are you <span class="subst">$&#123;time&#125;</span>?`</span></span><br></pre></td></tr></table></figure>

<h4 id="函数的扩展"><a href="#函数的扩展" class="headerlink" title="函数的扩展"></a>函数的扩展</h4><p>（1）函数参数的默认值<br>es6增加了函数参数的默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">this</span>.x = x || <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">	<span class="built_in">this</span>.y = y || <span class="string">&#x27;world&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span> (<span class="params">x = <span class="string">&#x27;hello&#x27;</span>, y = <span class="string">&#x27;world&#x27;</span></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">this</span>.x = x ;</span><br><span class="line">	<span class="built_in">this</span>.y = y<span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>设置函数的默认参数之后，函数内部不能再次声明，否则会报错</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">boo</span> (<span class="params">x = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Identifier &#x27;x&#x27; has already been declared</span></span><br></pre></td></tr></table></figure>

<p>另外，一个容易忽略的地方是，参数默认值不是传值的，而是每次都重新计算默认值表达式的值。也就是说，参数默认值是惰性求值的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">99</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">p = x + <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">100</span>;</span><br><span class="line">foo() <span class="comment">// 101</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，参数p的默认值是x + 1。这时，每次调用函数foo，都会重新计算x + 1，而不是默认p等于 100。</p>
<p>（2）rest 参数<br>ES6 引入 rest 参数（形式为…变量名），用于获取函数的多余参数，这样就不需要使用arguments对象了。rest 参数搭配的变量是一个数组，该变量将多余的参数放入数组中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...values</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> val <span class="keyword">of</span> values) &#123;</span><br><span class="line">    sum += val;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>上面代码的add函数是一个求和函数，利用 rest 参数，可以向该函数传入任意数目的参数。</p>
<p>下面是一个 rest 参数代替arguments变量的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arguments变量的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortNumbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>).sort();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rest参数的写法</span></span><br><span class="line"><span class="keyword">const</span> sortNumbers = <span class="function">(<span class="params">...numbers</span>) =&gt;</span> numbers.sort();</span><br></pre></td></tr></table></figure>
<p>上面代码的两种写法，比较后可以发现，rest 参数的写法更自然也更简洁。</p>
<p>arguments对象不是数组，而是一个类似数组的对象。所以为了使用数组的方法，必须使用Array.prototype.slice.call先将其转为数组。rest 参数就不存在这个问题，它就是一个真正的数组，数组特有的方法都可以使用。下面是一个利用 rest 参数改写数组push方法的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">array, ...items</span>) </span>&#123;</span><br><span class="line">  items.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    array.push(item);</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line">push(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>ES6 引入 rest 参数（形式为…变量名），用于获取函数的多余参数，这样就不需要使用arguments对象了。rest 参数搭配的变量是一个数组，该变量将多余的参数放入数组中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">...values</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> val <span class="keyword">of</span> values) &#123;</span><br><span class="line">    sum += val;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>上面代码的add函数是一个求和函数，利用 rest 参数，可以向该函数传入任意数目的参数。</p>
<p>下面是一个 rest 参数代替arguments变量的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arguments变量的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortNumbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>).sort();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rest参数的写法</span></span><br><span class="line"><span class="keyword">const</span> sortNumbers = <span class="function">(<span class="params">...numbers</span>) =&gt;</span> numbers.sort();</span><br></pre></td></tr></table></figure>
<p>上面代码的两种写法，比较后可以发现，rest 参数的写法更自然也更简洁。</p>
<p>arguments对象不是数组，而是一个类似数组的对象。所以为了使用数组的方法，必须使用Array.prototype.slice.call先将其转为数组。rest 参数就不存在这个问题，它就是一个真正的数组，数组特有的方法都可以使用。下面是一个利用 rest 参数改写数组push方法的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">array, ...items</span>) </span>&#123;</span><br><span class="line">  items.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    array.push(item);</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line">push(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>注意，rest 参数之后不能再有其他参数（即只能是最后一个参数），否则会报错。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, ...b, c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数的length属性，不包括 rest 参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;&#125;).length  <span class="comment">// 1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">...a</span>) </span>&#123;&#125;).length  <span class="comment">// 0</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a, ...b</span>) </span>&#123;&#125;).length  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>注意，rest 参数之后不能再有其他参数（即只能是最后一个参数），否则会报错。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, ...b, c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数的length属性，不包括 rest 参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;&#125;).length  <span class="comment">// 1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">...a</span>) </span>&#123;&#125;).length  <span class="comment">// 0</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">a, ...b</span>) </span>&#123;&#125;).length  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86/" class="post-title-link" itemprop="url">浏览器缓存基本认识</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86/" class="post-meta-item leancloud_visitors" data-flag-title="浏览器缓存基本认识" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>浏览器缓存，也就是客户端缓存，既是网页性能优化里面静态资源相关优化的一大利器，也是无数web开发人员在工作过程不可避免的一大问题，所以在产品开发的时候我们总是想办法避免缓存产生，而在产品发布之时又在想策略管理缓存提升网页的访问速度。了解浏览器的缓存命中原理，是开发web应用的基础，本文着眼于此，学习浏览器缓存的相关知识，总结缓存避免和缓存管理的方法，结合具体的场景说明缓存的相关问题。希望能对有需要的人有所帮助。</p>
<p>1. 浏览器缓存基本认识</p>
<p>它分为强缓存和协商缓存： </p>
<p>1）浏览器在加载资源时，先根据这个资源的一些http header判断它是否命中强缓存，强缓存如果命中，浏览器直接从自己的缓存中读取资源，不会发请求到服务器。比如某个css文件，如果浏览器在加载它所在的网页时，这个css文件的缓存配置命中了强缓存，浏览器就直接从缓存中加载这个css，连请求都不会发送到网页所在服务器；</p>
<p>2）当强缓存没有命中的时候，浏览器一定会发送一个请求到服务器，通过服务器端依据资源的另外一些http header验证这个资源是否命中协商缓存，如果协商缓存命中，服务器会将这个请求返回，但是不会返回这个资源的数据，而是告诉客户端可以直接从缓存中加载这个资源，于是浏览器就又会从自己的缓存中去加载这个资源；</p>
<p>3）强缓存与协商缓存的共同点是：如果命中，都是从客户端缓存中加载资源，而不是从服务器加载资源数据；区别是：强缓存不发请求到服务器，协商缓存会发请求到服务器。</p>
<p>4）当协商缓存也没有命中的时候，浏览器直接从服务器加载资源数据。</p>
<p>2. 强缓存的原理</p>
<p>当浏览器对某个资源的请求命中了强缓存时，返回的http状态为200，在chrome的开发者工具的network里面size会显示为from cache，比如京东的首页里就有很多静态资源配置了强缓存，用chrome打开几次，再用f12查看network，可以看到有不少请求就是从缓存中加载的：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-cfb575b65a490aa6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp" alt="image"></p>
<p>强缓存是利用Expires或者Cache-Control这两个http response header实现的，它们都用来表示资源在客户端缓存的有效期。</p>
<p>Expires是http1.0提出的一个表示资源过期时间的header，它描述的是一个绝对时间，由服务器返回，用GMT格式的字符串表示，如：Expires:Thu, 31 Dec 2037 23:55:55 GMT，它的缓存原理是：</p>
<p>1）浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上Expires的header，如：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-67a099b1dbbd9ede.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/378/format/webp" alt="image"></p>
<p>2）浏览器在接收到这个资源后，会把这个资源连同所有response header一起缓存下来（所以缓存命中的请求返回的header并不是来自服务器，而是来自之前缓存的header）；</p>
<p>3）浏览器再请求这个资源时，先从缓存中寻找，找到这个资源后，拿出它的Expires跟当前的请求时间比较，如果请求时间在Expires指定的时间之前，就能命中缓存，否则就不行。</p>
<p>4）如果缓存没有命中，浏览器直接从服务器加载资源时，Expires Header在重新加载的时候会被更新。</p>
<p>Expires是较老的强缓存管理header，由于它是服务器返回的一个绝对时间，在服务器时间与客户端时间相差较大时，缓存管理容易出现问题，比如随意修改下客户端时间，就能影响缓存命中的结果。所以在http1.1的时候，提出了一个新的header，就是Cache-Control，这是一个相对时间，在配置缓存的时候，以秒为单位，用数值表示，如：Cache-Control:max-age=315360000，它的缓存原理是：</p>
<p>1）浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上Cache-Control的header，如：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-e1e928ebfb43cf14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/551/format/webp" alt="image"></p>
<p>2）浏览器在接收到这个资源后，会把这个资源连同所有response header一起缓存下来；</p>
<p>3）浏览器再请求这个资源时，先从缓存中寻找，找到这个资源后，根据它第一次的请求时间和Cache-Control设定的有效期，计算出一个资源过期时间，再拿这个过期时间跟当前的请求时间比较，如果请求时间在过期时间之前，就能命中缓存，否则就不行。</p>
<p>4）如果缓存没有命中，浏览器直接从服务器加载资源时，Cache-Control Header在重新加载的时候会被更新。</p>
<p>Cache-Control描述的是一个相对时间，在进行缓存命中的时候，都是利用客户端时间进行判断，所以相比较Expires，Cache-Control的缓存管理更有效，安全一些。</p>
<p>这两个header可以只启用一个，也可以同时启用，当response header中，Expires和Cache-Control同时存在时，Cache-Control优先级高于Expires：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-05a82b4ae250487a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/491/format/webp" alt="image"></p>
<p>3. 强缓存的管理</p>
<p>前面介绍的是强缓存的原理，在实际应用中我们会碰到需要强缓存的场景和不需要强缓存的场景，通常有2种方式来设置是否启用强缓存：</p>
<p>1）通过代码的方式，在web服务器返回的响应中添加Expires和Cache-Control Header；</p>
<p>2）通过配置web服务器的方式，让web服务器在响应资源的时候统一添加Expires和Cache-Control Header。</p>
<p>比如在javaweb里面，我们可以使用类似下面的代码设置强缓存：</p>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=javascript:;">+ View code</a></p>
<p>还可以通过类似下面的java代码设置不启用强缓存：</p>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=javascript:;">+ View code</a></p>
<p>tomcat还提供了一个ExpiresFilter专门用来配置强缓存，具体使用的方式可参考tomcat的官方文档：<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html%23Expires_Filter">http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#Expires_Filter</a></p>
<p>nginx和apache作为专业的web服务器，都有专门的配置文件，可以配置expires和cache-control，这方面的知识，如果你对运维感兴趣的话，可以在百度上搜索“nginx 设置 expires cache-control”或“apache 设置 expires cache-control”都能找到不少相关的文章。</p>
<p>由于在开发的时候不会专门去配置强缓存，而浏览器又默认会缓存图片，css和js等静态资源，所以开发环境下经常会因为强缓存导致资源没有及时更新而看不到最新的效果，解决这个问题的方法有很多，常用的有以下几种：</p>
<p>1）直接ctrl+f5，这个办法能解决页面直接引用的资源更新的问题；</p>
<p>2）使用浏览器的隐私模式开发；</p>
<p>3）如果用的是chrome，可以f12在network那里把缓存给禁掉（这是个非常有效的方法）：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-d4447787f6dd2cdb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/687/format/webp" alt="image"></p>
<p>4）在开发阶段，给资源加上一个动态的参数，如css/index.css?v=0.0001，由于每次资源的修改都要更新引用的位置，同时修改参数的值，所以操作起来不是很方便，除非你是在动态页面比如jsp里开发就可以用服务器变量来解决（v=${sysRnd}），或者你能用一些前端的构建工具来处理这个参数修改的问题；</p>
<p>5）如果资源引用的页面，被嵌入到了一个iframe里面，可以在iframe的区域右键单击重新加载该页面，以chrome为例：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-91bd6528ce390f9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/280/format/webp" alt="image"></p>
<p>6）如果缓存问题出现在ajax请求中，最有效的解决办法就是ajax的请求地址追加随机数；</p>
<p>7）还有一种情况就是动态设置iframe的src时，有可能也会因为缓存问题，导致看不到最新的效果，这时候在要设置的src后面添加随机数也能解决问题；</p>
<p>8）如果你用的是grunt和gulp这种前端工具开发，通过它们的插件比如grunt-contrib-connect来启动一个静态服务器，则完全不用担心开发阶段的资源更新问题，因为在这个静态服务器下的所有资源返回的respone header中，cache-control始终被设置为不缓存：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-811c2c36bf5d419b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/523/format/webp" alt="image"></p>
<p>4. 强缓存的应用</p>
<p>强缓存是前端性能优化最有力的工具，没有之一，对于有大量静态资源的网页，一定要利用强缓存，提高响应速度。通常的做法是，为这些静态资源全部配置一个超时时间超长的Expires或Cache-Control，这样用户在访问网页时，只会在第一次加载时从服务器请求静态资源，其它时候只要缓存没有失效并且用户没有强制刷新的条件下都会从自己的缓存中加载，比如前面提到过的京东首页缓存的资源，它的缓存过期时间都设置到了2026年：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-b92722283de1422c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/491/format/webp" alt="image"></p>
<p>然而这种缓存配置方式会带来一个新的问题，就是发布时资源更新的问题，比如某一张图片，在用户访问第一个版本的时候已经缓存到了用户的电脑上，当网站发布新版本，替换了这个图片时，已经访问过第一个版本的用户由于缓存的设置，导致在默认的情况下不会请求服务器最新的图片资源，除非他清掉或禁用缓存或者强制刷新，否则就看不到最新的图片效果。</p>
<p>这个问题已经有成熟的解决方案，具体内容可阅读知乎这篇文章详细了解：</p>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.zhihu.com/question/20790576">http://www.zhihu.com/question/20790576</a></p>
<p>文章提到的东西都属于理论上的解决方案，不过现在已经有很多前端工具能够实际地解决这个问题，由于每个工具涉及到的内容细节都有很多，本文没有办法一一深入介绍。有兴趣的可以去了解下grunt gulp webpack fis 还有edp这几个工具，基于这几个工具都能解决这个问题，尤其是fis和edp是百度推出的前端开发平台，有现成的文档可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://fis.baidu.com/fis3/api/index.html">http://fis.baidu.com/fis3/api/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://ecomfe.github.io/edp/doc/initialization/install/">http://ecomfe.github.io/edp/doc/initialization/install/</a></p>
<p>强缓存还有一点需要注意的是，通常都是针对静态资源使用，动态资源需要慎用，除了服务端页面可以看作动态资源外，那些引用静态资源的html也可以看作是动态资源，如果这种html也被缓存，当这些html更新之后，可能就没有机制能够通知浏览器这些html有更新，尤其是前后端分离的应用里，页面都是纯html页面，每个访问地址可能都是直接访问html页面，这些页面通常不加强缓存，以保证浏览器访问这些页面时始终请求服务器最新的资源。</p>
<p>5. 协商缓存的原理</p>
<p>当浏览器对某个资源的请求没有命中强缓存，就会发一个请求到服务器，验证协商缓存是否命中，如果协商缓存命中，请求响应返回的http状态为304并且会显示一个Not Modified的字符串，比如你打开京东的首页，按f12打开开发者工具，再按f5刷新页面，查看network，可以看到有不少请求就是命中了协商缓存的：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-d585f64198f3d8ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp" alt="image"></p>
<p>查看单个请求的Response Header，也能看到304的状态码和Not Modified的字符串，只要看到这个就可说明这个资源是命中了协商缓存，然后从客户端缓存中加载的，而不是服务器最新的资源：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-545761fa0143432f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/777/format/webp" alt="image"></p>
<p>协商缓存是利用的是【Last-Modified，If-Modified-Since】和【ETag、If-None-Match】这两对Header来管理的。</p>
<p>【Last-Modified，If-Modified-Since】的控制缓存的原理是：</p>
<p>1）浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上Last-Modified的header，这个header表示这个资源在服务器上的最后修改时间：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-064d4be1e2d4195b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/418/format/webp" alt="image"></p>
<p>2）浏览器再次跟服务器请求这个资源时，在request的header上加上If-Modified-Since的header，这个header的值就是上一次请求时返回的Last-Modified的值：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-d0e283cc3dbceee9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/844/format/webp" alt="image"></p>
<p>3）服务器再次收到资源请求时，根据浏览器传过来If-Modified-Since和资源在服务器上的最后修改时间判断资源是否有变化，如果没有变化则返回304 Not Modified，但是不会返回资源内容；如果有变化，就正常返回资源内容。当服务器返回304 Not Modified的响应时，response header中不会再添加Last-Modified的header，因为既然资源没有变化，那么Last-Modified也就不会改变，这是服务器返回304时的response header：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-32766c5eab8824f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/380/format/webp" alt="image"></p>
<p>4）浏览器收到304的响应后，就会从缓存中加载资源。</p>
<p>5）如果协商缓存没有命中，浏览器直接从服务器加载资源时，Last-Modified Header在重新加载的时候会被更新，下次请求时，If-Modified-Since会启用上次返回的Last-Modified值。</p>
<p>【Last-Modified，If-Modified-Since】都是根据服务器时间返回的header，一般来说，在没有调整服务器时间和篡改客户端缓存的情况下，这两个header配合起来管理协商缓存是非常可靠的，但是有时候也会服务器上资源其实有变化，但是最后修改时间却没有变化的情况，而这种问题又很不容易被定位出来，而当这种情况出现的时候，就会影响协商缓存的可靠性。所以就有了另外一对header来管理协商缓存，这对header就是【ETag、If-None-Match】。它们的缓存管理的方式是：</p>
<p>1）浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上ETag的header，这个header是服务器根据当前请求的资源生成的一个唯一标识，这个唯一标识是一个字符串，只要资源有变化这个串就不同，跟最后修改时间没有关系，所以能很好的补充Last-Modified的问题：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-6653a932aa13d102.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/398/format/webp" alt="image"></p>
<p>2）浏览器再次跟服务器请求这个资源时，在request的header上加上If-None-Match的header，这个header的值就是上一次请求时返回的ETag的值：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-04c00f2b3b7a9aac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/822/format/webp" alt="image"></p>
<p>3）服务器再次收到资源请求时，根据浏览器传过来If-None-Match和然后再根据资源生成一个新的ETag，如果这两个值相同就说明资源没有变化，否则就是有变化；如果没有变化则返回304 Not Modified，但是不会返回资源内容；如果有变化，就正常返回资源内容。与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-37c4c3c9c51fccbb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/374/format/webp" alt="image"></p>
<p>4）浏览器收到304的响应后，就会从缓存中加载资源。</p>
<p>6. 协商缓存的管理</p>
<p>协商缓存跟强缓存不一样，强缓存不发请求到服务器，所以有时候资源更新了浏览器还不知道，但是协商缓存会发请求到服务器，所以资源是否更新，服务器肯定知道。大部分web服务器都默认开启协商缓存，而且是同时启用【Last-Modified，If-Modified-Since】和【ETag、If-None-Match】，比如apache:</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-692989d5bf667513.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/468/format/webp" alt="image"></p>
<p>如果没有协商缓存，每个到服务器的请求，就都得返回资源内容，这样服务器的性能会极差。</p>
<p>【Last-Modified，If-Modified-Since】和【ETag、If-None-Match】一般都是同时启用，这是为了处理Last-Modified不可靠的情况。有一种场景需要注意：</p>
<p>分布式系统里多台机器间文件的Last-Modified必须保持一致，以免负载均衡到不同机器导致比对失败；</p>
<p>分布式系统尽量关闭掉ETag(每台机器生成的ETag都会不一样）；</p>
<p>京东页面的资源请求，返回的repsones header就只有Last-Modified，没有ETag：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-d101e2dafb7f8ca7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600/format/webp" alt="image"></p>
<p>协商缓存需要配合强缓存使用，你看前面这个截图中，除了Last-Modified这个header，还有强缓存的相关header，因为如果不启用强缓存的话，协商缓存根本没有意义。</p>
<p>7. 浏览器行为对缓存的影响</p>
<p>如果资源已经被浏览器缓存下来，在缓存失效之前，再次请求时，默认会先检查是否命中强缓存，如果强缓存命中则直接读取缓存，如果强缓存没有命中则发请求到服务器检查是否命中协商缓存，如果协商缓存命中，则告诉浏览器还是可以从缓存读取，否则才从服务器返回最新的资源。这是默认的处理方式，这个方式可能被浏览器的行为改变：</p>
<p>1）当ctrl+f5强制刷新网页时，直接从服务器加载，跳过强缓存和协商缓存；</p>
<p>2）当f5刷新网页时，跳过强缓存，但是会检查协商缓存；</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/nirvana/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/nirvana/">1</a><span class="space">&hellip;</span><a class="page-number" href="/nirvana/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/nirvana/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/nirvana/page/19/">19</a><a class="extend next" rel="next" href="/nirvana/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nirvana</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">532k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">8:04</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/nirvana/js/utils.js"></script><script src="/nirvana/js/motion.js"></script><script src="/nirvana/js/next-boot.js"></script>

  
<script src="/nirvana/js/local-search.js"></script>






  


<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"SPsNUvBhME7XmrjzCfHkUu3e-gzGzoHsz","app_key":"4TONafemiIzvJUwqLa7WveoL","server_url":"https://leancloud.cn","security":true,"betterPerformance":false};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>



</body>
</html>
