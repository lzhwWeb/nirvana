<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
 <meta name="referrer" content="no-referrer"/>

  <link rel="apple-touch-icon" sizes="180x180" href="/nirvana/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/nirvana/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/nirvana/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/nirvana/images/logo.svg" color="#222">

<link rel="stylesheet" href="/nirvana/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lzhwweb.github.io","root":"/nirvana/","images":"/nirvana/images","scheme":"Gemini","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/nirvana/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="个人学习笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="涅槃快乐是金">
<meta property="og:url" content="https://lzhwweb.github.io/nirvana/page/8/index.html">
<meta property="og:site_name" content="涅槃快乐是金">
<meta property="og:description" content="个人学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nirvana">
<meta property="article:tag" content="前端,javascript,node,git">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lzhwweb.github.io/nirvana/page/8/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>涅槃快乐是金</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/nirvana/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">涅槃快乐是金</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/nirvana/" rel="section">首页</a></li>
        <li class="menu-item menu-item-git"><a href="/nirvana/categories/git" rel="section">git</a></li>
        <li class="menu-item menu-item-linux"><a href="/nirvana/categories/linux" rel="section">linux</a></li>
        <li class="menu-item menu-item-android"><a href="/nirvana/categories/android" rel="section">android</a></li>
        <li class="menu-item menu-item-随笔"><a href="/nirvana/categories/informal" rel="section">随笔</a></li>
        <li class="menu-item menu-item-mac"><a href="/nirvana/categories/mac" rel="section">mac</a></li>
        <li class="menu-item menu-item-react-native"><a href="/nirvana/categories/reactnative" rel="section">react-native</a></li>
        <li class="menu-item menu-item-算法"><a href="/nirvana/categories/algorithm" rel="section">算法</a></li>
        <li class="menu-item menu-item-读书笔记"><a href="/nirvana/categories/note" rel="section">读书笔记</a></li>
        <li class="menu-item menu-item-开发工具"><a href="/nirvana/categories/tool" rel="section">开发工具</a></li>
        <li class="menu-item menu-item-设计模式(ts)"><a href="/nirvana/categories/DesignPattern" rel="section">设计模式(TS)</a></li>
        <li class="menu-item menu-item-前端"><a href="/nirvana/categories/javascript" rel="section">前端</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="nirvana"
      src="/nirvana/images/headphoto.jpeg">
  <p class="site-author-name" itemprop="name">nirvana</p>
  <div class="site-description" itemprop="description">个人学习笔记</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/nirvana/archives">
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lzhwWeb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lzhwWeb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDJS%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%ADJS%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDJS%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%ADJS%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90/" class="post-title-link" itemprop="url">动态加载JS过程中如何判断JS加载完成</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDJS%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%ADJS%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90/" class="post-meta-item leancloud_visitors" data-flag-title="动态加载JS过程中如何判断JS加载完成" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在正常的加载过程中，js文件的加载是同步的，也就是说在js加载的过程中，浏览器会阻塞接下来的内容的解析。这时候，动态加载便显得尤为重要了，由于它是异步加载，因此，它可以在后台自动下载，并不会妨碍其它内容的正常解析，由此，便可以提高页面首次加载的速度。</p>
<p>那么，既然js是异步加载，我们又该如何判断它是否加载完成呢？</p>
<p>在IE或一些基于IE内核的浏览器中（如Maxthon）,它是通过script节点的readystatechange方法来判断的，而其它的一些浏览器中，往往是通过load事件来决定的，如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function dynamicLoad() &#123;</span><br><span class="line">    var _doc &#x3D; document.getElementsByTagName(&#39;head&#39;)[0];</span><br><span class="line">    var script &#x3D; document.createElement(&#39;script&#39;);</span><br><span class="line">    script.setAttribute(&#39;type&#39;, &#39;text&#x2F;javascript&#39;);</span><br><span class="line">    script.setAttribute(&#39;src&#39;, &#39;jquery-1.4.4.js&#39;);</span><br><span class="line">    script.onload &#x3D; script.onreadystatechange &#x3D; function () &#123;</span><br><span class="line">        if (!this.readyState || this.readyState &#x3D;&#x3D; &#39;loaded&#39; || this.readyState &#x3D;&#x3D; &#39;complete&#39;) &#123;</span><br><span class="line">            alert(&#39;done&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        script.onload &#x3D; script.onreadystatechange &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们把该方法添加到body的load事件中，<body onload='dynamicLoad()'>，运行，会发现IE或Maxthon中，会弹出‘done’对话框，但是firefox或chrome中却完全没有反应，why?</p>
<p>这是因为，如果script节点没有添加到DOM树中，那么在chrome和firefox中是不会响应script的load事件的。但是IE中却可以。。修改后如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function dynamicLoad() &#123;</span><br><span class="line">    var _doc &#x3D; document.getElementsByTagName(&#39;head&#39;)[0];</span><br><span class="line">    var script &#x3D; document.createElement(&#39;script&#39;);</span><br><span class="line">    script.setAttribute(&#39;type&#39;, &#39;text&#x2F;javascript&#39;);</span><br><span class="line">    script.setAttribute(&#39;src&#39;, &#39;jquery-1.4.4.js&#39;);</span><br><span class="line">    _doc.appendChild(script);</span><br><span class="line">    script.onload &#x3D; script.onreadystatechange &#x3D; function () &#123;</span><br><span class="line">        if (!this.readyState || this.readyState &#x3D;&#x3D; &#39;loaded&#39; || this.readyState &#x3D;&#x3D; &#39;complete&#39;) &#123;</span><br><span class="line">            alert(&#39;done&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        script.onload &#x3D; script.onreadystatechange &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>这时候，所有的浏览器都可以响应，你可以尝试一下~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A4%A7%E9%83%A8%E5%88%86%E4%BA%BA%E9%83%BD%E4%BC%9A%E5%81%9A%E9%94%99%E7%9A%84%E7%BB%8F%E5%85%B8JS%E9%97%AD%E5%8C%85%E9%9D%A2%E8%AF%95%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A4%A7%E9%83%A8%E5%88%86%E4%BA%BA%E9%83%BD%E4%BC%9A%E5%81%9A%E9%94%99%E7%9A%84%E7%BB%8F%E5%85%B8JS%E9%97%AD%E5%8C%85%E9%9D%A2%E8%AF%95%E9%A2%98/" class="post-title-link" itemprop="url">大部分人都会做错的经典JS闭包面试题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A4%A7%E9%83%A8%E5%88%86%E4%BA%BA%E9%83%BD%E4%BC%9A%E5%81%9A%E9%94%99%E7%9A%84%E7%BB%8F%E5%85%B8JS%E9%97%AD%E5%8C%85%E9%9D%A2%E8%AF%95%E9%A2%98/" class="post-meta-item leancloud_visitors" data-flag-title="大部分人都会做错的经典JS闭包面试题" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>由工作中演变而来的面试题</strong></p>
<p>这是一个我工作当中的遇到的一个问题，似乎很有趣，就当做了一道题去面试，发现几乎没人能全部答对并说出原因，遂拿出来聊一聊吧。</p>
<p>先看题目代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function fun(n,o) &#123;</span><br><span class="line">  console.log(o)</span><br><span class="line">  return &#123;</span><br><span class="line">    fun:function(m)&#123;</span><br><span class="line">      return fun(m,n);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">var a &#x3D; fun(0);  a.fun(1);  a.fun(2);  a.fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">var b &#x3D; fun(0).fun(1).fun(2).fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">var c &#x3D; fun(0).fun(1);  c.fun(2);  c.fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">&#x2F;&#x2F;问:三行a,b,c的输出分别是什么？</span><br></pre></td></tr></table></figure>

<p>这是一道非常典型的JS闭包问题。其中嵌套了三层fun函数，搞清楚每层fun的函数是那个fun函数尤为重要。</p>
<p>可以先在纸上或其他地方写下你认为的结果，然后展开看看正确答案是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;答案：</span><br><span class="line">&#x2F;&#x2F;a: undefined,0,0,0</span><br><span class="line">&#x2F;&#x2F;b: undefined,0,1,2</span><br><span class="line">&#x2F;&#x2F;c: undefined,0,1,1</span><br></pre></td></tr></table></figure>

<p>都答对了么？如果都答对了恭喜你在js闭包问题当中几乎没什么可以难住你了；如果没有答对，继续往下分析。</p>
<p><strong>JS中有几种函数</strong></p>
<p>首先，在此之前需要了解的是，在JS中函数可以分为两种，<strong>具名函数（命名函数）和匿名函数。</strong></p>
<p>区分这两种函数的方法非常简单，可以通过输出 <code>fn.name</code> 来判断，有name的就是具名函数，没有name的就是匿名函数</p>
<blockquote>
<p>注意：在低版本IE上无法获取具名函数的name，会返回undefined，建议在火狐或是谷歌浏览器上测试</p>
</blockquote>
<p>或是采用兼容IE的获取函数name方法来获取函数名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * 获取指定函数的函数名称（用于兼容IE）</span><br><span class="line">    * @param &#123;Function&#125; fun 任意函数</span><br><span class="line">    *&#x2F;</span><br><span class="line">function getFunctionName(fun) &#123;</span><br><span class="line">    if (fun.name !&#x3D;&#x3D; undefined)</span><br><span class="line">        return fun.name;</span><br><span class="line">    var ret &#x3D; fun.toString();</span><br><span class="line">    ret &#x3D; ret.substr(&#39;function &#39;.length);</span><br><span class="line">    ret &#x3D; ret.substr(0, ret.indexOf(&#39;(&#39;));</span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遂用上述函数测试是否为匿名函数：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-7cfa3bd5bd1ed4d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="大部分人都会做错的经典JS闭包面试题_"></p>
<p>可以得知变量fn1是具名函数，fn2是匿名函数</p>
<p><strong>创建函数的几种方式</strong></p>
<p>说完函数的类型，还需要了解JS中创建函数都有几种创建方法。</p>
<p><strong>1、声明函数</strong></p>
<p>最普通最标准的声明函数方法，包括函数名及函数体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function fn1()&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、创建匿名函数表达式</strong></p>
<p>创建一个变量，这个变量的内容为一个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var fn1&#x3D;function ()&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>注意采用这种方法创建的函数为<strong>匿名函数</strong>，即没有函数<code>name</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fn1&#x3D;function ()&#123;&#125;;</span><br><span class="line">getFunctionName(fn1).length;&#x2F;&#x2F;0</span><br></pre></td></tr></table></figure>

<p><strong>3、创建具名函数表达式</strong></p>
<p>创建一个变量，内容为一个带有名称的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var fn1&#x3D;function xxcanghai()&#123;&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>具名函数表达式的函数名只能在创建函数内部使用</p>
<p>即采用此种方法创建的函数在函数外层只能使用fn1不能使用xxcanghai的函数名。xxcanghai的命名只能在创建的函数内部使用</p>
<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var fn1&#x3D;function xxcanghai()&#123;</span><br><span class="line">    console.log(&quot;in:fn1&lt;&quot;,typeof fn1,&quot;&gt;xxcanghai:&lt;&quot;,typeof xxcanghai,&quot;&gt;&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">console.log(&quot;out:fn1&lt;&quot;,typeof fn1,&quot;&gt;xxcanghai:&lt;&quot;,typeof xxcanghai,&quot;&gt;&quot;);</span><br><span class="line">fn1();</span><br><span class="line">&#x2F;&#x2F;out:fn1&lt; function &gt;xxcanghai:&lt; undefined &gt;</span><br><span class="line">&#x2F;&#x2F;in:fn1&lt; function &gt;xxcanghai:&lt; function &gt;</span><br></pre></td></tr></table></figure>

<p>可以看到在函数外部（out）无法使用xxcanghai的函数名，为undefined。</p>
<blockquote>
<p>注意：在对象内定义函数如<code>var o=&#123; fn : function ()&#123;…&#125; &#125;</code>，也属于函数表达式</p>
</blockquote>
<p><strong>4、Function构造函数</strong></p>
<p>可以给 <code>Function</code> 构造函数传一个函数字符串，返回包含这个字符串命令的函数，此种方法创建的是匿名函数。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-9d9729d1b2516248.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="大部分人都会做错的经典JS闭包面试题_"></p>
<p><strong>5、自执行函数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;alert(1);&#125;)();</span><br><span class="line">(function fn1()&#123;alert(1);&#125;)();</span><br></pre></td></tr></table></figure>

<p>自执行函数属于上述的“函数表达式”，规则相同</p>
<p><strong>6、其他创建函数的方法</strong></p>
<p>当然还有其他创建函数或执行函数的方法，这里不再多说，比如采用 <code>eval</code> ， <code>setTimeout</code>， <code>setInterval</code> 等非常用方法，这里不做过多介绍，属于非标准方法，这里不做过多展开。</p>
<p><strong>三个fun函数的关系是什么？</strong></p>
<p>说完函数类型与创建函数的方法后，就可以回归主题，看这道面试题。</p>
<p>这段代码中出现了三个fun函数，所以第一步先搞清楚，这三个fun函数的关系，哪个函数与哪个函数是相同的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function fun(n,o) &#123;</span><br><span class="line">  console.log(o)</span><br><span class="line">  return &#123;</span><br><span class="line">    fun:function(m)&#123;</span><br><span class="line">      &#x2F;&#x2F;...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看第一个fun函数，属于标准具名函数声明，是<strong>新创建</strong>的函数，他的返回值是一个对象字面量表达式，属于一个新的object。</p>
<p>这个新的对象内部包含一个也叫fun的属性，通过上述介绍可得知，属于匿名函数表达式，即fun这个属性中存放的是一个新创建匿名函数表达式。</p>
<blockquote>
<p>注意：所有<strong>声明的匿名函数都是一个新函数。</strong></p>
</blockquote>
<p>所以第一个fun函数与第二个fun函数不相同，均为新创建的函数。</p>
<p><strong>函数作用域链的问题</strong></p>
<p>再说第三个fun函数之前需要先说下，在函数表达式内部能不能访问存放当前函数的变量。</p>
<p><strong>测试1，对象内部的函数表达式：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var o&#x3D;&#123;</span><br><span class="line">  fn:function ()&#123;</span><br><span class="line">    console.log(fn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">o.fn();&#x2F;&#x2F;ERROR报错</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/10024246-4cebded6d66af53a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="大部分人都会做错的经典JS闭包面试题_"></p>
<p><strong>测试2，非对象内部的函数表达式：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var fn&#x3D;function ()&#123;</span><br><span class="line">  console.log(fn);</span><br><span class="line">&#125;;</span><br><span class="line">fn();&#x2F;&#x2F;function ()&#123;console.log(fn);&#125;;正确</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/10024246-511856047d0d46e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="大部分人都会做错的经典JS闭包面试题_"></p>
<p>结论是：使用var或是非对象内部的函数表达式内，可以访问到存放当前函数的变量；在对象内部的不能访问到。</p>
<p>原因也非常简单，因为<strong>函数作用域链</strong>的问题，采用var的是在外部创建了一个fn变量，函数内部当然可以在内部寻找不到fn后向上册作用域查找fn，而在创建对象内部时，因为没有在函数作用域内创建fn，所以无法访问。</p>
<p>所以综上所述，可以得知，<strong>最内层的return出去的fun函数不是第二层fun函数，是最外层的fun函数。</strong></p>
<p>所以，三个fun函数的关系也理清楚了，第一个等于第三个，他们都不等于第二个。</p>
<p><strong>到底在调用哪个函数？</strong></p>
<p>再看下原题，现在知道了程序中有两个fun函数(第一个和第三个相同)，遂接下来的问题是搞清楚，运行时他执行的是哪个fun函数？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function fun(n,o) &#123;</span><br><span class="line">  console.log(o)</span><br><span class="line">  return &#123;</span><br><span class="line">    fun:function(m)&#123;</span><br><span class="line">      return fun(m,n);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">var a &#x3D; fun(0);  a.fun(1);  a.fun(2);  a.fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">var b &#x3D; fun(0).fun(1).fun(2).fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">var c &#x3D; fun(0).fun(1);  c.fun(2);  c.fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br><span class="line">&#x2F;&#x2F;问:三行a,b,c的输出分别是什么？</span><br></pre></td></tr></table></figure>

<p><strong>1、第一行a</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var a &#x3D; fun(0);  a.fun(1);  a.fun(2);  a.fun(3);</span><br></pre></td></tr></table></figure>

<p>可以得知，第一个fun(0)是在调用第一层fun函数。第二个fun(1)是在调用前一个fun的返回值的fun函数，所以：</p>
<p>第后面几个fun(1),fun(2),fun(3),函数都是在调用第二层fun函数。</p>
<p>遂：</p>
<p>在第一次调用fun(0)时，o为undefined；</p>
<p>第二次调用fun(1)时m为1，此时fun闭包了外层函数的n，也就是第一次调用的n=0，即m=1，n=0，并在内部调用第一层fun函数fun(1,0);所以o为0；</p>
<p>第三次调用fun(2)时m为2，但依然是调用a.fun，所以还是闭包了第一次调用时的n，所以内部调用第一层的fun(2,0);所以o为0</p>
<p>第四次同理；</p>
<p><strong>即：最终答案为undefined,0,0,0</strong></p>
<p><strong>2、第二行b</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var b &#x3D; fun(0).fun(1).fun(2).fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br></pre></td></tr></table></figure>

<p>先从fun(0)开始看，肯定是调用的第一层fun函数；而他的返回值是一个对象，所以第二个fun(1)调用的是第二层fun函数，后面几个也是调用的第二层fun函数。</p>
<p>遂：</p>
<p>在第一次调用第一层fun(0)时，o为undefined；</p>
<p>第二次调用 .fun(1)时m为1，此时fun闭包了外层函数的n，也就是第一次调用的n=0，即m=1，n=0，并在内部调用第一层fun函数fun(1,0);所以o为0；</p>
<p>第三次调用 .fun(2)时m为2，此时当前的fun函数不是第一次执行的返回对象，而是第二次执行的返回对象。而在第二次执行第一层fun函数时时(1,0)所以n=1,o=0,返回时闭包了第二次的n，遂在第三次调用第三层fun函数时m=2,n=1，即调用第一层fun函数fun(2,1)，所以o为1；</p>
<p>第四次调用 .fun(3)时m为3，闭包了第三次调用的n，同理，最终调用第一层fun函数为fun(3,2)；所以o为2；</p>
<p><strong>即最终答案：undefined,0,1,2</strong></p>
<p><strong>3、第三行c</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var c &#x3D; fun(0).fun(1);  c.fun(2);  c.fun(3);&#x2F;&#x2F;undefined,?,?,?</span><br></pre></td></tr></table></figure>

<p>根据前面两个例子，可以得知：</p>
<p>fun(0)为执行第一层fun函数，.fun(1)执行的是fun(0)返回的第二层fun函数，这里语句结束，遂c存放的是fun(1)的返回值，而不是fun(0)的返回值，所以c中闭包的也是fun(1)第二次执行的n的值。c.fun(2)执行的是fun(1)返回的第二层fun函数，c.fun(3)执行的也是fun(1)返回的第二层fun函数。</p>
<p>遂：</p>
<p>在第一次调用第一层fun(0)时，o为undefined；</p>
<p>第二次调用 .fun(1)时m为1，此时fun闭包了外层函数的n，也就是第一次调用的n=0，即m=1，n=0，并在内部调用第一层fun函数fun(1,0);所以o为0；</p>
<p>第三次调用 .fun(2)时m为2，此时fun闭包的是第二次调用的n=1，即m=2，n=1，并在内部调用第一层fun函数fun(2,1);所以o为1；</p>
<p>第四次.fun(3)时同理，但依然是调用的第二次的返回值，遂最终调用第一层fun函数fun(3,1)，所以o还为1</p>
<p><strong>即最终答案：undefined,0,1,1</strong></p>
<p><strong>后话</strong></p>
<p>这段代码原本是在做一个将异步回调改写为同步调用的组件时的代码，发现了这个坑，对JS的闭包有了更深入的了解。</p>
<p>关于什么是闭包，网上的文章数不胜数，但理解什么是闭包还是要在代码中自己去发现与领悟。</p>
<p>如果要我说什么是闭包，我认为，广义上的闭包就是指一个变量在他自身作用域外被使用了，就叫发生了闭包。</p>
<p>希望读者能通过本文对闭包现象有进一步的了解，如有其它见解或看法，欢迎指正或留言讨论。</p>
<blockquote>
<p>作者：小小沧海<br>出处：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/xxcanghai/">http://www.cnblogs.com/xxcanghai/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%9C%A8%E7%BA%AF-JavaScript-%E4%B8%AD%E4%BD%BF%E7%94%A8-GraphQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%9C%A8%E7%BA%AF-JavaScript-%E4%B8%AD%E4%BD%BF%E7%94%A8-GraphQL/" class="post-title-link" itemprop="url">如何在纯 JavaScript 中使用GraphQL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 22:06:18" itemprop="dateModified" datetime="2021-03-10T22:06:18+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%9C%A8%E7%BA%AF-JavaScript-%E4%B8%AD%E4%BD%BF%E7%94%A8-GraphQL/" class="post-meta-item leancloud_visitors" data-flag-title="如何在纯 JavaScript 中使用GraphQL" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>作者 | Brian Rinaldi译者 | 王强策划 | 李俊辰</p>
<p>除了 REST 以外，很多 API 都开始支持 GraphQL，甚至完全支持它了。但是，如果你需要使用一个 GraphQL API，你很自然就会想到自己需要使用 React 和 / 或其他一些库才能让它跑起来。这是因为许多教程和示例代码似乎都基于这样一个假设，也就是说如果你在使用 GraphQL，就需要使用这些库。</p>
<p>但是，一个对 GraphQL API 的查询只不过是一个定制格式的 HTTP 请求而已。一个 GraphQL 响应也不过是 JSON 罢了。你不需要动用什么精美的库也可以处理它们。在这篇教程中，我想采用一种不一样的方法，并向你展示从 Node 和客户端 JavaScript（不带库）调用 GraphQL API 实际上有多么容易。</p>
<p>GraphQL 请求的基础知识</p>
<p>与 RESTful API 不同，GraphQL 具有单个端点。尽管 GraphQL 可以响应 GET 请求，但是一个典型的 GraphQL HTTP 请求是作为一个 POST 请求发送的。</p>
<p>你的 GraphQL 请求可以发送三段数据：query、operationName 和 variables。</p>
<p>query 是必需的，并且包含了（你猜对了）GraphQL 查询。由于 GraphQL 是通过单个端点运行的，因此端点响应的数据完全取决于你的查询。这个查询需要正确格式化 GraphQL。想知道如何构建查询吗？请查阅关于如何编写 GraphQL 查询的教程。</p>
<p><a target="_blank" rel="noopener" href="https://stepzen.com/blog/how-to-write-graphql-queries">https://stepzen.com/blog/how-to-write-graphql-queries</a></p>
<p>variables 是可选的，并且是一个 JSON 对象，其中包含要传递给查询的所有变量的值。例如，如果你的查询需要一个变量 id（将在查询中显示为 $id），则需要按以下方式发送变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>operationName 也是可选的。当查询包含多个命名操作的查询时，它用于指定要运行的操作。</p>
<p>如果你将一个 GraphQL 作为一个 GET 请求发送，则需要将以上内容作为查询参数传递。鉴于 GraphQL 查询可能会变得很长，这实际上不是最佳选择，因此我们还是考虑 POST 请求。在本教程中，我们将介绍我在 StepZen 上创建的一个简单的 Scooby DooAPI，它用来连接到一个 MySQL 数据源（StepZen 现在处于私有 alpha 状态，但是你可以在此处请求访问：</p>
<p><a target="_blank" rel="noopener" href="https://stepzen.com/request-invite">https://stepzen.com/request-invite</a></p>
<p>在 Node.js 中发送查询我们可以通过不带任何特殊库的 Node.js 发送查询，利用标准的 Node https 库格式化一个 POST 请求。我们来看一个不使用特殊库的简单示例（请注意，我确实使用了 dotenv 来获取用于访问我 StepZen 后端的 API 密钥）。在这个示例中，我仅传递了一个 query，该查询在发送前需要字符串化。除此之外，这是一个相当标准的 HTTPPOST。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">const https &#x3D; require(&#39;https&#39;);</span><br><span class="line">require(&#39;dotenv&#39;).config();</span><br><span class="line">const data &#x3D; JSON.stringify(&#123;</span><br><span class="line">  query: &#96;&#123;</span><br><span class="line">    characters(isMonster:true) &#123;</span><br><span class="line">      name</span><br><span class="line">      episode &#123;</span><br><span class="line">        name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#96;,</span><br><span class="line">&#125;);</span><br><span class="line">const options &#x3D; &#123;</span><br><span class="line">  hostname: &#39;biggs.stepzen.net&#39;,</span><br><span class="line">  path: &#39;&#x2F;scoobydoo&#x2F;scoobydoo&#x2F;__graphql&#39;,</span><br><span class="line">  port: 443,</span><br><span class="line">  method: &#39;POST&#39;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">    &#39;Content-Length&#39;: data.length,</span><br><span class="line">    Authorization: &#39;Apikey &#39; + process.env.STEPZEN_API_KEY,</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Node&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">const req &#x3D; https.request(options, (res) &#x3D;&gt; &#123;</span><br><span class="line">  let data &#x3D; &#39;&#39;;</span><br><span class="line">  console.log(&#96;statusCode: $&#123;res.statusCode&#125;&#96;);</span><br><span class="line">  res.on(&#39;data&#39;, (d) &#x3D;&gt; &#123;</span><br><span class="line">    data +&#x3D; d;</span><br><span class="line">  &#125;);</span><br><span class="line">  res.on(&#39;end&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    console.log(JSON.parse(data).data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">req.on(&#39;error&#39;, (error) &#x3D;&gt; &#123;</span><br><span class="line">  console.error(error);</span><br><span class="line">&#125;);</span><br><span class="line">req.write(data);</span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure>

<p>同样，返回的数据只是 JSON 而已，因此如果我们要运行它，则控制台中的输出将是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  characters: [</span><br><span class="line">    &#123; episode: [Object], name: &#39;Black Knight&#39; &#125;,</span><br><span class="line">    &#123; episode: [Object], name: &#39;Ghost of Captain Cutler&#39; &#125;,</span><br><span class="line">    &#123; episode: [Object], name: &#39;Phantom&#39; &#125;,</span><br><span class="line">    &#123; episode: [Object], name: &#39;Miner Forty-Niner&#39; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简化请求<br>我们来使用 node-fetch 之类的东西来简化这一过程，以减少发出 HTTP 请求所需的样板代码量。node-fetch 库从 Node 中的浏览器实现 JavaScript fetch API。这样我们就可以丢弃大约 11 行代码（减少了 25％），同时还让代码更容易阅读了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const fetch &#x3D; require(&#39;node-fetch&#39;);</span><br><span class="line">require(&#39;dotenv&#39;).config();</span><br><span class="line">async function getData() &#123;</span><br><span class="line">  const data &#x3D; JSON.stringify(&#123;</span><br><span class="line">    query: &#96;&#123;</span><br><span class="line">        characters(isMonster:true) &#123;</span><br><span class="line">          name</span><br><span class="line">          episode &#123;</span><br><span class="line">            name</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&#96;,</span><br><span class="line">  &#125;);</span><br><span class="line">  const response &#x3D; await fetch(</span><br><span class="line">    &#39;https:&#x2F;&#x2F;biggs.stepzen.net&#x2F;scoobydoo&#x2F;scoobydoo&#x2F;__graphql&#39;,</span><br><span class="line">    &#123;</span><br><span class="line">      method: &#39;post&#39;,</span><br><span class="line">      body: data,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">        &#39;Content-Length&#39;: data.length,</span><br><span class="line">        Authorization: &#39;Apikey &#39; + process.env.STEPZEN_API_KEY,</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Node&#39;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  const json &#x3D; await response.json();</span><br><span class="line">  console.log(json.data);</span><br><span class="line">&#125;</span><br><span class="line">getData();</span><br></pre></td></tr></table></figure>

<p>运行上面代码的结果与我们之前的示例相同。</p>
<p>传递变量在此示例中，我们的查询具有一个需要传递的变量（$id）。为了传递这个变量，我们需要将变量值添加到请求正文中包含的数据里。这应该是一个 JSON 格式的列表，其中查询所需的每个变量在 JSON 中都有一个对应的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const fetch &#x3D; require(&#39;node-fetch&#39;);</span><br><span class="line">require(&#39;dotenv&#39;).config();</span><br><span class="line">async function getData(id) &#123;</span><br><span class="line">  const data &#x3D; JSON.stringify(&#123;</span><br><span class="line">    query: &#96;query ScoobyDooWhereAreYou($id: ID!) &#123;</span><br><span class="line">        character(id:$id) &#123;</span><br><span class="line">          name</span><br><span class="line">          isMonster</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&#96;,</span><br><span class="line">    variables: &#96;&#123;</span><br><span class="line">        &quot;id&quot;: &quot;$&#123;id&#125;&quot;</span><br><span class="line">      &#125;&#96;,</span><br><span class="line">  &#125;);</span><br><span class="line">  const response &#x3D; await fetch(</span><br><span class="line">    &#39;https:&#x2F;&#x2F;biggs.stepzen.net&#x2F;scoobydoo&#x2F;scoobydoo&#x2F;__graphql&#39;,</span><br><span class="line">    &#123;</span><br><span class="line">      method: &#39;post&#39;,</span><br><span class="line">      body: data,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">        &#39;Content-Length&#39;: data.length,</span><br><span class="line">        Authorization: &#39;Apikey &#39; + process.env.STEPZEN_API_KEY,</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Node&#39;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  const json &#x3D; await response.json();</span><br><span class="line">  console.log(json.data);</span><br><span class="line">&#125;</span><br><span class="line">getData(1);</span><br></pre></td></tr></table></figure>

<p>在本例中，我传递的 ID 值为 1，它返回的是 Scooby Doo，这不是什么巧合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; character: &#123; isMonster: false, name: &#39;Scooby Doo&#39; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>现在我们知道 Scooby Doo 在哪里了。</p>
<p>使用客户端 JavaScript 发送查询</p>
<p>通过客户端 JavaScript 调用 GraphQL 查询的操作与上面的 fetch 示例几乎是一样的，只有一些很小的区别。首先，我显然不需要导入一个库来支持 fetch。其次，更重要的是我无法访问环境变量。需要强调的是，如果你的 API 需要传递某种 API 密钥或凭据，那么你不会希望在客户端执行这一操作，因为你的凭据将被公开。更好的解决方案是调用一个可访问这些凭据的无服务器函数，然后为你调用 API 并返回结果。如果你的无服务器函数是用 JavaScript 编写的，则前面示例中的 Node 代码就会起作用。不过在 API 完全开放的情况下，我们先来看一下它是如何完成的（请注意，我的示例确实有一个 API 密钥，但请按照我说的那样做，不要像在演示中那样对付一下……）。</p>
<p>以下示例调用了我的 Scooby API 来获取一个 monster 列表和它们所出现的剧集列表（抱歉，Scooby 粉丝们，我现在只统计了第 1 季中的少数 monster）。然后它会获取结果并将其显示在浏览器中。尽管这对 GraphQL 调用来说并不重要，但我使用 js-beautify 正确格式化了要显示的 JSON 结果，然后使用 Prism 给它上了色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;GraphQL Query Example&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link href&#x3D;&quot;css&#x2F;prism.css&quot; rel&#x3D;&quot;stylesheet&quot; &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;pre&gt;&lt;code class&#x3D;&quot;language-json&quot; id&#x3D;&quot;code&quot;&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;prism.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;js-beautify&#x2F;1.13.0&#x2F;beautify.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      (async function () &#123;</span><br><span class="line">        const data &#x3D; JSON.stringify(&#123;</span><br><span class="line">          query: &#96;&#123;</span><br><span class="line">    characters(isMonster:true) &#123;</span><br><span class="line">      name</span><br><span class="line">      episode &#123;</span><br><span class="line">        name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#96;,</span><br><span class="line">        &#125;);</span><br><span class="line">        const response &#x3D; await fetch(</span><br><span class="line">          &#39;https:&#x2F;&#x2F;biggs.stepzen.net&#x2F;scoobydoo&#x2F;scoobydoo&#x2F;__graphql&#39;,</span><br><span class="line">          &#123;</span><br><span class="line">            method: &#39;post&#39;,</span><br><span class="line">            body: data,</span><br><span class="line">            headers: &#123;</span><br><span class="line">              &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">              &#39;Content-Length&#39;: data.length,</span><br><span class="line">              Authorization:</span><br><span class="line">                &#39;Apikey DONOTSENDAPIKEYS&#39;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">        const json &#x3D; await response.json();</span><br><span class="line">        document.getElementById(&#39;code&#39;).innerHTML &#x3D; js_beautify(</span><br><span class="line">          JSON.stringify(json.data)</span><br><span class="line">        );</span><br><span class="line">        Prism.highlightAll();</span><br><span class="line">      &#125;)();</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>运行以上代码的结果是 JSON 响应，其中包含浏览器中显示的角色和剧集数据。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-df2d216399539c3c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片"></p>
<p>显然，一般来说你不会想要简单地向用户显示查询结果，因此让我们看一下如何使用返回的数据。</p>
<p>使用 GraphQL 查询响应</p>
<p>GraphQL 的一大优点是，它的响应只是纯 JSON，因此数据使用起来很容易。这里更好的是响应对应了查询，这意味着你无需花费大量时间来分析关于响应的文档。因此我们可以快速采用上面的示例并利用返回的数据，而不是简单地把它摆出来。</p>
<p>下面的代码会获取 JSON 响应，然后将其转换为 HTML（使用模板字面量），以将各项附加到一个 HTML 列表上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id&#x3D;&quot;monsterList&quot;&gt;&lt;&#x2F;ul&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  (async function () &#123;</span><br><span class="line">    const data &#x3D; JSON.stringify(&#123;</span><br><span class="line">      query: &#96;&#123;</span><br><span class="line">    characters(isMonster:true) &#123;</span><br><span class="line">      name</span><br><span class="line">      episode &#123;</span><br><span class="line">        name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#96;,</span><br><span class="line">    &#125;);</span><br><span class="line">    const response &#x3D; await fetch(</span><br><span class="line">      &#39;https:&#x2F;&#x2F;biggs.stepzen.net&#x2F;scoobydoo&#x2F;scoobydoo&#x2F;__graphql&#39;,</span><br><span class="line">      &#123;</span><br><span class="line">        method: &#39;post&#39;,</span><br><span class="line">        body: data,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,</span><br><span class="line">          &#39;Content-Length&#39;: data.length,</span><br><span class="line">          Authorization:</span><br><span class="line">            &#39;Apikey DONOTSENDAPIKEYS&#39;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    const characterData &#x3D; await response.json();</span><br><span class="line">    const templateFn &#x3D; (name, episode) &#x3D;&gt; &#96;&lt;li&gt;$&#123;name&#125; ($&#123;episode&#125;)&lt;&#x2F;li&gt;&#96;;</span><br><span class="line">    const monsterList &#x3D; document.getElementById(&#39;monsterList&#39;);</span><br><span class="line">    characterData.data.characters.map((character) &#x3D;&gt; &#123;</span><br><span class="line">      monsterList.insertAdjacentHTML(</span><br><span class="line">        &#39;beforeend&#39;,</span><br><span class="line">        templateFn(character.name, character.episode.name)</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)();</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>运行这个简单示例的输出是一个角色及其出现剧集的无序列表。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-79bde22afcf3e136?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片"></p>
<p>接下来可以做什么</p>
<p>这里的目标不是让大家不要使用 GraphQL 客户端库来执行 GraphQL 查询。那些库提供的能力远远超过了我在这里讨论的简单功能。此外，许多工具具备很容易和前端框架（例如 React、Vue、Angular）集成的能力。但是，对于研究 GraphQL 的人们来说（尤其是将其与 REST 对比时），很重要的一点是使用 GraphQL 显然不需要任何外部依赖项。如果你有兴趣探索一些 JavaScript 库，请参考下面的这些流行选项：</p>
<ul>
<li><p>  Apollo Client</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://github.com/apollographql/apollo-client">https://github.com/apollographql/apollo-client</a></p>
</li>
<li><p>  urql</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://formidable.com/open-source/urql/">https://formidable.com/open-source/urql/</a></p>
</li>
<li><p>  Relay</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://relay.dev/">https://relay.dev/</a></p>
</li>
<li><p>  GraphQL Request</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://github.com/prisma-labs/graphql-request">https://github.com/prisma-labs/graphql-request</a></p>
</li>
</ul>
<p> 作者介绍</p>
<p>Brian Rinaldi 是 StepZen 的一位开发倡导者。Brian 在 Progress Software 和 Adobe 等公司已有 10 多年的经验，一直致力于开发者社区和开发者关系工作。Brian 加入软件开发行业已超过 20 年，主要研究 Web 前端和后端技术。</p>
<p> 延伸阅读</p>
<p><a target="_blank" rel="noopener" href="https://stepzen.com/blog/consume-graphql-in-javascript">https://stepzen.com/blog/consume-graphql-in-javascript</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%B1%85%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%88%E7%BB%88%E7%BB%93%E7%89%88%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%B1%85%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%88%E7%BB%88%E7%BB%93%E7%89%88%EF%BC%89/" class="post-title-link" itemprop="url">如何居中一个元素（终结版）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%B1%85%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%88%E7%BB%88%E7%BB%93%E7%89%88%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="如何居中一个元素（终结版）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>转载，<a target="_blank" rel="noopener" href="https://github.com/ljianshu/Blog/issues/29">原文链接</a><br>本文主要介绍水平居中，垂直居中，还有水平垂直居中各种办法，思维导图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-c7c36e3854116049?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="image"></p>
<h2 id="一、水平居中"><a href="#一、水平居中" class="headerlink" title="一、水平居中"></a>一、水平居中</h2><h3 id="1-行内元素水平居中"><a href="#1-行内元素水平居中" class="headerlink" title="1.行内元素水平居中"></a>1.行内元素水平居中</h3><p><strong>利用 text-align: center 可以实现在块级元素内部的行内元素水平居中</strong>。此方法对inline、inline-block、inline-table和inline-flex元素水平居中都有效。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   .parent&#123;&#x2F;&#x2F;在父容器设置</span><br><span class="line">        text-align:center;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此外，如果块级元素内部包着也是一个块级元素，<strong>我们可以先将其由块级元素改变为行内块元素，再通过设置行内块元素居中以达到水平居中</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line">  .parent&#123; </span><br><span class="line">    text-align:center;   </span><br><span class="line">  &#125; </span><br><span class="line">  .child &#123; </span><br><span class="line">    display: inline-block;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-块级元素的水平居中"><a href="#2-块级元素的水平居中" class="headerlink" title="2.块级元素的水平居中"></a>2.块级元素的水平居中</h3><p>这种情形可以有多种实现方式，下面我们详细介绍:</p>
<h4 id="①margin-0-auto"><a href="#①margin-0-auto" class="headerlink" title="①margin:0 auto"></a>①margin:0 auto</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.child&#123;</span><br><span class="line">    width: 100px;&#x2F;&#x2F;确保该块级元素定宽</span><br><span class="line">    margin:0 auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="②使用table-margin"><a href="#②使用table-margin" class="headerlink" title="②使用table+margin"></a>②使用table+margin</h4><p><strong>先将子元素设置为块级表格来显示（类似），再将其设置水平居中</strong></p>
<p><strong>display:table在表现上类似block元素，但是宽度为内容宽。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .child &#123;</span><br><span class="line">   display: table;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="③使用absolute-transform"><a href="#③使用absolute-transform" class="headerlink" title="③使用absolute+transform"></a>③使用absolute+transform</h4><p><strong>先将父元素设置为相对定位，再将子元素设置为绝对定位，向右移动子元素，移动距离为父容器的一半，最后通过向左移动子元素的一半宽度以达到水平居中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line">  .child &#123; </span><br><span class="line">    position:absolute; </span><br><span class="line">    left:50%; </span><br><span class="line">    transform:translateX(-50%); </span><br><span class="line">  &#125;</span><br><span class="line">  .parent &#123;</span><br><span class="line">    position:relative;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<p><strong>不过transform属于css3内容，兼容性存在一定问题，高版本浏览器需要添加一些前缀</strong>。</p>
<h4 id="④使用flex-justify-content"><a href="#④使用flex-justify-content" class="headerlink" title="④使用flex+justify-content"></a>④使用flex+justify-content</h4><p><strong>通过CSS3中的布局利器flex中的justify-content属性来达到水平居中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .parent &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content:center;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="⑤使用flex-margin"><a href="#⑤使用flex-margin" class="headerlink" title="⑤使用flex+margin"></a>⑤使用flex+margin</h4><p><strong>通过flex将父容器设置为为Flex布局，再设置子元素居中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line">  .parent &#123; </span><br><span class="line">    display: flex; </span><br><span class="line">  &#125; </span><br><span class="line">  .child &#123; </span><br><span class="line">    margin:0 auto;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-多块级元素水平居中"><a href="#3-多块级元素水平居中" class="headerlink" title="3.多块级元素水平居中"></a>3.多块级元素水平居中</h3><p><img src="https://upload-images.jianshu.io/upload_images/10024246-7eef3b139cb04b0b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h4 id="①利用flex布局"><a href="#①利用flex布局" class="headerlink" title="①利用flex布局"></a>①利用flex布局</h4><p><strong>利用弹性布局(flex)，实现水平居中，其中justify-content 用于设置弹性盒子元素在主轴（默认横轴）方向上的对齐方式</strong>，本例中设置子元素水平居中显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> #container &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>源代码演示</strong></p>
<h4 id="②利用inline-block"><a href="#②利用inline-block" class="headerlink" title="②利用inline-block"></a>②利用inline-block</h4><p><strong>将要水平排列的块状元素设为display:inline-block，然后在父级元素上设置text-align:center，达到与上面的行内元素的水平居中一样的效果</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.container &#123;2text-align: center;3&#125;4.inline-block &#123;5display: inline-block;6&#125;</span><br></pre></td></tr></table></figure>

<p><strong>源代码演示</strong></p>
<h3 id="4-浮动元素水平居中"><a href="#4-浮动元素水平居中" class="headerlink" title="4.浮动元素水平居中"></a>4.浮动元素水平居中</h3><ul>
<li><p>  对于定宽的浮动元素，通过子元素设置relative + 负margin</p>
</li>
<li><p>  对于不定宽的浮动元素，父子容器都用相对定位</p>
</li>
<li><p>  通用方法(不管是定宽还是不定宽)：flex布局</p>
</li>
</ul>
<h4 id="①定宽的非浮动元素"><a href="#①定宽的非浮动元素" class="headerlink" title="①定宽的非浮动元素"></a>①定宽的非浮动元素</h4><p><strong>通过子元素设置relative + 负margin,原理见下图：</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-54c64bc2001f49e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><strong>注意：样式设置在浮动元素本身</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.child &#123;</span><br><span class="line">   position:relative;</span><br><span class="line">   left:50%;</span><br><span class="line">   margin-left:-250px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;span class&#x3D;&quot;child&quot; style&#x3D;&quot;float: left;width: 500px;&quot;&gt;我是要居中的浮动元素&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="②不定宽的浮动元素"><a href="#②不定宽的浮动元素" class="headerlink" title="②不定宽的浮动元素"></a>②不定宽的浮动元素</h4><p>通过父子容器都相对定位，偏移位移见下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-9797f21bfeb68368?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片"></p>
<p><strong>注意：要清除浮动，给外部元素加上float。这里的父元素就是外部元素</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;box&quot;&gt; </span><br><span class="line">    &lt;p&gt;我是浮动的&lt;&#x2F;p&gt; </span><br><span class="line">    &lt;p&gt;我也是居中的&lt;&#x2F;p&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">.box&#123; </span><br><span class="line">    float:left; </span><br><span class="line">    position:relative; </span><br><span class="line">    left:50%; </span><br><span class="line">&#125;</span><br><span class="line">p&#123;</span><br><span class="line">    float:left;</span><br><span class="line">    position:relative;</span><br><span class="line">    right:50%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="③通用办法flex布局-不管是定宽还是不定宽"><a href="#③通用办法flex布局-不管是定宽还是不定宽" class="headerlink" title="③通用办法flex布局(不管是定宽还是不定宽)"></a>③通用办法flex布局(不管是定宽还是不定宽)</h4><p><strong>利用弹性布局(flex)的<code>justify-content</code>属性，实现水平居中</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> .parent &#123; </span><br><span class="line">    display:flex; </span><br><span class="line">    justify-content:center; </span><br><span class="line">&#125; </span><br><span class="line">.chlid&#123; </span><br><span class="line">    float: left; </span><br><span class="line">    width: 200px;&#x2F;&#x2F;有无宽度不影响居中 </span><br><span class="line">&#125; </span><br><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;span class&#x3D;&quot;chlid&quot;&gt;我是要居中的浮动元素&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-绝对定位元素水平居中"><a href="#5-绝对定位元素水平居中" class="headerlink" title="5.绝对定位元素水平居中"></a>5.绝对定位元素水平居中</h3><p>这种方式非常独特，<strong>通过子元素绝对定位，外加<code>margin: 0 auto</code>来实现</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&lt;div class&#x3D;&quot;parent&quot;&gt; 2    &lt;div class&#x3D;&quot;child&quot;&gt;让绝对定位的元素水平居中对齐。&lt;&#x2F;div&gt; 3&lt;&#x2F;div&gt; 4  .parent&#123; 5        position:relative; 6    &#125; 7   .child&#123; 8         position: absolute; &#x2F;*绝对定位*&#x2F; 9         width: 200px;10         height:100px;11         background: yellow;12         margin: 0 auto; &#x2F;*水平居中*&#x2F;13         left: 0; &#x2F;*此处不能省略，且为0*&#x2F;14         right: 0;&#x2F;*此处不能省略，且为0*&#x2F;15    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、垂直居中"><a href="#二、垂直居中" class="headerlink" title="二、垂直居中"></a>二、垂直居中</h2><h3 id="1-单行内联元素垂直居中"><a href="#1-单行内联元素垂直居中" class="headerlink" title="1.单行内联元素垂直居中"></a>1.单行内联元素垂直居中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div id&#x3D;&quot;box&quot;&gt; </span><br><span class="line">     &lt;span&gt;单行内联元素垂直居中。&lt;&#x2F;span&gt;。 </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line"> #box &#123; </span><br><span class="line">    height: 120px; </span><br><span class="line">    line-height: 120px; </span><br><span class="line">    border: 2px dashed #f69c55; </span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-多行内联元素垂直居中"><a href="#2-多行内联元素垂直居中" class="headerlink" title="2.多行内联元素垂直居中"></a>2.多行内联元素垂直居中</h3><h4 id="①利用flex布局（flex）"><a href="#①利用flex布局（flex）" class="headerlink" title="①利用flex布局（flex）"></a>①利用flex布局（flex）</h4><p><strong>利用flex布局实现垂直居中，其中flex-direction: column定义主轴方向为纵向</strong>。这种方式在较老的浏览器存在兼容性问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">   &lt;p&gt;Dance like nobody is watching, code like everybody is.   </span><br><span class="line">     Dance like nobody is watching, code like everybody is.         </span><br><span class="line">     Dance like nobody is watching, code like everybody is.&lt;&#x2F;p&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line">    .parent &#123;  </span><br><span class="line">        height: 140px; </span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        border: 2px dashed #f69c55;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-38b6311e54762151.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="afve5-tqaog.jpg"></p>
<h4 id="②利用表布局（table）"><a href="#②利用表布局（table）" class="headerlink" title="②利用表布局（table）"></a>②利用表布局（table）</h4><p><strong>利用表布局的vertical-align: middle可以实现子元素的垂直居中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt;     &lt;p class&#x3D;&quot;child&quot;&gt;The more technology you learn, the more you realize how little you know.     The more technology you learn, the more you realize how little you know.     The more technology you learn, the more you realize how little you know.&lt;&#x2F;p&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line"> &lt;style&gt; </span><br><span class="line">    .parent &#123; </span><br><span class="line">        display: table;         </span><br><span class="line">        height: 140px;</span><br><span class="line">        border: 2px dashed #f69c55;</span><br><span class="line">    &#125;</span><br><span class="line">    .child &#123;</span><br><span class="line">        display: table-cell;</span><br><span class="line">        vertical-align: middle;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-块级元素垂直居中"><a href="#3-块级元素垂直居中" class="headerlink" title="3 块级元素垂直居中"></a>3 块级元素垂直居中</h3><h4 id="①使用absolute-负margin-已知高度宽度"><a href="#①使用absolute-负margin-已知高度宽度" class="headerlink" title="①使用absolute+负margin(已知高度宽度)"></a>①使用absolute+负margin(已知高度宽度)</h4><p><strong>通过绝对定位元素距离顶部50%，并设置margin-top向上偏移元素高度的一半，就可以实现了</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">    &lt;div class&#x3D;&quot;child&quot;&gt;固定高度的块级元素垂直居中。&lt;&#x2F;div&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">.parent &#123; </span><br><span class="line">        position: relative; </span><br><span class="line">&#125; </span><br><span class="line">.child &#123; </span><br><span class="line">        position: absolute; </span><br><span class="line">        top: 50%;</span><br><span class="line">        height: 100px;</span><br><span class="line">        margin-top: -50px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="②使用absolute-transform"><a href="#②使用absolute-transform" class="headerlink" title="②使用absolute+transform"></a>②使用absolute+transform</h4><p><strong>当垂直居中的元素的高度和宽度未知时，可以借助CSS3中的transform属性向Y轴反向偏移50%的方法实现垂直居中</strong>。但是部分浏览器存在兼容性的问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div class&#x3D;&quot;parent&quot;&gt; </span><br><span class="line">    &lt;div class&#x3D;&quot;child&quot;&gt;未知高度的块级元素垂直居中。&lt;&#x2F;div&gt; </span><br><span class="line">&lt;&#x2F;div&gt; </span><br><span class="line">.parent &#123; </span><br><span class="line">        position: relative; </span><br><span class="line">&#125; </span><br><span class="line">.child &#123; </span><br><span class="line">        position: absolute; </span><br><span class="line">        top: 50%;</span><br><span class="line">        transform: translateY(-50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="③使用flex-align-items"><a href="#③使用flex-align-items" class="headerlink" title="③使用flex+align-items"></a>③使用flex+align-items</h4><p><strong>通过设置flex布局中的属性align-items，使子元素垂直居中</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;child&quot;&gt;未知高度的块级元素垂直居中。&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">.parent &#123;</span><br><span class="line">    display:flex;</span><br><span class="line">    align-items:center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="④使用table-cell-vertical-align"><a href="#④使用table-cell-vertical-align" class="headerlink" title="④使用table-cell+vertical-align"></a>④使用table-cell+vertical-align</h4><p><strong>通过将父元素转化为一个表格单元格显示（类似 <code>&lt;td&gt;</code> 和 <code>&lt;th&gt;</code>），再通过设置 <code>vertical-align</code>属性，使表格单元格内容垂直居中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;Demo&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .parent &#123;</span><br><span class="line">    display: table-cell;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="三、水平垂直居中"><a href="#三、水平垂直居中" class="headerlink" title="三、水平垂直居中"></a>三、水平垂直居中</h2><p>这种情形也是有多种实现方式，接下去我们娓娓道来：</p>
<h3 id="方法1：绝对定位与负边距实现（已知高宽）"><a href="#方法1：绝对定位与负边距实现（已知高宽）" class="headerlink" title="方法1：绝对定位与负边距实现（已知高宽）"></a>方法1：绝对定位与负边距实现（已知高宽）</h3><p><strong>这种方式需要知道被垂直居中元素的高和宽，才能计算出margin值，兼容所有浏览器</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; css部分 </span><br><span class="line"> #container &#123;</span><br><span class="line">      position: relative; </span><br><span class="line">    &#125; </span><br><span class="line"> #center &#123; </span><br><span class="line">      position: absolute; </span><br><span class="line">      top: 50%; </span><br><span class="line">      left: 50%; </span><br><span class="line">      margin: -50px 0 0 -50px;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; html部分(这部分不做变化,下面例子直接共用)</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id&#x3D;&#39;container&#39;&gt;</span><br><span class="line">    &lt;div id&#x3D;&#39;center&#39; style&#x3D;&quot;width: 100px;height: 100px;background-color: #666&quot;&gt;center&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure>

<h3 id="方法2：绝对定位-margin-auto（已知高宽）"><a href="#方法2：绝对定位-margin-auto（已知高宽）" class="headerlink" title="方法2：绝对定位+margin:auto（已知高宽）"></a>方法2：绝对定位+margin:auto（已知高宽）</h3><p><strong>这种方式无需知道被垂直居中元素的高和宽，但不能兼容低版本的IE浏览器。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> #container &#123; </span><br><span class="line">      position: relative; </span><br><span class="line">      height:100px;&#x2F;&#x2F;必须有个高度 </span><br><span class="line"> &#125; </span><br><span class="line">#center &#123; </span><br><span class="line">     position: absolute; </span><br><span class="line">      top: 0; </span><br><span class="line">     left: 0; </span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">      margin: auto;&#x2F;&#x2F;注意此处的写法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法3：绝对定位-CSS3-未知高宽"><a href="#方法3：绝对定位-CSS3-未知高宽" class="headerlink" title="方法3：绝对定位+CSS3(未知高宽)"></a>方法3：绝对定位+CSS3(未知高宽)</h3><p><strong>利用Css3的transform，可以轻松的在未知元素的高宽的情况下实现元素的垂直居中</strong>。<br>CSS3的transform固然好用，但在项目的实际运用中必须考虑兼容问题，大量的hack代码可能会导致得不偿失。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> #container &#123;</span><br><span class="line">      position: relative;</span><br><span class="line"> &#125;</span><br><span class="line"> #center &#123;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 50%;</span><br><span class="line">      left: 50%;</span><br><span class="line">      transform: translate(-50%, -50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="方法4：flex布局"><a href="#方法4：flex布局" class="headerlink" title="方法4：flex布局"></a>方法4：flex布局</h3><p><strong>利用flex布局，其中justify-content 用于设置或检索弹性盒子元素在主轴（横轴）方向上的对齐方式；而align-items属性定义flex子项在flex容器的当前行的侧轴（纵轴）方向上的对齐方式。不能兼容低版本的IE浏览器。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  #container &#123;&#x2F;&#x2F;直接在父容器设置即可</span><br><span class="line">     height: 100vh;&#x2F;&#x2F;必须有高度</span><br><span class="line">     display: flex;</span><br><span class="line">      justify-content: center;</span><br><span class="line">     align-items: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法5：flex-grid与margin-auto-最简单写法"><a href="#方法5：flex-grid与margin-auto-最简单写法" class="headerlink" title="方法5：flex/grid与margin:auto(最简单写法)"></a>方法5：flex/grid与margin:auto(最简单写法)</h3><p><strong>容器元素设为 flex 布局或是grid布局，子元素只要写 margin: auto 即可,不能兼容低版本的IE浏览器。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#container &#123;</span><br><span class="line">      height: 100vh;&#x2F;&#x2F;必须有高度      </span><br><span class="line">      display: grid;</span><br><span class="line"> &#125;</span><br><span class="line">#center &#123;</span><br><span class="line">      margin: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/10024246-619807040e29cf95?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>写博客是件挺费精力的事，特别是你有想写出一篇好博客的初衷,本文前后花了不止五六个小时，但我却常常乐此不疲！一方面是看了很多博客，自己不手动敲一遍整理一遍，就感觉没掌握一样;另一方面，分享学习心得是件很快乐的事，愿与诸君共同成长进步！如果觉得本文还不错，记得点赞关注喔！因为往往是普通人才最需要别人的鼓励和支持！</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><p>  【基础】这15种CSS居中的方式，你都用过哪几种？</p>
</li>
<li><p>  最全面的水平垂直居中方案与flexbox布局</p>
</li>
<li><p>  CSS3 Flexbox轻巧实现元素的水平居中和垂直居中</p>
</li>
<li><p>  如何居中一个元素（正常、绝对定位、浮动元素)</p>
</li>
<li><p>  <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=2651553836&idx=1&sn=1f9e378e61908fd8c6c0fd81810b77fd&chksm=802557edb752defba9f1c2e462f7f09be0d1abbcbbdeb90007b80a6c4a78c855abbb5f291e39&mpshare=1&scene=21&srcid=0320rhs9ftYpIVK7WHOW2BoV#wechat_redirect">CSS布局解决方案（终结版）</a></p>
</li>
<li><p>  水平居中、垂直居中、水平垂直居中、浮动居中、绝对定位居中…….帮你搞定</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/" class="post-title-link" itemprop="url">如何彻底避免正则表达式的灾难性回溯？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%A6%82%E4%BD%95%E5%BD%BB%E5%BA%95%E9%81%BF%E5%85%8D%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%81%BE%E9%9A%BE%E6%80%A7%E5%9B%9E%E6%BA%AF%EF%BC%9F/" class="post-meta-item leancloud_visitors" data-flag-title="如何彻底避免正则表达式的灾难性回溯？" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>正则表达式的灾难性回溯（Catastrophic Backtracking）是指，正则在匹配的时候回溯过多，造成 CPU 100%，正常服务被阻塞。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>这里有一篇<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/38229530">文章</a>详细的描述了一次正则回溯导致 CPU 100% 的发现和解决过程，原文比较长，我之前也在 OpenResty 的开发中遇到过两次类似的问题。</p>
<p>这里简单归纳下，你就可以不用花费时间去了解背景了：</p>
<ol>
<li> 大部分开发语言的正则引擎是用基于回溯的 NFA 来实现（而不是基于 Thompson’s NFA）；</li>
<li> 如果回溯次数过多，就会导致灾难性回溯，CPU 100%；</li>
<li> 需要用 gdb 分析 dump，或者 systemtap 分析线上环境来定位；</li>
<li> 这种问题很难在代码上线前发现，需要逐个 review 正则表达式；</li>
</ol>
<p>站在开发的角度，修复完有问题的正则表达式，就告一段落了。最多再加上一个保险机制，限制下回溯的次数，比如在 OpenResty 中这样设置：</p>
<p><code>lua_regex_match_limit 100000;</code></p>
<p>这样即使出现灾难性回溯，也会被限制住，不会跑满 CPU。</p>
<p>嗯，看上去已经很完美了吗？让我们来跳出开发的层面，用不同的维度来看待这个问题。</p>
<h2 id="攻击者"><a href="#攻击者" class="headerlink" title="攻击者"></a>攻击者</h2><p>只用一台机器，发送一个请求，就可以打跨对方的服务器，这简直就是黑客梦寐以求的核武器。与之相比，什么 DDoS 弱爆了，动静大还花钱多。</p>
<p>这种攻击也有自己的名字：**ReDoS (RegEx Denial of Service)**。</p>
<p>由于正则表达式应用非常广泛，几乎存在于后端服务的各个部分，所以只要找到其中一个漏洞，就有机可趁。</p>
<p>试想一个场景，黑客发现了 WAF 中存在 ReDoS 漏洞，发送一个请求打垮了 WAF；你无法在短时间内定位这个问题，<em>甚至意识不到这是一次攻击</em>；为了保证业务的正常，你选择重启或者暂时关闭 WAF；在 WAF 失效期间，黑客利用 SQL 注入，拖走了你的数据库。而你，可能还完全蒙在鼓里。</p>
<p><em>由于开源软件和云服务的广泛使用，只保证自己写的正则表达式没有漏洞，也是不够的</em>。这是另外一个话题了，我们这里先只讨论自己可控范围内的正则。</p>
<h2 id="如何发现这类正则表达式？"><a href="#如何发现这类正则表达式？" class="headerlink" title="如何发现这类正则表达式？"></a>如何发现这类正则表达式？</h2><p><strong>解决问题的第一步，就是发现问题，而且要尽量发现所有问题</strong>，也就是所谓安全的发现能力。</p>
<p>指望人工 code review 来发现有问题的正则，自然是靠不住的。大部分开发者是没有这方面安全意识的，就算有意去找，人也不可能从复杂的正则表达式中找到问题所在。</p>
<p>这正是自动化工具大显身手的时候。</p>
<p>我们有以下两种自动化的方法来解决：</p>
<ul>
<li>  静态检测</li>
</ul>
<p>这类工具可以扫描代码中正则表达式，根据一定的算法，从中找出有灾难性回溯的正则。</p>
<p>比如<em>RXXR2</em>（<a href="https://link.zhihu.com/?target=http://www.cs.bham.ac.uk/%257Ehxt/research/rxxr2/">http://www.cs.bham.ac.uk/%7Ehxt/research/rxxr2/</a>），它是基于一篇 paper 中的算法来实现，把正则转换为ε-NFA，然后再进行搜索，但并不支持正则表达式的扩展语法，所以会有漏报。</p>
<ul>
<li>  动态 fuzzing</li>
</ul>
<p>fuzz 测试是一种通用的软件测试方法，通过长时间输入大量随机的数据，来检测软件是否有崩溃、内存泄漏等问题。</p>
<p>同样的，在正则的测试中我们也可以用到这种方法。我们可以根据已有的正则表达式来生成测试数据，也可以完全随机生成。</p>
<p><em>SlowFuzz</em> 是其中一个开源的工具，也是基于一篇 paper 的算法实现，本文最后会列出 paper，它是一个通用的工具，并没有针对正则的结构做处理，所以会有漏报。</p>
<p><em>SDLFuzzer</em> 是几年前微软开发的一个专门的 ReDoS 检测工具，但已经不再维护了。</p>
<p>这方面的工具可选择的不多，而且关注度不高。不过让我兴奋的是，在搜索资料的过程中，发现了南京大学几位老师和博士关于 ReDoS 的一篇paper，并且和 paper 一起开源了 <strong>ReScue</strong>这个工具： <a href="https://link.zhihu.com/?target=https://2bdenny.github.io/ReScue/">https://2bdenny.github.io/ReScue/</a>。这个工具已经找出了几个开源项目中的 ReDoS 漏洞。</p>
<p>下面是 paper 中对比测试的结果：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-f0fcc9c46059705d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-32003a30f700d785.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h2 id="可否一劳永逸？"><a href="#可否一劳永逸？" class="headerlink" title="可否一劳永逸？"></a>可否一劳永逸？</h2><p>即使我们用了这类工具，有难免会有误报和漏报，那么有没有一劳永逸的方式来解决 ReDoS 呢？</p>
<p>那么我们就要回到<strong>问题产生的根源</strong>去寻找答案：<strong>正则引擎使用了回溯的方式来匹配。</strong></p>
<p>如果我们弃用这种方法，是不是就可以了呢？没错，已经有不少其他的正则引擎的实现，都可以一劳永逸的来解决。他们都<strong>放弃了回溯，用 NFA/DFA 自动机的方法来实现</strong>，优点是适合流式匹配，也更加安全，缺点不支持很多正则的扩展语法，比如 backreferences，好在这些一般也用不到。</p>
<ul>
<li>  Google RE2</li>
</ul>
<p>谷歌的 RE2 是其中完成度比较高开源项目。它支持 PCRE 的大部分语法，而且有 Go、Python、Perl、Node.js 等多种开发语言的库实现，上手和替换成本很低。</p>
<p>我们以 Perl 为例，看下 RE2 是否可以避免灾难性回溯问题。</p>
<p>我们先来看下这个结果对比图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-15ea93dc35cd94c5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>代码如下，感兴趣的可以自己试试看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time perl -e &#39;if (&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot; &#x3D;~ &#x2F;a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x2F;) &#123;print(&quot;hit&quot;);&#125;&#39;</span><br></pre></td></tr></table></figure>

<p><code>40.80s user 0.00s system 99% cpu 40.800 total</code></p>
<p>需要 40.8 秒才能跑完这个正则，期间 CPU 99%。</p>
<p>采用 RE2 之后，对比非常明显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time perl -e &#39;use re::engine::RE2; if (&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot; &#x3D;~ &#x2F;a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?a?aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x2F;) &#123;print(&quot; hit&quot;);&#125;&#39;</span><br></pre></td></tr></table></figure>

<p><code>perl -e 0.00s user 0.00s system 34% cpu 0.011 total</code></p>
<ul>
<li>  Intel Hyperscan</li>
</ul>
<p>Intel Hyperscan 也是类似 RE2 的正则引擎，也有Perl、Python 等语言的库，上手难度不大。</p>
<p>只不过按照 Intel 的惯例，多了平台的绑定，只能跑在 x86 中。</p>
<p>如果非要说有什么独特的好处，可能是能够和 Intel 的指令集还有硬件更好的配合，有性能的提升，比如结合下自家的 DPDK。</p>
<p>开源的网络入侵检测工具 Snort，也用 Hyperscan 替换了之前的正则引擎，熟悉 Snort 的同学可以试试看。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><blockquote>
<p>这里有几篇正则表达式方面的 paper，感兴趣的可以作为扩展阅读。</p>
<ol>
<li> SlowFuzz: Automated Domain-Independent Detection of Algorithmic Complexity Vulnerabilities： <a href="https://link.zhihu.com/?target=https://arxiv.org/pdf/1708.08437.pdf">https://arxiv.org/pdf/1708.08437.pdf</a></li>
<li> Static Analysis for Regular Expression Exponential Runtime via Substructural Logics：<a href="https://link.zhihu.com/?target=http://www.cs.bham.ac.uk/%257Ehxt/research/redos_full.pdf">http://www.cs.bham.ac.uk/%7Ehxt/research/redos_full.pdf</a></li>
<li> ReScue: Crafting Regular Expression DoS Attacks：<a href="https://link.zhihu.com/?target=https://cs.nju.edu.cn/changxu/1_publications/ASE18.pdf">https://cs.nju.edu.cn/changxu/1_publications/ASE18.pdf</a></li>
<li> Regular Expression Matching Can Be Simple And Fast： <a href="https://link.zhihu.com/?target=https://swtch.com/~rsc/regexp/regexp1.html">https://swtch.com/~rsc/regexp/regexp1.html</a></li>
</ol>
</blockquote>
<blockquote>
<p>转载 ：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44425997">https://zhuanlan.zhihu.com/p/44425997</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">开发人员在线速查手册</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%9C%A8%E7%BA%BF%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" class="post-meta-item leancloud_visitors" data-flag-title="开发人员在线速查手册" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>135</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>不管你是多么优秀的程序员，你都不可能记住一切。在你编写程序的过程中碰到问题需要查阅手册的时候，若有现成的在线手册可参考则可以为你节省很多时间。为了方便各位朋友，向大家推荐一个非常棒的在线手册索引网站——<a target="_blank" rel="noopener" href="http://overapi.com/">overapi.com</a>，这个网站收集了众多对开发人员非常有用的手册。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-bd3e11eb7a95a19d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/" class="post-title-link" itemprop="url">探索HTTP传输中gzip压缩</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%8E%A2%E7%B4%A2HTTP%E4%BC%A0%E8%BE%93%E4%B8%ADgzip%E5%8E%8B%E7%BC%A9/" class="post-meta-item leancloud_visitors" data-flag-title="探索HTTP传输中gzip压缩" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="为什么要开启gZip"><a href="#为什么要开启gZip" class="headerlink" title="为什么要开启gZip"></a>为什么要开启gZip</h3><p>我们给某人发送邮件时，我们在传输之前把自己的文件压缩一下，接收方收到文件后再去解压获取文件。这中操作对于我们来说都已经司空见惯。我们压缩文件的目的就是为了把传输文件的体积减小，加快传输速度。我们在 <code>http</code> 传输中开启 <code>gZip</code> 的目的也是如此，但是一般文章介绍 <code>gZip</code> 时候总是结合一些服务端配置(<code>nginx</code>)或者构建工具插件(<code>webpack</code>)来说，列出一大堆配置让人看的云里雾里，以至于到最后还没搞懂 <code>为什么用</code>，<code>怎么用</code> 这些问题。</p>
<h3 id="http-与-gZip"><a href="#http-与-gZip" class="headerlink" title="http 与 gZip"></a>http 与 gZip</h3><p>我们下面去探讨一下这些问题</p>
<h4 id="gZip-文件怎么通讯"><a href="#gZip-文件怎么通讯" class="headerlink" title="gZip 文件怎么通讯"></a><code>gZip</code> 文件怎么通讯</h4><p>我们传输压缩文件给别人时候一般都带着后缀名 <code>.rar</code>, <code>.zip</code>之类，对方在拿到文件后根据相应的后缀名选择不同的解压方式然后去解压文件。我们在 <code>http</code> 传输时候解压文件的这个角色的扮演者就是我们使用的浏览器，但是浏览器怎么分辨这个文件是什么格式，应该用什么格式去解压呢？</p>
<p>在 <code>http／1.0</code> 协议中关于服务端发送的数据可以配置一个 <code>Content-Encoding</code> 字段，这个字段用于说明数据的压缩方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Encoding: compress</span><br><span class="line">Content-Encoding: deflate</span><br></pre></td></tr></table></figure>

<p>客户端在接受到返回的数据后去检查对应字段的信息，然后根据对应的格式去做相应的解码。客户端在请求时，可以用 <code>Accept-Encoding</code> 字段说明自己接受哪些压缩方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>

<p>我们在浏览器的控制台中可以看到请求的相关信息</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-e5ec64cbfb3c270e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h5 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h5><p>提到浏览器作为一个前端就不由自主的会想一个问题，会不会有浏览器不支持呢。<code>HTTP/1.0</code> 是1996年5月发布的。好消息是基本不用考虑兼容性的问题，几乎所有浏览器都支持它。值得一提的是 <code>ie6</code>的早起版本中存在一个会破坏 <code>gZip</code>的错误，后面 <code>ie6</code>本身在 <code>WinXP SP2</code> 中修复了这个问题，而且用这个版本的用户数量也很少。</p>
<h4 id="谁去压缩文件"><a href="#谁去压缩文件" class="headerlink" title="谁去压缩文件"></a>谁去压缩文件</h4><p>这件事看起来貌似只能服务端来做，我们在网上看到最多的也是诸如 <code>nginx</code> 开启 <code>gZip</code> 配置之类的文章，但是现在前端流行 <code>spa</code> 应用, 用 <code>react</code>, <code>vue</code> 之类的框架时候总伴随这一套自己的脚手架,一般用 <code>webpack</code> 作为打包工具，其中可以配置插件 如<a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/compression-webpack-plugin">compression-webpack-plugin</a> 可以让我们把生成文件进行 <code>gZip</code> 等压缩并生成对应的压缩文件，而我们应用在构架时候有可能也会在服务区和前端文件中放置一层 <code>node</code> 应用来进行接口鉴权和文件转发。<code>nodejs</code>中我们熟悉的<code>express</code> 框架中也有一个<a target="_blank" rel="noopener" href="https://github.com/expressjs/compression">compression</a> 中间件，可以开启<code>gZip</code>,一时间看的人眼花缭乱，到底应该用谁怎么用呢？</p>
<h5 id="服务端响应请求时候压缩"><a href="#服务端响应请求时候压缩" class="headerlink" title="服务端响应请求时候压缩"></a>服务端响应请求时候压缩</h5><p>其实 <code>nginx</code> 压缩和 <code>node</code> 框架中用中间件去压缩都是一样的，当我们点击网页发送一个请求时候，我们的服务端会找到对应的文件，然后对文件进行压缩返回压缩后的内容【<em>当然可以利用缓存减少压缩次数</em>】，并配置好我们上面提到的 <code>Content-Encoding</code> 信息。对于一些应用在构架时候并没有上游代理层，比如服务端就一层 <code>node</code> 就可以直接用自己本身的压缩插件对文件进行压缩，如果上游配有有 <code>nginx</code> 转发处理层，最好交给 <code>nginx</code> 来处理这些，因为它们有专门为此构建的内容，可以更好的利用缓存并减小开销（很多使用c语言编写的）。</p>
<p>我们看一些 <code>nginx</code> 中开启 <code>gZip</code> 压缩的一部分配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启gzip</span><br><span class="line">gzip on;</span><br><span class="line"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span><br><span class="line">gzip_min_length 1k;</span><br><span class="line"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明</span><br><span class="line">gzip_comp_level 2;</span><br><span class="line"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span><br><span class="line">gzip_types text&#x2F;plain application&#x2F;javascript application&#x2F;x-javascript text&#x2F;css application&#x2F;xml text&#x2F;javascript;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="应用构建时候压缩"><a href="#应用构建时候压缩" class="headerlink" title="应用构建时候压缩"></a>应用构建时候压缩</h5><p>既然服务端都可以做了为什么 <code>webpack</code> 在打包前端应用时候还有这样一个压缩插件呢，我们可以在上面 <code>nginx</code> 配置中看到 <code>gzip_comp_level 2</code> 这个配置项，上面也有注释写道 <code>1-10</code> 数字越大压缩效果越好，但是会耗费更多的CPU和时间，我们压缩文件除了减少文件体积大小外，也是为了减少传输时间，如果我们把压缩等级配置的很高，每次请求服务端都要压缩很久才回返回信息回来，不仅服务器开销会增大很多，请求方也会等的不耐烦。但是现在的 <code>spa</code> 应用既然文件都是打包生成的，那如果我们在打包时候就直接生成高压缩等级的文件，作为静态资源放在服务器上，接收到请求后直接把压缩的文件内容返回回去会怎么样呢？</p>
<p><code>webpack</code> 的 <code>compression-webpack-plugin</code> 就是做这个事情的，配置起来也很简单只需要在装置中加入对应插件,简单配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const CompressionWebpackPlugin &#x3D; require(&#39;compression-webpack-plugin&#39;);</span><br><span class="line"></span><br><span class="line">webpackConfig.plugins.push(</span><br><span class="line">    new CompressionWebpackPlugin(&#123;</span><br><span class="line">      asset: &#39;[path].gz[query]&#39;,</span><br><span class="line">      algorithm: &#39;gzip&#39;,</span><br><span class="line">      test: new RegExp(&#39;\\.(js|css)&#x2F;article&gt;),</span><br><span class="line">      threshold: 10240,</span><br><span class="line">      minRatio: 0.8</span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>webpack</code> 打包完成后生成打包文件外还会额外生成 <code>.gz</code> 后缀的压缩文件</p>
<p>[图片上传失败…(image-b14f20-1614231793629)] </p>
<p>那么这个插件的压缩等级是多少呢，我们可以在<a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/compression-webpack-plugin/blob/master/src/index.js">源码</a>中看到默认的 <code>level</code> 是 <strong>9</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">const zlib &#x3D; require(&#39;zlib&#39;);</span><br><span class="line">this.options.algorithm &#x3D; zlib[this.options.algorithm];</span><br><span class="line">...</span><br><span class="line">this.options.compressionOptions &#x3D; &#123;</span><br><span class="line">    level: options.level || 9,</span><br><span class="line">    flush: options.flush</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到压缩使用的是 <code>zlib</code> 库，而 <code>zlib</code> 分级来说，默认是 6 ，最高的级别就是<code>9 Best compression (also zlib.Z_BEST_COMPRESSION)</code>,因为我们只有在上线项目时候才回去打包构建一次，所以我们在构建时候使用最高级的压缩方式压缩多耗费一些时间对我们来说根本没任何损耗，而我们在服务器上也不用再去压缩文件，只需要找到相应已经压缩过的文件直接返回就可以了。</p>
<h6 id="服务端怎么找到这些文件"><a href="#服务端怎么找到这些文件" class="headerlink" title="服务端怎么找到这些文件"></a>服务端怎么找到这些文件</h6><p>在应用层面解决这个问题还是比较简单的，比如上述压缩文件会产生<code>index.css</code>, <code>index.js</code>的压缩文件，在服务端简单处理可以判断这两个请求然后给予相对应的压缩文件。以 <code>node</code> 的 <code>express</code> 为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">app.get([&#39;&#x2F;index.js&#39;,&#39;&#x2F;index.css&#39;], function (req, res, next) &#123;</span><br><span class="line">  req.url &#x3D; req.url + &#39;.gz&#39;</span><br><span class="line">  res.set(&#39;Content-Encoding&#39;, &#39;gzip&#39;)</span><br><span class="line">  res.setHeader(&quot;Content-Type&quot;, generateType(req.path)) &#x2F;&#x2F; 这里要根据请求文件设置content-type</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面我们可以给请求返回 <code>gZip</code> 压缩后的数据了，当然上面的局限性太强也不可取，但是对于处理这个方面需求也已经有很多库存在,<code>express</code> 有 <a target="_blank" rel="noopener" href="https://github.com/tkoenig89/express-static-gzip">express-static-gzip</a> 插件 <code>koa</code> 的 <code>koa-static</code> 则默认自带对 <code>gZip</code> 文件的检测，基本原理就是对请求先检测 <code>.gz</code>后缀的文件是否存在，再去根据结果返回不同的内容。</p>
<h4 id="哪些文件可以被-gZip-压缩"><a href="#哪些文件可以被-gZip-压缩" class="headerlink" title="哪些文件可以被 gZip 压缩"></a>哪些文件可以被 gZip 压缩</h4><p><code>gZip</code> 可以压缩所有的文件，但是这不代表我们要对所有文件进行压缩，我们写的代码（<code>css,js</code>）之类的文件会有很好的压缩效果，但是图片之类文件则不会被 <code>gzip</code> 压缩太多，因为它们已经内置了一些压缩，一些文件（比如一些已经被压缩的像.zip文件那种）再去压缩可能会让生成的文件体积更大一些。当然已经很小的文件也没有去压缩的必要了。</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>能开启 <code>gZip</code> 肯定是要开启的，具体使用在请求时候实时压缩还是在构建时候去生成压缩文件，就要看自己具体业务情况。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/20762094/how-are-zlib-gzip-and-zip-related-what-do-they-have-in-common-and-how-are-they/20765054#20765054">How are zlib, gzip and zip related? What do they have in common and how are they different?</a></li>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/38587698/webpack-gzip-vs-express-gzip?s=1%7C140.9128">webpack gzip vs express gzip</a></li>
<li>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16691506/what-is-gzip-compression">What is gZip compression?</a></li>
<li>  <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/08/http.html">HTTP 协议</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">标准盒模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E6%A0%87%E5%87%86%E7%9B%92%E6%A8%A1%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="标准盒模型" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="1、一个盒子的构成："><a href="#1、一个盒子的构成：" class="headerlink" title="1、一个盒子的构成："></a>1、一个盒子的构成：</h5><ul>
<li><p>盒子中的内容：content 宽=width 高=height</p>
</li>
<li><p>盒子的边框：border</p>
</li>
<li><p>盒子边框与内容之间的距离：称为填充—padding 内边距（内补丁）</p>
</li>
<li><p>如果有多个盒子存在，盒子与盒子之间的距离：称为边界—margin，外边距（外补丁）</p>
</li>
<li><p>整个盒子模型在网页中所占的宽度：左边界+左边框+左填充+内容+右填充+右边框+右边<br>界<br><img src="https://upload-images.jianshu.io/upload_images/10024246-50fe38676d0998e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p>关于如何切图：</p>
<blockquote>
<p>PC：先看全图分块切，<br>移动端：看所有图片找出共同模块，分组切</p>
</blockquote>
</li>
<li><p>关于适配问题：<br><img src="https://upload-images.jianshu.io/upload_images/10024246-eded6984b876f273.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
</ul>
<h5 id="2、弹性布局"><a href="#2、弹性布局" class="headerlink" title="2、弹性布局"></a>2、弹性布局</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display: flex | inline-flex; (适用于父类容器元素上)</span><br></pre></td></tr></table></figure>
<p>定义一个 flex 容器，内联或者根据指定的值，来作用于下面的子类容器。</p>
<ul>
<li> box：将对象作为弹性伸缩盒显示。（伸缩盒最老版本）</li>
<li>  inline-box：将对象作为内联块级弹性伸缩盒显示。（伸缩盒最老版本）</li>
<li> flexbox：将对象作为弹性伸缩盒显示。（伸缩盒过渡版本）</li>
<li> inline-flexbox：将对象作为内联块级弹性伸缩盒显示。（伸缩盒过渡版本）</li>
<li> flex：将对象作为弹性伸缩盒显示。（伸缩盒最新版本）</li>
<li> inline-flex：将对象作为内联块级弹性伸缩盒显示。（伸缩盒最新版本）<h5 id="2-1-H5-用的老版本伸缩盒模型-display-box"><a href="#2-1-H5-用的老版本伸缩盒模型-display-box" class="headerlink" title="2.1 H5 用的老版本伸缩盒模型 display: box;"></a>2.1 H5 用的老版本伸缩盒模型 display: box;</h5>常用属性：</li>
<li> <strong>box-flex:子元素的之间的比例。</strong><br>可以定义把父元素分成几份，如一个父 div 的 width：400px；里面有三<br>个子 div，分别定义-webkit-box-flex：2; -webkit-box-flex：1; -webkitbox-flex：1;那么三个子<br>div 的宽度会自动充满整个父盒子，宽度分别是<br>400*(2/2+1+1)=200px; 400*(1/2+1+1)=100px; 400*(1/2+1+1)=100p<br>x;</li>
<li> <strong>box-orient: 用来确定子元素的方向，是横着排还是竖着走。</strong><br>可选的值有：<strong>horizontal、vertical、inline-axis、block-axis、inherit</strong><br>Horizontal 与 inline-axis 的表现是一致的，让子元素横排。<br>Vertical 与 block-axis 的表现是一致的，让子元素纵列。<br>l box-direction：是用来确定子元素的排列顺序。<br>可选的值有：<strong>normal、reverse、inherit</strong><br>Normal 是默认值，表示按照正常顺序排列，从上到下，从左到右。<br>Reverse 表示与正常顺序相反。</li>
<li> <strong>box-align：与 box-pack 都是决定盒子内部剩余空间怎么使用的，</strong><br>决定了父容器里子容器的垂直对齐方式。<br>可选的值有：<strong>start、end、center、baseline、stretch</strong><br>Start 表示居顶对齐。<br>End 表示居底对齐。<br>Center：表示居中对齐。<br>Baseline：表示与基线对齐。<br>Stretch 为默认值，表示拉伸，拉伸到与父容器等高。</li>
<li> <strong>box-pack：决定了父标签水平遗留空间的使用。即父容器里子容器</strong><br>的水平对齐方式。<br>可选的值有：start、end、center、justify<br>Start 为默认值，表示水平居左对齐。<br>End 表示水平居右对齐。<br>Center：表示水平居中对齐。<br>Justify 表示水平两端对齐。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-182dfad14cfa9932.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></li>
</ul>
<h5 id="2-2-新版本-display-flex"><a href="#2-2-新版本-display-flex" class="headerlink" title="2.2 新版本 display:flex;"></a>2.2 新版本 display:flex;</h5><p>常用属性：</p>
<ul>
<li><strong>flex-direction: row | column | row-reverse | column-reverse</strong><br>决定主轴的方向（即项目的排列方向）。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-bec5ad15cd8fdedb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></li>
</ul>
<p>flex-warp: nowrap | wrap | wrap-reverse;<br>定义是否要换行，如何换行。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-f05c3c69d62c43a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<ul>
<li><p><strong>justify-content:flex-start|flex-end|center|space-between|space-around</strong><br>定义项目在主轴上的对齐方式<br><img src="https://upload-images.jianshu.io/upload_images/10024246-c9b49800aa86f342.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p><strong>align-items: flex-start |flex-end |center |baseline |stretch;</strong><br>定义项目在交叉轴上如何对齐<br><img src="https://upload-images.jianshu.io/upload_images/10024246-0ecf0d58bb9d8ff1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
<li><p><strong>flex-flow: flex-direction flex-warp;</strong><br>以上属性均加在父盒子上生效。下边两个是加在子元素上生效的属性：</p>
</li>
<li><p> <strong>flex: 是 flex-grow，flex-shrink，flex-basis 三个属性的简写。</strong><br>默认值：0 1 auto；<br>设置或检索伸缩盒对象的子元素如何分配空间。后两个属性可省。<br>如果缩写 flex:1, 则其计算值为：1 1 0</p>
<blockquote>
<p>flex-grow 属性定义项目的放大比例，默认为 0，即如果存在剩余空间，也不放大。<br>flex-shrink 属性定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小。<br>flex-basis 属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览<br>器根据这个属性，计算主轴是否有多余空间。它的默认值为 auto，即项目的本来大小。</p>
</blockquote>
</li>
<li><p><strong>align-self: auto |flex-start |flex-end |center |baseline |stretch;</strong><br>允许单个项目有与其他项目不一样的对齐方式，可覆盖 align-items 属性。默认<br>值为auto，表示继承父元素的align-items属性。除auto外，其余同align-items。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-ac538224c8c5f08f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</li>
</ul>
<p>总结：<br>伸缩盒模型<br>父元素 子元素<br>方向 主轴对齐(x) 交叉轴对齐(y) 分配空间<br>box<br>box-orient<br>box-pack box-align box-flex<br>box-direction<br>flex flex-direction Justify-content align-items flex</p>
<blockquote>
<p><code>注：flex 新增属性——flex-wrap(是否换行),align-self（子元素自己的对齐方式）</code></p>
</blockquote>
<p>参考网址：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://caibaojian.com/flexbox-guide.html">http://caibaojian.com/flexbox-guide.html</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a><br><a target="_blank" rel="noopener" href="http://www.w3cplus.com/css3/css3-flexbox-layout.html">http://www.w3cplus.com/css3/css3-flexbox-layout.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">移动应用界面设计的尺寸设置及规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 13:43:55" itemprop="dateModified" datetime="2021-03-10T13:43:55+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
    <span id="/nirvana/javascript/%E5%89%8D%E7%AB%AF/%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%B0%BA%E5%AF%B8%E8%AE%BE%E7%BD%AE%E5%8F%8A%E8%A7%84%E8%8C%83/" class="post-meta-item leancloud_visitors" data-flag-title="移动应用界面设计的尺寸设置及规范" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>一、android篇</strong></p>
<p><strong>1、android分辨率</strong></p>
<p>Android的多分辨率，一向是设计师和开发者非常头疼的事儿。尽管如此，对于多分辨造成的复杂问题，也是大家要优先解决的。Android支持多种不同的dpi模式：ldpi 、mdpi 、hdpi 、xhdpi 、xxhdpi 、xxxhdpi<br><img src="https://upload-images.jianshu.io/upload_images/10024246-b58e0e6c4419b53b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>注意，ppi、dpi 是密度单位，不是度量单位 ：</p>
<ul>
<li><p>  ppi (pixels per inch)：图像分辨率 （在图像中，每英寸所包含的像素数目）</p>
</li>
<li><p>  dpi (dots per inch)： 打印分辨率 （每英寸所能打印的点数，即打印精度）</p>
</li>
</ul>
<p>dpi主要应用于输出，重点是打印设备上；ppi对于设计师应该比较熟悉，photoshop画布的分辨率常设置为72像素/英寸，这个单位其实就是ppi 。尽管概念不同，但是对于移动设备的显示屏，可以看作ppi=dpi 。</p>
<p>ppi的运算方式是：PPI = √（长度像素数² + 宽度像素数²） / 屏幕对角线英寸数。即：长、宽各自平方之和的开方，再除以屏幕对角线的英寸数。</p>
<p>以iphone5为例，其ppi=√（1136px² + 640px²）/4 in=326ppi（视网膜Retina屏）</p>
<p>对于android手机，一个不确切的分法是，720 x 1280 的手机很可能接近 320 dpi （xhdpi模式），480 x 800 的手机很可能接近 240 dpi （hdpi模式），而320 x 480 的手机则很接近 160 dpi（mdpi模式）。</p>
<p><strong>2、单位换算方法</strong></p>
<p>android开发中，文字大小的单位是sp，非文字的尺寸单位用dp，但是我们在设计稿用的单位是px。这些单位如何换算，是设计师、开发者需要了解的关键。</p>
<ul>
<li><p>  dp：Density-independent pixels，以160PPI屏幕为标准，则1dp=1px。dp和px的换算公式 ：dp*ppi/160 = px。对于320ppi的屏幕，1dp x 320ppi/160 = 2px。</p>
</li>
<li><p>  sp：Scale-independent pixels，它是安卓的字体单位，以160PPI屏幕为标准，当字体大小为 100%时， 1sp=1px。sp 与 px 的换算公式：sp*ppi/160 = px。对于320ppi的屏幕，1sp x 320ppi/160 = 2px。</p>
</li>
</ul>
<p>简单理解的话，px（像素）是我们UI设计师在PS里使用的，同时也是手机屏幕上所显示的，dp是开发写layout的时候使用的尺寸单位。</p>
<p><strong>为什么要把sp和dp代替px？</strong>原因是他们不会因为ppi的变化而变化，在相同物理尺寸和不同ppi下，他们呈现的高度大小是相同。也就是说更接近物理呈现，而px则不行。</p>
<p><strong>根据单位换算方法，可总结出：</strong></p>
<p>当运行在mdpi下时，1dp=1px ：也就是说设计师在PS里定义一个item高48px，开发就会定义该item高48dp ；</p>
<p>当运行在hdpi模式下时，1dp=1.5px ：也就是说设计师在PS里定义一个item高72px，开发就会定义该item高48dp ；</p>
<p>当运行在xhdpi模式下时，1dp=2px ：也就是说设计师在PS里定义一个item高96px，开发就会定义该item高48dp ；</p>
<p>当你的app需要适配多个dpi模式的时候，请参考图1的比例进行换算 。</p>
<p><strong>3、设计稿基本元素的尺寸设置</strong></p>
<p>为了适应多分辨率的手机，理想的方式是为每种分辨率做一套设计稿，包括所用到的icon、设计稿标注等。但在实际开发中，这种方法耗时耗力。所以通常会选择折中的方法。</p>
<p><strong>方法一</strong>：在标准基础上（比如xhdpi）开始，然后放大或缩小，以适应到其他尺寸。不足之处是，对于更高分辨率的手机，图标被放大后会导致质量不高。</p>
<p><strong>方法二：</strong>以最高分辨率为基准设计，然后缩小适应到所需的小分辨率上。缺点是，图标等若都最大尺寸，加载时速度慢且耗费流量较多，对于小分辨率的用户也不够好。</p>
<p>结合友盟的分辨率占比数据、也为了方便换算到android开发中的尺寸单位，<strong>推荐设计稿的画布尺寸选用 720X1280 ，分辨率仍旧为72ppi（像素/英寸）。</strong></p>
<p>在android规范中对于导航栏、工具栏等的尺寸没有明确的规定。但根据48dp原则，以及一些主流的android应用的截图分析，总结一下尺寸要求：</p>
<p><strong>状态栏高度</strong>：50 px</p>
<p><strong>导航栏、操作栏高度</strong>：96 px=48dp x 2</p>
<p><strong>主菜单栏高度</strong>：96 px</p>
<p><strong>内容区域高度</strong>：1038 px （1280-50-96-96=1038）</p>
<p>Android最近出的手机都几乎去掉了实体键，把功能键移到了屏幕中，高度也和菜单栏一样为：96 px</p>
<p><strong>4、图标和字体大小（来自官方规范文档）</strong></p>
<p>a、启动图标（home页或app列表页）</p>
<p>整体大小为48 x 48 dp<br><img src="https://upload-images.jianshu.io/upload_images/10024246-a69bccead1f7a395.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>b、操作栏图标，代表用户在app中可以使用到的最重要的图标</p>
<p>整体大小为32 x 32 dp ，图形实际区域为 24 x 24 dp</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-60ade459f9c5e979.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>c、小图标/场景图标，提供操作或特定项目的状态。</p>
<p>比如gmail app的星型标记、一些内容展开收起用到的向下向上的图标等。整体大小为16 x 16 dp ，图形实际区域为 12 x 12 dp 。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-34aefc77df01265b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>d、通知图标</p>
<p>如果app有通知，要提供一个有新通知时显示在状态栏的通知图标。整体大小为24 x 24 dp ，图形实际区域为 22 x 22 dp 。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-13dccc1657345b7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>注：android规范提供的尺寸单位是dp，若设计稿尺寸设为720 x 1280 ，图标大小需在规范要求的尺寸数字上乘以2。比如操作栏图标32 x 32 dp ，则设计稿上应该是64 x 64 px 。</p>
<p>e、字体大小</p>
<p>Android规范中的要求如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-37292659f59b5e75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>前面提到Android开发中的字号单位是sp，而换算关系是 sp*ppi/160 = px 。所以720 x 1280尺寸的设计稿上，字体大小可选择为 24px 、28px 、32px 、36px ，主要根据文字的重要程度来选择，特殊情况下也可能选择更大或更小的字体。</p>
<p>f、其他尺寸要求</p>
<p>通常把48dp作为可触摸的UI元件的标准。<br><img src="https://upload-images.jianshu.io/upload_images/10024246-41912e664c23c31c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" title="移动应用界面设计的尺寸设置及规范_"></p>
<p><strong>为什么要用48dp呢？一般来说，48dp转化为一个物理尺寸约9毫米。通常建议目标大小为7-10毫米，以方便用户手指能准确并且舒适触摸目标区域</strong>。</p>
<p>如果你设计的元素高和宽至少48dp，你就可以保证：</p>
<p>（1）触摸目标绝不会比建议的最低目标（7mm）小，无论在什么屏幕上显示。</p>
<p>（2）在整体信息密度和触摸目标大小之间取得了一个很好的平衡。</p>
<p>另外，每个UI元素之间的空白通常是8dp 。</p>
<p><strong>二、iOS篇</strong></p>
<p><strong>1、分辨率</strong></p>
<p>iPhone 界面尺寸：</p>
<table>
<thead>
<tr>
<th align="center">设备</th>
<th align="center">屏幕尺寸（英寸）</th>
<th align="center">逻辑分辨率（Point）</th>
<th align="center">缩放倍率（Scale Factor）</th>
<th align="center">像素分辨率（Pixel）</th>
<th align="center">屏幕像素密度（PPI）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">iPhone 3GS</td>
<td align="center">3.5</td>
<td align="center">320*480</td>
<td align="center"><a href="mailto:&#117;&#115;&#101;&#114;&#x40;&#x31;&#x78;&#46;&#x70;&#x6e;&#x67;">&#117;&#115;&#101;&#114;&#x40;&#x31;&#x78;&#46;&#x70;&#x6e;&#x67;</a></td>
<td align="center">320*480</td>
<td align="center">163</td>
</tr>
<tr>
<td align="center">iPhone 4/4s</td>
<td align="center">3.5</td>
<td align="center">320*480</td>
<td align="center"><a href="mailto:&#117;&#115;&#x65;&#x72;&#x40;&#50;&#120;&#x2e;&#x70;&#110;&#103;">&#117;&#115;&#x65;&#x72;&#x40;&#50;&#120;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">640*960</td>
<td align="center">330</td>
</tr>
<tr>
<td align="center">iPhone 5/5s/5c</td>
<td align="center">4.0</td>
<td align="center">320*568</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#x65;&#114;&#x40;&#50;&#x78;&#x2e;&#112;&#110;&#x67;">&#x75;&#x73;&#x65;&#114;&#x40;&#50;&#x78;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone SE</td>
<td align="center">4.0</td>
<td align="center">320*568</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x32;&#120;&#x2e;&#x70;&#110;&#103;">&#117;&#x73;&#101;&#114;&#64;&#x32;&#120;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 6</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#x65;&#114;&#x40;&#x32;&#x78;&#x2e;&#x70;&#110;&#x67;">&#x75;&#x73;&#x65;&#114;&#x40;&#x32;&#x78;&#x2e;&#x70;&#110;&#x67;</a></td>
<td align="center">640*1136</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 6s</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#x65;&#x72;&#x40;&#50;&#120;&#46;&#112;&#110;&#x67;">&#x75;&#x73;&#x65;&#x72;&#x40;&#50;&#120;&#46;&#112;&#110;&#x67;</a></td>
<td align="center">750*1334</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 7</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#117;&#115;&#x65;&#x72;&#x40;&#50;&#x78;&#46;&#x70;&#110;&#x67;">&#117;&#115;&#x65;&#x72;&#x40;&#50;&#x78;&#46;&#x70;&#110;&#x67;</a></td>
<td align="center">750*1334</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 8</td>
<td align="center">4.7</td>
<td align="center">375*667</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#114;&#64;&#50;&#120;&#x2e;&#x70;&#x6e;&#103;">&#117;&#x73;&#x65;&#114;&#64;&#50;&#120;&#x2e;&#x70;&#x6e;&#103;</a></td>
<td align="center">750*1334</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 6 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x33;&#x78;&#46;&#x70;&#x6e;&#103;">&#117;&#x73;&#101;&#114;&#64;&#x33;&#x78;&#46;&#x70;&#x6e;&#103;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 6s Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#x75;&#115;&#x65;&#x72;&#64;&#x33;&#x78;&#x2e;&#112;&#110;&#x67;">&#x75;&#115;&#x65;&#x72;&#64;&#x33;&#x78;&#x2e;&#112;&#110;&#x67;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 7 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#x2e;&#x70;&#110;&#103;">&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone 8 Plus</td>
<td align="center">5.5</td>
<td align="center">414*736</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#114;&#x40;&#x33;&#x78;&#46;&#x70;&#x6e;&#x67;">&#117;&#x73;&#x65;&#114;&#x40;&#x33;&#x78;&#46;&#x70;&#x6e;&#x67;</a></td>
<td align="center">1242*2208</td>
<td align="center">401</td>
</tr>
<tr>
<td align="center">iPhone X</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#114;&#64;&#51;&#x78;&#x2e;&#x70;&#110;&#103;">&#x75;&#x73;&#101;&#114;&#64;&#51;&#x78;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone XS</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#114;&#64;&#x33;&#x78;&#46;&#x70;&#110;&#x67;">&#117;&#x73;&#x65;&#114;&#64;&#x33;&#x78;&#46;&#x70;&#110;&#x67;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone XR</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x32;&#120;&#46;&#x70;&#x6e;&#x67;">&#117;&#x73;&#101;&#114;&#64;&#x32;&#120;&#46;&#x70;&#x6e;&#x67;</a></td>
<td align="center">828*1792</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone XS Max</td>
<td align="center">6.5</td>
<td align="center">736*1344</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x33;&#120;&#46;&#x70;&#110;&#x67;">&#117;&#x73;&#101;&#114;&#64;&#x33;&#120;&#46;&#x70;&#110;&#x67;</a></td>
<td align="center">1242*2688</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 11</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#50;&#x78;&#x2e;&#x70;&#110;&#103;">&#x75;&#x73;&#101;&#x72;&#64;&#50;&#x78;&#x2e;&#x70;&#110;&#103;</a></td>
<td align="center">828*1792</td>
<td align="center">326</td>
</tr>
<tr>
<td align="center">iPhone 11 Pro</td>
<td align="center">5.8</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#x75;&#115;&#101;&#x72;&#x40;&#51;&#x78;&#46;&#112;&#110;&#x67;">&#x75;&#115;&#101;&#x72;&#x40;&#51;&#x78;&#46;&#112;&#110;&#x67;</a></td>
<td align="center">1125*2436</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 11 Pro Max</td>
<td align="center">6.5</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#114;&#x40;&#x33;&#x78;&#46;&#112;&#x6e;&#x67;">&#x75;&#x73;&#101;&#114;&#x40;&#x33;&#x78;&#46;&#112;&#x6e;&#x67;</a></td>
<td align="center">1242*2688</td>
<td align="center">458</td>
</tr>
<tr>
<td align="center">iPhone 12</td>
<td align="center">6.1</td>
<td align="center">390*844</td>
<td align="center"><a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x33;&#120;&#x2e;&#112;&#x6e;&#103;">&#117;&#x73;&#101;&#114;&#64;&#x33;&#120;&#x2e;&#112;&#x6e;&#103;</a></td>
<td align="center">1170*2532</td>
<td align="center">460</td>
</tr>
<tr>
<td align="center">iPhone 12 mini</td>
<td align="center">5.4</td>
<td align="center">375*812</td>
<td align="center"><a href="mailto:&#117;&#x73;&#x65;&#x72;&#x40;&#51;&#120;&#46;&#x70;&#110;&#103;">&#117;&#x73;&#x65;&#x72;&#x40;&#51;&#120;&#46;&#x70;&#110;&#103;</a></td>
<td align="center">1080*2340</td>
<td align="center">476</td>
</tr>
<tr>
<td align="center">iPhone 12 Pro</td>
<td align="center">6.1</td>
<td align="center">414*896</td>
<td align="center"><a href="mailto:&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#x2e;&#112;&#x6e;&#103;">&#x75;&#x73;&#101;&#x72;&#64;&#x33;&#120;&#x2e;&#112;&#x6e;&#103;</a></td>
<td align="center">1170*2532</td>
<td align="center">460</td>
</tr>
<tr>
<td align="center">iPhone 12 Pro Max</td>
<td align="center">6.7</td>
<td align="center">428*926</td>
<td align="center"><a href="mailto:&#x75;&#115;&#x65;&#x72;&#x40;&#x33;&#120;&#x2e;&#112;&#x6e;&#x67;">&#x75;&#115;&#x65;&#x72;&#x40;&#x33;&#120;&#x2e;&#112;&#x6e;&#x67;</a></td>
<td align="center">1284*2778</td>
<td align="center">458</td>
</tr>
</tbody></table>
<p>iPad 界面尺寸：1024×768、2048×1536</p>
<p>（以上单位都是像素，至于分辨率一般网页UI和移动UI基本上都只要 72 ppi）</p>
<p><strong>2、单位换算px、pt</strong></p>
<p>这里需要先区分pt、px，pt(磅值)是物理长度单位，指的是72分之一英寸。手机上看来同一大小的字磅值是一样的，但是换算成不同分辨率手机的字号px值不一样。（px=pt*ppi/72）</p>
<p>iPhone在出retina屏(也就是4S)之前的屏幕像素是320x480px，屏幕密度是163ppi，4S的屏幕像素是640x960px，屏幕密度是326ppi，翻了一倍。iPhone5的ppi没有变化，兼容性方面要增加类似首屏画面等程序上的判断。</p>
<p>在iPhone界面上元素的定位、尺寸是通过一个单位point，而非px，屏幕上固定有320x480pt，retina屏两倍的分辨率改变的只是pt和px之间的比例而已，这样就能实现不改变程序，只上传两套图片就兼容两个分辨率。</p>
<p><strong><strong>在设计的时候并不是每个尺寸都要做一套，尺寸按自己的手机尺寸来设计，比较方便预览效果，一般用 640×960 或者 640×1136 的尺寸设计。其中设计稿的画布分辨率设为默认的72ppi（此时1px=1pt ），所以设计师可以统一采用px为单位。<br>开发拿到设计稿时，将上面标注的以px为单位的字号大小、图像尺寸除以2，就是非retina屏上的pt值，这样在retina屏上也可以根据此pt值换算对应的px大小，以确保不同的分辨率下有合适的效果。</strong></strong></p>
<p><strong>3、基本元素的尺寸设置</strong></p>
<p>iPhone的APP界面一般由四个元素组成，分别是：状态栏、导航栏、主菜单栏以及中间的内容区域。</p>
<p>这里取用 640×960 的尺寸设计，那我们就说说在这个尺寸下这些元素的尺寸：</p>
<p>状态栏：就是我们经常说的信号、运营商、电量等显示手机状态的区域，其高度为：40 px</p>
<p>导航栏：显示当前界面的名称，包含相应的功能或者页面间跳转的按钮，其高度为：88 px</p>
<p>主菜单栏：类似于页面的主菜单，提供整个应用的分类内容的快速跳转，其高度为：98 px</p>
<p>内容区域：展示应用提供的相应内容，整个应用中布局变更最为频繁的，其高度为：734 px=960-40-88-98</p>
<p>以上尺寸适用于 iPhone 4、4S，iPhone5/5s 的 640×11136 的尺寸，其实就是中间的内容区域高度增加到：910 px，其他尺寸也同上。</p>
<p><strong>4、常用图像、图标大小（来自官方规范文档）</strong></p>
<p>单位：像素</p>
<p><img src="https://upload-images.jianshu.io/upload_images/10024246-1b7ce723077960fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片描述" title="移动应用界面设计的尺寸设置及规范_"></p>
<p><strong>5、字体大小</strong></p>
<p>iOS交互设计规范文档上，对字体大小没有做严格的数值规定，只提供了一些指导原则：</p>
<p>单位：点pt</p>
<p>– 即便用户选择了最小文字大小，文字也不应小于 22 点。作为对照，正文样式在大字号下使用 34 点字体大小作为默认文字大小设置。</p>
<p>– 通常来说，每一档文字大小设置的字体大小和行间距的差异是 2 点。例外情况是两个标题样式，在最小、小和中等设置时都使用相同字体大小、行间距和字间距。</p>
<p>– 在最小的三种文字大小中，字间距相对宽阔；在最大的三种文字大小中，字间距相对紧密。</p>
<p>– 标题和正文样式使用一样的字体大小。为了将其和正文样式区分，标题样式使用加粗效果。</p>
<p>– 导航控制器中的文字使用和大号的正文样式文字大小（明确来说，是 34 点）。</p>
<p>– 文本通常使用常规体和中等大小，而不是用细体和粗体。</p>
<p>百度用户体验做过的一个小调查：</p>
<p>单位：像素px<br><img src="https://upload-images.jianshu.io/upload_images/10024246-53edeaa9f75645e5.gif?imageMogr2/auto-orient/strip" alt="图片描述" title="移动应用界面设计的尺寸设置及规范_"></p>
<p>还有个方法就是找你觉得好的APP应用，手机截图后放进PS自己对比调节字体大小。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lzhwweb.github.io/nirvana/DesignPattern/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88TypeScript%EF%BC%89/Abstract-Factory-Pattern%EF%BC%88%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/nirvana/images/headphoto.jpeg">
      <meta itemprop="name" content="nirvana">
      <meta itemprop="description" content="个人学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="涅槃快乐是金">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nirvana/DesignPattern/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88TypeScript%EF%BC%89/Abstract-Factory-Pattern%EF%BC%88%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%89/" class="post-title-link" itemprop="url">Abstract-Factory-Pattern（抽象工厂模式）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-11 21:12:40" itemprop="dateCreated datePublished" datetime="2021-03-11T21:12:40+08:00">2021-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-10 22:13:48" itemprop="dateModified" datetime="2021-03-10T22:13:48+08:00">2021-03-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/nirvana/categories/DesignPattern/" itemprop="url" rel="index"><span itemprop="name">DesignPattern</span></a>
        </span>
    </span>

  
    <span id="/nirvana/DesignPattern/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88TypeScript%EF%BC%89/Abstract-Factory-Pattern%EF%BC%88%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="Abstract-Factory-Pattern（抽象工厂模式）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>抽象工厂模式（Abstract Factory Pattern）</strong>：抽象工厂的工作是将“抽象零件”组装成“抽象产品”。不关心零件的具体实现，而是值关心接口。我们使用该接口将零件组装成产品<br>在抽象工厂模式中，接口是负责创建一个相关对象的工厂，不需要显式指定它们的类。每个生成的工厂都能按照工厂模式提供对象。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li><strong>意图：</strong>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</li>
<li><strong>主要解决：</strong>主要解决接口选择的问题。</li>
<li><strong>何时使用：</strong>系统的产品有多于一个的产品族，而系统只消费其中某一族的产品。</li>
<li><strong>如何解决：</strong>在一个产品族里面，定义多个产品。</li>
<li><strong>关键代码：</strong>在一个工厂里聚合多个同类产品。</li>
<li><strong>优点：</strong>当一个产品族中的多个对象被设计成一起工作时，它能保证客户端始终只使用同一个产品族中的对象。</li>
<li><strong>缺点：</strong>产品族扩展非常困难，要增加一个系列的某一产品，既要在抽象的 Creator 里加代码，又要在具体的里面加代码。</li>
<li><strong>使用场景：</strong><br>1、QQ 换皮肤，一整套一起换。<br>2、生成不同操作系统的程序。<blockquote>
<p>注意事项：产品族难扩展，产品等级易扩展。</p>
</blockquote>
</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>Shape.ts 创建一个形状接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export interface Shape &#123;</span><br><span class="line">    draw(): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Square.ts 正方形类实现形状接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line"></span><br><span class="line">export default class Square implements Shape &#123;</span><br><span class="line">    public draw(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Square::draw() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Rectangle.ts 长方形类实现形状接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line"></span><br><span class="line">export default class Rectangle implements Shape &#123;</span><br><span class="line"></span><br><span class="line">    public draw(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Rectangle::draw() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Circle.ts 圆形类实现形状接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line"></span><br><span class="line">export default class Circle implements Shape &#123;</span><br><span class="line">    public draw(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Circle::draw() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Color.ts 创建一个颜色接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export interface Color &#123;</span><br><span class="line">    fill(): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Red.ts 红色类实现颜色接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line"></span><br><span class="line">export default class Red implements Color &#123;</span><br><span class="line"></span><br><span class="line">    public fill(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Red::fill() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Blue.ts 蓝色类实现颜色接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line"></span><br><span class="line">export default class Blue implements Color &#123;</span><br><span class="line"></span><br><span class="line">    public fill(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Blue::fill() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Green.ts 绿色类实现颜色接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line"></span><br><span class="line">export default class Green implements Color &#123;</span><br><span class="line"></span><br><span class="line">    public fill(): void &#123;</span><br><span class="line">        console.log(&quot;Inside Green::fill() method.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractFactory.ts 抽象工厂，为Color、Shape创建抽象对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line"></span><br><span class="line">export default abstract class AbstractFactory &#123;</span><br><span class="line">    public abstract getColor(color: string): Color;</span><br><span class="line">    public abstract getShape(shape: string): Shape;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ColorFactory.ts 创建扩展了 AbstractFactory 的工厂类，基于给定的信息生成实体类的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import AbstractFactory from &quot;.&#x2F;AbstractFactory&quot;;</span><br><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line">import Red from &quot;.&#x2F;Red&quot;;</span><br><span class="line">import Green from &quot;.&#x2F;Green&quot;;</span><br><span class="line">import Blue from &quot;.&#x2F;Blue&quot;;</span><br><span class="line"></span><br><span class="line">export default class ColorFactory extends AbstractFactory &#123;</span><br><span class="line">    public getShape(shapeType: string): Shape &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    public getColor(color: string): Color &#123;</span><br><span class="line">        if (color &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        if (color.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;RED&quot;) &#123;</span><br><span class="line">            return new Red();</span><br><span class="line">        &#125; else if (color.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;GREEN&quot;) &#123;</span><br><span class="line">            return new Green();</span><br><span class="line">        &#125; else if (color.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;BLUE&quot;) &#123;</span><br><span class="line">            return new Blue();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ShapeFactory.ts 创建扩展了 AbstractFactory 的工厂类，基于给定的信息生成实体类的对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import AbstractFactory from &quot;.&#x2F;AbstractFactory&quot;;</span><br><span class="line">import &#123; Shape &#125; from &quot;.&#x2F;Shape&quot;;</span><br><span class="line">import Circle from &quot;.&#x2F;Circle&quot;;</span><br><span class="line">import Rectangle from &quot;.&#x2F;Rectangle&quot;;</span><br><span class="line">import Square from &quot;.&#x2F;Square&quot;;</span><br><span class="line">import &#123; Color &#125; from &quot;.&#x2F;Color&quot;;</span><br><span class="line"></span><br><span class="line">export default class ShapeFactory extends AbstractFactory &#123;</span><br><span class="line"></span><br><span class="line">    public getShape(shapeType: string): Shape &#123;</span><br><span class="line">        if (shapeType &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        if (shapeType.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;CIRCLE&quot;) &#123;</span><br><span class="line">            return new Circle();</span><br><span class="line">        &#125; else if (shapeType.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;RECTANGLE&quot;) &#123;</span><br><span class="line">            return new Rectangle();</span><br><span class="line">        &#125; else if (shapeType.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;SQUARE&quot;) &#123;</span><br><span class="line">            return new Square();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    public getColor(color: string): Color &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>FactoryProducer.ts 创建一个工厂创造器/生成器类，通过传递形状或颜色信息来获取工厂</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import AbstractFactory from &quot;.&#x2F;AbstractFactory&quot;;</span><br><span class="line">import ShapeFactory from &quot;.&#x2F;ShapeFactory&quot;;</span><br><span class="line">import ColorFactory from &quot;.&#x2F;ColorFactory&quot;;</span><br><span class="line"></span><br><span class="line">export default class FactoryProducer &#123;</span><br><span class="line">    public static getFactory(choice: string): AbstractFactory &#123;</span><br><span class="line">        if (choice.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;SHAPE&quot;) &#123;</span><br><span class="line">            return new ShapeFactory();</span><br><span class="line">        &#125; else if (choice.toUpperCase() &#x3D;&#x3D;&#x3D; &quot;COLOR&quot;) &#123;</span><br><span class="line">            return new ColorFactory();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.ts </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import FactoryProducer from &quot;.&#x2F;FactoryProducer&quot;;</span><br><span class="line">&#x2F;&#x2F;获取形状工厂</span><br><span class="line">const shapeFactory &#x3D; FactoryProducer.getFactory(&quot;SHAPE&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取形状为 Circle 的对象</span><br><span class="line">const shape1 &#x3D; shapeFactory.getShape(&quot;CIRCLE&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Circle 的 draw 方法</span><br><span class="line">shape1.draw();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取形状为 Rectangle 的对象</span><br><span class="line">const shape2 &#x3D; shapeFactory.getShape(&quot;RECTANGLE&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Rectangle 的 draw 方法</span><br><span class="line">shape2.draw();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取形状为 Square 的对象</span><br><span class="line">const shape3 &#x3D; shapeFactory.getShape(&quot;SQUARE&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Square 的 draw 方法</span><br><span class="line">shape3.draw();</span><br><span class="line">&#x2F;&#x2F;获取颜色工厂</span><br><span class="line">const colorFactory &#x3D; FactoryProducer.getFactory(&quot;COLOR&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取颜色为 Red 的对象</span><br><span class="line">const color1 &#x3D; colorFactory.getColor(&quot;RED&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Red 的 fill 方法</span><br><span class="line">color1.fill();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取颜色为 Green 的对象</span><br><span class="line">const color2 &#x3D; colorFactory.getColor(&quot;Green&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Green 的 fill 方法</span><br><span class="line">color2.fill();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取颜色为 Blue 的对象</span><br><span class="line">const color3 &#x3D; colorFactory.getColor(&quot;BLUE&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用 Blue 的 fill 方法</span><br><span class="line">color3.fill();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="result"><a href="#result" class="headerlink" title="result"></a>result</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Inside Circle::draw() method.</span><br><span class="line">Inside Rectangle::draw() method.</span><br><span class="line">Inside Square::draw() method.</span><br><span class="line">Inside Red::fill() method.</span><br><span class="line">Inside Green::fill() method.</span><br><span class="line">Inside Blue::fill() method.</span><br></pre></td></tr></table></figure>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><p><img src="https://upload-images.jianshu.io/upload_images/10024246-77c13ebb515b20a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><ul>
<li><strong>AbstractProduct（抽象产品）</strong><br>AbstractProduct角色负责定义AbstractFactory角色所生产的抽象零件和产品的接口</li>
<li><strong>AbstractFactory（抽象工厂）</strong><br>AbstractFactory角色负责定义用于生产抽象产品的接口</li>
<li><strong>Client（委托者）</strong><br>Client角色仅会调用AbstractFactory角色和AbstractProduct角色的接口进行工作，对于具体的零件、产品和工厂一无所知。</li>
<li><strong>ConcreteProduct（具体产品）</strong><br>ConcreteProduct角色负责实现AbstractProduct角色定义的接口</li>
<li><strong>ConcreteFactory（具体工厂）</strong><br>ConcreteFactory角色负责实现AbstractFactory角色的接口。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/nirvana/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/nirvana/">1</a><span class="space">&hellip;</span><a class="page-number" href="/nirvana/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/nirvana/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/nirvana/page/19/">19</a><a class="extend next" rel="next" href="/nirvana/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nirvana</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">532k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">8:04</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/nirvana/js/utils.js"></script><script src="/nirvana/js/motion.js"></script><script src="/nirvana/js/next-boot.js"></script>

  
<script src="/nirvana/js/local-search.js"></script>






  


<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"SPsNUvBhME7XmrjzCfHkUu3e-gzGzoHsz","app_key":"4TONafemiIzvJUwqLa7WveoL","server_url":"https://leancloud.cn","security":true,"betterPerformance":false};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>



</body>
</html>
